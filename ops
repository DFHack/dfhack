{"version":1,"ops":[{"type":2,"author":{"id":"0541b7dd92e4d9285c31215454cda686ef6b8a4e"},"timestamp":1482011286,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50ODk3NzAyODEw"},"title":"Access violations inside ruby cause a whole-app quit","was":"Access violations inside ruby cause a whole-app quit"},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1482011309,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI2Nzc4OTA5MA==","github-url":"https://github.com/DFHack/dfhack/issues/1048#issuecomment-267789090"},"message":"The Lua interpreter doesn't do this. It can catch any C++ exception, but (currently) not signals.","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1482899537,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDkwNjIxMzczNw=="},"added":["ruby"],"removed":[]},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1494459496,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMwMDY0MjAzNg==","github-url":"https://github.com/DFHack/dfhack/issues/1048#issuecomment-300642036"},"message":"I'm getting a normal segfault on OS X. When BenLubar and I were researching 4dff21897650e97aadd217bc1510a27d2a4780ba, we ran into [this function](https://github.com/ruby/ruby/blob/97819765a6530004d2dc42bc175dc497cb22a34b/thread_win32.c#L738-L745) in libruby, as well as [this](https://github.com/ruby/ruby/blob/9d09240d9e329bbe5a8168dd850f5bb3549fbaa9/eval_intern.h#L95), which imply that there's some sort of custom Windows-specific segfault handling in libruby. I'm not sure that's something we should interfere with.","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1494459519,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDEwNzczNjYwNjY="},"added":["idea"],"removed":[]},{"type":3,"author":{"id":"da9d15f02e5a1932f1c39e14fd6289f4a2b59e10"},"timestamp":1528057611,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM5NDE4ODg2Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1048#issuecomment-394188863"},"message":"Heyo,\n\nThese access violations are occurring at init on my machine. If I remove the file libruby.dll, I can play the game. Otherwise, debugging shows a first and last chance exception for an 0x0 access violation. The violation occurs pretty much instantly after ruby is loaded, and quits. There isn't any reference to the failure in any logging either.\n\nIf the idea stated here was implemented, I'd at least be able to get more insight into the cause.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1528057940,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM5NDE4OTIwMA==","github-url":"https://github.com/DFHack/dfhack/issues/1048#issuecomment-394189200"},"message":"That's not what this issue is about. It's about buggy Ruby scripts (e.g. ones that dereference invalid DF objects) catching the segfault signal somehow.\n\nSome details about your system would help. What Windows version? What DFHack version and build (32/64-bit)? Did you replace libruby.dll?","files":null},{"type":3,"author":{"id":"da9d15f02e5a1932f1c39e14fd6289f4a2b59e10"},"timestamp":1528060454,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM5NDE5MTg5Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1048#issuecomment-394191893"},"message":"Apologies for misunderstanding.\n\nWindows 10 Pro 64-bit v.1709 build 16299.431\nDFHack build 0.44.10-r1-0-g8cb5e7fa (From PeridexisErrant's 0.44.10-r03 pack)\nlibruby: 2.0.0p648 (x64-mingw32)\n\nLibruby is as packaged initially, last line in stderr.log before quit:\nloaded plugin reveal; DFHack build 0.44.10-r1-0-g8cb5e7fa\n\nRemoving libruby.dll sidesteps the whole thing.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1528065597,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM5NDE5NzQwMg==","github-url":"https://github.com/DFHack/dfhack/issues/1048#issuecomment-394197402"},"message":"You know, it's possible that the ruby segfault handler is installed before the crash, which would kind of make it the same issue. Can you try getting rid of all `.rb` files in hack/scripts and see what that does?\n\nIn any case, libruby.dll is not built by us (we just provide it), so there's really nothing we can do about issues with it. We have a pretty big Windows 10 user base, so I'm not sure why this would be the first time hearing about an issue like this.","files":null},{"type":3,"author":{"id":"da9d15f02e5a1932f1c39e14fd6289f4a2b59e10"},"timestamp":1528071360,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM5NDIwNDE1MA==","github-url":"https://github.com/DFHack/dfhack/issues/1048#issuecomment-394204150"},"message":"Seems to occur with or without the .rb files.\n\nIt's weird to me too, as it nearly guarantees that the fault lies in my setup.","files":null}]}