{"version":1,"ops":[{"type":1,"author":{"id":"56681e043c819c525e8f7bc6495f7e532f4c725b"},"timestamp":1410364387,"metadata":{"github-id":"MDU6SXNzdWU0MjQyODQyNA==","github-url":"https://github.com/DFHack/dfhack/issues/327","origin":"github"},"title":"lua binpatch doesn't close patchfile, leading to handle leak","message":"**lua/binpatch.lua:load_patch()**\nThis function doesn't close the file handle in the **file** variable if the function succeeds.  It's only closed on parse failure.\n\nI don't speak lua, but by inspection, it appears to me that a **file:close()** statement should be inserted just before the final **return** statement.\n\nI can reproduce this by **check**ing a patchfile, then trying to edit the patchfile with Wordpad.  Wordpad reports that the document is in use by another application and cannot be accessed.  Similarly, Vim reports that the file is read-only, and requires an override command to write to it.  On the other hand, Notepad doesn't care.\n\nNote: this is about the binpatch.lua module in the lua subdirectory, not about the binpatch.exe program or the binpatch.lua interface script in the scripts subdirectory.","files":null}]}