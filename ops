{"version":1,"ops":[{"type":1,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1527090270,"metadata":{"github-id":"MDU6SXNzdWUzMjU3NjYwNTQ=","github-url":"https://github.com/DFHack/dfhack/issues/1287","origin":"github"},"title":"modtools/extra-gamelog: a few state-related issues","message":"* All globals are reset when the script is run, so running `modtools/extra-gamelog enable` twice will clear all information about sieges, workshops, nobles, etc.. This should be changed to `buildStates = buildStates or {}` , and these globals should be reset in log_on_load().\n* The script doesn't stay enabled across save/load cycles because `ticks` timeouts get cleared on unload (although it thinks it does because `extra_gamelog_enabled` is still true). Putting it in onLoad.init instead of dfhack.init probably won't work because it might not see the statechange event. Calling event_loop from log_on_load would probably work.\n* event_loop() can be scheduled multiple times when running `modtools/extra-gamelog enable` multiple times. This and the previous issue could be fixed by storing the ID returned by dfhack.timeout() in a global and checking whether it corresponds to an active timeout.\n* Unrelated, but this shouldn't be in the modtools folder, because it's not intended for mods.","files":null}]}