{"version":1,"ops":[{"type":3,"author":{"id":"7601c6aa8a3715c21c201430673af1d762386b84"},"timestamp":1407766425,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUxNzg1MjY4","github-url":"https://github.com/DFHack/dfhack/issues/276#issuecomment-51785268"},"message":"Edit line 68 in the dfhack script from:\n`setarch i386 -R env LD_PRELOAD=$PRELOAD_LIB ./libs/Dwarf_Fortress \"$@\"`\nTo:\n`setarch i386 -R env LD_PRELOAD=\"$PRELOAD_LIB /usr/lib/libz.so.1\" ./libs/Dwarf_Fortress \"$@\"`","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1407772304,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUxNzk5MjMw","github-url":"https://github.com/DFHack/dfhack/issues/276#issuecomment-51799230"},"message":"Adding /usr/lib/libz.so.1 to PRELOAD_LIB on [line 41](https://github.com/DFHack/dfhack/blob/develop/package/linux/dfhack#L41) should work as well:\n\n``` sh\nPRELOAD_LIB=\"./hack/libdfhack.so:/usr/lib/libz.so.1\"\n```\n\n(Edit: Changed space to colon)","files":null},{"type":3,"author":{"id":"7601c6aa8a3715c21c201430673af1d762386b84"},"timestamp":1407774514,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUxODA0MjQ5","github-url":"https://github.com/DFHack/dfhack/issues/276#issuecomment-51804249"},"message":"I just tested, and that results in a segfault. According to the manpages for LD, the libraries should be separated by a colon like so:\n`PRELOAD_LIB=./hack/libdfhack.so:/usr/lib/libz.so.1`","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1407774883,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUxODA1MDUz","github-url":"https://github.com/DFHack/dfhack/issues/276#issuecomment-51805053"},"message":"From `man ld`:\n\n\u003e  **LD_PRELOAD**: A list of additional, user-specified, ELF shared libraries to be loaded before all others. The items of the list can be separated by spaces or colons. \u003c...\u003e\n\nI suppose this could depend on your distro, though. Either way, if you're experiencing a non-LD-related segfault, there may be a problem with your zlib.","files":null},{"type":3,"author":{"id":"7601c6aa8a3715c21c201430673af1d762386b84"},"timestamp":1407775372,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUxODA2MTY5","github-url":"https://github.com/DFHack/dfhack/issues/276#issuecomment-51806169"},"message":"Right, but we're setting PRELOAD_LIB here. When it gets passed on to LD_PRELOAD, it loses the quotation marks and only the first library is actually preloaded.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1407776140,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUxODA3ODE3","github-url":"https://github.com/DFHack/dfhack/issues/276#issuecomment-51807817"},"message":"Ah, thanks for noticing that. I was recommending PRELOAD_LIB because it looks like it's intended for this purpose, but it doesn't really make a difference in this case - your fix (adding it directly to LD_PRELOAD) should work just fine, as long as you don't plan on using a debugger.","files":null},{"type":5,"author":{"id":"be523fe0f95fc478bda36c722e6f106f8f7a41b5"},"timestamp":1417351325,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDIwMDI1MDc0Mg=="},"added":["bug"],"removed":[]}]}