{"version":1,"ops":[{"type":6,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1585904590,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDozNjcwNzU4Mzk="},"target":"11fd2d9aacdecb7bc2512d0ad420c6b44453652101913897b08a219293c9966f","message":"History event exports of hf_does_interactionst and hf_learns_secretst export interaction raw strings, token and all, and does so using hard coded indices.\n\n1. Does DF use a canonical order of tokens internally? If not, any user generated raws may result in the wrong token being exported.\n2. Just dumping strings is quite ugly. If the raw strings are used, they ought to at least be stripped down to the contents.\n\nFor the hf_learns_secret case, it looks like the applicable string is available in in a directly usable form as\n ´´´\ninteractions[v].sources[0].name\n´´´\nalthough that relies on the assumption that there is a single source (or at least that the description is in the first one).\n\nFor the hf_does_interaction case, it looks like there's a corresponding approach would be\n´´´\ninteractions[v].sources[0].hist_string_1 + interactions[v].sources[0].hist_string_2\n´´´\nresulting in \" cursed to assume the form of a gila monster-like monster every full moon\" (with a leading blank).\n\nThe reason I don't just make these changes and a PR is that I'm unsure if it would be that much safer than the current implementation, as it relies on the \"sources\" element to be of an appropriate derived type. Someone with a bit more knowledge of interactions might be able to provide advice.\n\nIt would e.g. be possible to check for the presence of a source element and that it's of the expected derived type and output an error message (but still provide a functioning XML file) if it's not. If that is done, it's still required to know the source derived types applicable to each case. Is it only _deityst for the hf_does_interaction case and _secretst for the hf_does_interaction case, and does it make sense to have more than one element in sources (and, if so, can they be of the same type, or should there be a search for the appropriate one[s])?","files":null},{"type":6,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1585905018,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDozNjcwNzg0MTc="},"target":"11fd2d9aacdecb7bc2512d0ad420c6b44453652101913897b08a219293c9966f","message":"History event exports of hf_does_interactionst and hf_learns_secretst export interaction raw strings, token and all, and does so using hard coded indices.\n\n1. Does DF use a canonical order of tokens internally? If not, any user generated raws may result in the wrong token being exported.\n2. Just dumping strings is quite ugly. If the raw strings are used, they ought to at least be stripped down to the contents.\n\nFor the hf_learns_secret case, it looks like the applicable string is available in in a directly usable form as\n ´´´\ninteractions[v].sources[0].name\n´´´\nalthough that relies on the assumption that there is a single source (or at least that the description is in the first one).\n\nFor the hf_does_interaction case, it looks like there's a corresponding approach would be\n´´´\ninteractions[v].sources[0].hist_string_1 + interactions[v].sources[0].hist_string_2\n´´´\nresulting in \" cursed to assume the form of a gila monster-like monster every full moon\" (with a leading blank).\n\nThe reason I don't just make these changes and a PR is that I'm unsure if it would be that much safer than the current implementation, as it relies on the \"sources\" element to be of an appropriate derived type. Someone with a bit more knowledge of interactions might be able to provide advice.\n\nIt would e.g. be possible to check for the presence of a source element and that it's of the expected derived type and output an error message (but still provide a functioning XML file) if it's not. If that is done, it's still required to know the source derived types applicable to each case. Is it only _deityst for the hf_does_interaction case and _secretst and _experimentst for the hf_does_interaction case, and does it make sense to have more than one element in sources (and, if so, can they be of the same type, or should there be a search for the appropriate one[s])?","files":null},{"type":6,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1585905123,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDozNjcwNzkwNjc="},"target":"11fd2d9aacdecb7bc2512d0ad420c6b44453652101913897b08a219293c9966f","message":"History event exports of hf_does_interactionst and hf_learns_secretst export interaction raw strings, token and all, and does so using hard coded indices.\n\n1. Does DF use a canonical order of tokens internally? If not, any user generated raws may result in the wrong token being exported.\n2. Just dumping strings is quite ugly. If the raw strings are used, they ought to at least be stripped down to the contents.\n\nFor the hf_learns_secret case, it looks like the applicable string is available in in a directly usable form as\n ´´´\ninteractions[v].sources[0].name\n´´´\nalthough that relies on the assumption that there is a single source (or at least that the description is in the first one).\n\nFor the hf_does_interaction case, it looks like there's a corresponding approach would be\n´´´\ninteractions[v].sources[0].hist_string_1 + interactions[v].sources[0].hist_string_2\n´´´\nresulting in \" cursed to assume the form of a gila monster-like monster every full moon\" (with a leading blank).\n\nThe reason I don't just make these changes and a PR is that I'm unsure if it would be that much safer than the current implementation, as it relies on the \"sources\" element to be of an appropriate derived type. Someone with a bit more knowledge of interactions might be able to provide advice.\n\nIt would e.g. be possible to check for the presence of a source element and that it's of the expected derived type and output an error message (but still provide a functioning XML file) if it's not. If that is done, it's still required to know the source derived types applicable to each case. Is it only _deityst for the hf_does_interaction case and _secretst and _experimentst for the hf_does_interaction case, and does it make sense to have more than one element in sources (and, if so, can they be of the same type, or should there be a search for the appropriate one[s])?\n\nEdit: finding _experimentst, it's apparent that there can be 2 sources elements, although the first one is experimentst in the case seen (the second one being _attackst).","files":null},{"type":6,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1585906035,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDozNjcwODQzMDI="},"target":"11fd2d9aacdecb7bc2512d0ad420c6b44453652101913897b08a219293c9966f","message":"History event exports of hf_does_interactionst and hf_learns_secretst export interaction raw strings, token and all, and does so using hard coded indices.\n\n1. Does DF use a canonical order of tokens internally? If not, any user generated raws may result in the wrong token being exported.\n2. Just dumping strings is quite ugly. If the raw strings are used, they ought to at least be stripped down to the contents.\n\nFor the hf_learns_secret case, it looks like the applicable string is available in in a directly usable form as\n ´´´\ninteractions[v].sources[0].name\n´´´\nalthough that relies on the assumption that there is a single source (or at least that the description is in the first one).\n\nFor the hf_does_interaction case, it looks like there's a corresponding approach would be\n´´´\ninteractions[v].sources[0].hist_string_1 + interactions[v].sources[0].hist_string_2\n´´´\nresulting in \" cursed to assume the form of a gila monster-like monster every full moon\" (with a leading blank).\n\nThe reason I don't just make these changes and a PR is that I'm unsure if it would be that much safer than the current implementation, as it relies on the \"sources\" element to be of an appropriate derived type. Someone with a bit more knowledge of interactions might be able to provide advice.\n\nIt would e.g. be possible to check for the presence of a source element and that it's of the expected derived type and output an error message (but still provide a functioning XML file) if it's not. If that is done, it's still required to know the source derived types applicable to each case. Is it only _deityst for the hf_does_interaction case and _secretst and _experimentst for the hf_does_interaction case, and does it make sense to have more than one element in sources (and, if so, can they be of the same type, or should there be a search for the appropriate one[s])?\n\nEdit: finding _experimentst, it's apparent that there can be 2 sources elements, although the first one is experimentst in the case seen (the second one being _attackst).\n\nEdit2: And there is a case of the current approach failing with\n´´´\n\u003cinteraction_action\u003e[IS_HIST_STRING_2:, passing on the sloth monster curse]\u003c/interaction_action\u003e\n\u003cinteraction_string\u003e[I_TARGET:A:CREATURE]\u003c/interaction_string\u003e\n´´´\nfor interaction DEITY_CURSE_WEREBEAST_10_BITE, as the desired strings are 2 and 3 in that case.\nusing the single sources _attackst element's hist_string_1+2 would result in \" bit, passing on the sloth monster curse\"\n\nVampire curse would work, but spreading it uses the _ingestionst source derived type.","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1586834724,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDMyMjkzMjYzMTE="},"added":["bug"],"removed":[]},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1586835437,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYxMzIwODU1OA==","github-url":"https://github.com/DFHack/dfhack/issues/1534#issuecomment-613208558"},"message":"I'm guessing backticks are hard to get to (or missing?) on your keyboard - you're using ´, but ` is what you want for code formatting. I'm not familiar with Scandinavian keyboard layouts, but from looking around, typing backticks seems like it can be system-specific. Still readable IMO, and thanks for tracking this down and fixing it!","files":null},{"type":3,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1586846021,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYxMzI1MjgzNA==","github-url":"https://github.com/DFHack/dfhack/issues/1534#issuecomment-613252834"},"message":"There is a backtick on the keyboard which works like diacritical decorations, i.e. they're not displayed until the character to be decorated is pressed (like this \"è\"). For these code indicators I typically press the key 6 times, resulting in 3 pairs, and then split it in the middle to insert the code. I never have any other use for the key, though. Don't know why I used the wrong tick this time.","files":null},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1586911434,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MzIzMzQwNjk2OQ=="},"status":2}]}