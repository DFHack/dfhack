{"version":1,"ops":[{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1577799345,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU2OTkyOTY3OQ==","github-url":"https://github.com/DFHack/dfhack/issues/1477#issuecomment-569929679"},"message":"There's an environment variable for this: https://dfhack.readthedocs.io/en/stable/docs/Core.html#environment-variables","files":null},{"type":3,"author":{"id":"50f59a96b9b7e087929d72d59e95c4aa34b5cdc8"},"timestamp":1577978323,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3MDIzODIzNA==","github-url":"https://github.com/DFHack/dfhack/issues/1477#issuecomment-570238234"},"message":"@lethosor It doesn't do anything.  Exporting `DFHACK_DISABLE_CONSOLE=1` only suppresses DFHack's final prompt line, `[DFHack]# `, but DFHack's console still does lots of TTY I/O and triggers a SEGFAULT:\n\n```\nThread 12 Crashed:\n0   libsystem_c.dylib             \t0x00007fff71d8c59c flockfile + 18\n1   libsystem_c.dylib             \t0x00007fff71d8dda0 fputs + 66\n2   libdfhack.1.0.0.dylib         \t0x00000001025f26cc DFHack::Console::add_text(DFHack::color_value, std::string const\u0026) + 204\n```\n\nSpecifically, with `DFHACK_DISABLE_CONSOLE=1` and all I/O redirected to null, it still attempts to write to the TTY:\n```\nTWBT: version 6.61\nDFHack is ready. Have a nice day!\nDFHack version 0.44.12-r2 (release) on x86_64\nType in '?' or 'help' for general help, 'ls' to see all commands.\n```\n(And now additionally during shutdown, in red, `Plugin twbt has failed to shutdown!`)\n\nDFHack is stuffing those 5 lines directly into `/dev/tty` (see [DFHack::Console::init](https://github.com/DFHack/dfhack/blob/master/library/Console-posix.cpp#L833)) even if `DFHACK_DISABLE_CONSOLE=1` is set.  That's bad.  DFHack shouldn't do _anything_ with ttys if `DFHACK_DISABLE_CONSOLE=1`.  Yet it makes numerous `tcsetattr` and `fwritef` calls on a null `FILE *`.\n\nIf that env is set, DFHack should either output nothing at all, or just blindly write to stderr.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1577978754,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3MDI0MDM3Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1477#issuecomment-570240373"},"message":"Ok, so it does disable the console, but it doesn't disable all TTY output. I'll try to replicate this. In the meantime, does wrapping dfhack in tmux/screen work?","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1579913939,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDI5NzkwMDA5NzE="},"added":["bug"],"removed":[]},{"type":3,"author":{"id":"50f59a96b9b7e087929d72d59e95c4aa34b5cdc8"},"timestamp":1580232895,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3OTM2Njk5Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1477#issuecomment-579366993"},"message":"No luck with screen, probably since `/dev/tty` is not available.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1580233953,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3OTM3NDMzNw==","github-url":"https://github.com/DFHack/dfhack/issues/1477#issuecomment-579374337"},"message":"You'd have to detach it to start it without a tty: `screen -d -m ./dfhack`?","files":null},{"type":3,"author":{"id":"fefd87bd170e69ba989c5932b26d53a6f30e8666"},"timestamp":1585414833,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYwNTQ4ODg0Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1477#issuecomment-605488843"},"message":"try using `script -c ./dfhack /dev/null` to give it a tty","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1585416223,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYwNTQ5MjAxOA==","github-url":"https://github.com/DFHack/dfhack/issues/1477#issuecomment-605492018"},"message":"6eb73d9046b8d122f8a402ebefe6dc0de768dfc8 seems to help with this - at least, `setsid ./dfhack \u003c/dev/null \u003elog 2\u003e\u00261` no longer crashes for me on Linux, and it did before.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1586836305,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYxMzIxMTUwOQ==","github-url":"https://github.com/DFHack/dfhack/issues/1477#issuecomment-613211509"},"message":"I ran into some issues in #1545 due to a lack of a TTY, but DFHack didn't crash. I think this is fixed, but let me know / reopen this if it still crashes on your end in 0.47.04-beta1 or newer.","files":null},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1586836305,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MzIyOTM2NjQ4Ng=="},"status":2}]}