{"version":1,"ops":[{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1518538523,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDE0NzE5ODI1NzY="},"added":["crash/hang"],"removed":[]},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1518538646,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NTMxNzM1OA==","github-url":"https://github.com/DFHack/dfhack/issues/1227#issuecomment-365317358"},"message":"I get this:\n```\n[DFHack]# dwarfvet enable\ndwarfvet enabled!\nPopulating hospital cache:\n  Found animal hospital 585  at x1: 31, y1: 47 from valid hospital list\n```\nIf it works in another world, can you upload the problematic world?","files":null},{"type":3,"author":{"id":"e297a1027662381a0f64cc7678ff9ed5f9b5f4e7"},"timestamp":1518615427,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NTYwOTAxNg==","github-url":"https://github.com/DFHack/dfhack/issues/1227#issuecomment-365609016"},"message":"[region-that-crashes-dwarfvet.zip](https://github.com/DFHack/dfhack/files/1724161/region-that-crashes-dwarfvet.zip)\n\nHere is the problematic world. It doesn't seem to crash my other worlds when I try it.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1518618433,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NTYyMjk3MA==","github-url":"https://github.com/DFHack/dfhack/issues/1227#issuecomment-365622970"},"message":"Ok, I couldn't find a hospital at those x/y coordinates (there was a bug I just fixed with it not printing the z coordinate correctly), but creating a new one caused a crash, so I'll look into it. Thanks!","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1518618456,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDE0NzM4OTU5NzE="},"added":["bug"],"removed":[]},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1518621442,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NTYzODc3Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1227#issuecomment-365638773"},"message":"I think the issue is the beds in the animal hospital, but haven't verified it. You could try deconstructing them, or disabling the training or hospital aspects of that zone and making a new zone.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1518766633,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NjE2Mzg4Mg==","github-url":"https://github.com/DFHack/dfhack/issues/1227#issuecomment-366163882"},"message":"@NCommander this patch fixes the crash, at least, but probably not correctly:\n```diff\ndiff --git a/plugins/dwarfvet.cpp b/plugins/dwarfvet.cpp\nindex 46247bb8..604f399a 100644\n--- a/plugins/dwarfvet.cpp\n+++ b/plugins/dwarfvet.cpp\n@@ -135,8 +135,8 @@ AnimalHospital::AnimalHospital(df::building * building, color_ostream \u0026out) {\n     z = building-\u003ez;\n \n     // Determine how many spots we have for animals\n-    this-\u003elength = x2-x1;\n-    this-\u003eheight = y2-y1;\n+    this-\u003elength = x2-x1+1; // Note below\n+    this-\u003eheight = y2-y1+1;\n \n     // And calculate the hospital!\n     this-\u003ecalculateHospital(true, out);\n@@ -321,8 +321,8 @@ void AnimalHospital::calculateHospital(bool force, color_ostream \u0026out) {\n \n         spot_cur += building_offset_x;\n         /* Start marking! */\n-        for (int i = 0; i != building_height; i++) {\n-            for (int j = 0; j != building_length; j++) {\n+        for (int i = 0; i \u003c building_height; i++) {\n+            for (int j = 0; j \u003c building_length; j++) {\n                 spots_in_use[spot_cur+j] = true;\n             }\n \n```\nI'm not sure if the first chunk is necessary, but it looked wrong.","files":null},{"type":3,"author":{"id":"e297a1027662381a0f64cc7678ff9ed5f9b5f4e7"},"timestamp":1518795444,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NjI2OTQ1Mg==","github-url":"https://github.com/DFHack/dfhack/issues/1227#issuecomment-366269452"},"message":"Do you have an estimate for when the next release will be available, with the final version of the fix for this issue?","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1518800023,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NjI5MjcwNQ==","github-url":"https://github.com/DFHack/dfhack/issues/1227#issuecomment-366292705"},"message":"I'm hoping to get one out in a couple days, but no idea about a \"final\" fix. Those changes should stop it from crashing, but it might treat your animal hospital as 1x1 because of all the beds, so I think your best bet for now is to remove those.","files":null},{"type":3,"author":{"id":"e297a1027662381a0f64cc7678ff9ed5f9b5f4e7"},"timestamp":1518825437,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NjM5MjQ3Ng==","github-url":"https://github.com/DFHack/dfhack/issues/1227#issuecomment-366392476"},"message":"Why does having beds in my hospital make it 1x1?","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1518826486,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NjM5NTIyMg==","github-url":"https://github.com/DFHack/dfhack/issues/1227#issuecomment-366395222"},"message":"I don't know. I didn't write it. It looks to me like it's calculating the largest rectangle within the zone that doesn't have any buildings in it. It might end up as 1x6 or something.","files":null},{"type":3,"author":{"id":"e297a1027662381a0f64cc7678ff9ed5f9b5f4e7"},"timestamp":1518826745,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NjM5NTgxOQ==","github-url":"https://github.com/DFHack/dfhack/issues/1227#issuecomment-366395819"},"message":"That's so strange. Hospitals need beds and traction benches and tables.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1518827732,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NjM5ODAyOA==","github-url":"https://github.com/DFHack/dfhack/issues/1227#issuecomment-366398028"},"message":"You'd have to ask @NCommander. I could try to work around that restriction for beds, but I don't think animals would use them.","files":null},{"type":3,"author":{"id":"caeeef5ab1740b87bc95b5b84862558805f2ec08"},"timestamp":1518833445,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NjQwNzc5OA==","github-url":"https://github.com/DFHack/dfhack/issues/1227#issuecomment-366407798"},"message":"I'm alive. As far as I can tell, what's actually required to get something treated by the hospital is it's resting in a hospital zone. The fundamental problem with Animal Caretaker is animals never take the Rest job, and never end up in a hospital (I'll have to relook at my early notes, but there is an edge case that a tame CAN_THINK animal can actually end up being treated in vanilla. I discovered how Animal Caretaker works by experimenting with trolls, gm-editor, and a deep shaft).\n\nThis is probably a change in DF as it didn't crash when it tried to drop a unit on a bed back in 0.40 when I coded it; the array likely needs to figure out ineligible spots and simply dump them on the floor or figure out whatever magic is needed when a unit is properly \"in bed\" so to speak.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1518836604,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NjQxMTM5NA==","github-url":"https://github.com/DFHack/dfhack/issues/1227#issuecomment-366411394"},"message":"The second part of my patch fixes the crash. The building length or width is negative, which results in an infinite loop writing to increasing indices in a vector. I don't think that's a DF change.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1519272369,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NzU2MTE1NA==","github-url":"https://github.com/DFHack/dfhack/issues/1227#issuecomment-367561154"},"message":"The crash should be fixed. Feel free to open another report if you notice any other issues with that hospital. I haven't had much time to figure out what else could be wrong with it.","files":null},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1519272369,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTQ4NjE1MjM4NA=="},"status":2}]}