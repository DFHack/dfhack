{"version":1,"ops":[{"type":3,"author":{"id":"88b79c31fdfd52952dafcabb16168259734368cc"},"timestamp":1446455043,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1Mjk2MTc2Mg==","github-url":"https://github.com/DFHack/dfhack/issues/722#issuecomment-152961762"},"message":"Things that do a lot of indexing (e.g. lair) need to be in C++ for performance reasons.\nOther things like this:\n- lair\n- fixveins\n- fix-unit-occupancy (imho it should not be encorouged to be run auto-repeat, commands like these are FIXES, better to track down stuff that messes stuff up and leave this as sort-of last resort)\n- deramp\n- cleanedowned (this probably would be very slow in lua)\n- regrass\n\nGenerally if it is already slow imagine it being 10x slower.","files":null},{"type":3,"author":{"id":"f7b5a7930d0e1264ae1e4a774b03a7e78c2b7858"},"timestamp":1446458737,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1Mjk3NTk3NA==","github-url":"https://github.com/DFHack/dfhack/issues/722#issuecomment-152975974"},"message":"Hmm, that makes sense - I'll take them off the list.  I'd usually want to measure perf issues, but given that the existing implementation _works_ we can just leave well enough alone.\n\nCan I take it you agree in principle with the rest?","files":null},{"type":3,"author":{"id":"88b79c31fdfd52952dafcabb16168259734368cc"},"timestamp":1446460991,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1Mjk4NDU4MQ==","github-url":"https://github.com/DFHack/dfhack/issues/722#issuecomment-152984581"},"message":"I agree with the principle. Looking them over and seeing if it's possible (and/or hard) to port is very needed.\n\nI would say we would also gain performance, but in last dfhack versions something takes long even in scripts (do they all get run at startup?)","files":null},{"type":3,"author":{"id":"e6d3dafe479ac56fd29593e66f6fd7f028b46105"},"timestamp":1446491768,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1MzEyODkxMA==","github-url":"https://github.com/DFHack/dfhack/issues/722#issuecomment-153128910"},"message":"catsplosion shouldn't be hard for me to remake; it's not the first time I've made a script that forces pregnancy. Heck, I could make any male cats switch to female just so that they can give birth, too.\n\ndrybuckets also looks pretty simple.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1446500284,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1MzE2NTE1OQ==","github-url":"https://github.com/DFHack/dfhack/issues/722#issuecomment-153165159"},"message":"I agree with most of the current list, except for a few:\n- dwarfexport hasn't been supported since 0.40.01, maybe earlier, although it doesn't appear performance-dependent\n- cleanconst would be slow in large fortresses if it were written as a script (and since it's most useful in those fortresses, I'm not sure rewriting it is worth it)\n- fastdwarf iterates over every unit, every frame, which would be much slower in lua\n- flows and tubefill iterate over the entire map, which can be really slow in scripts. changevein would also be slower, although not as much.\n\n@warmist: many \"fix\" scripts are run on repeat by many users anyway (fix/stuck-doors, fix/build-location, fix/stable-temp, etc., although a few of those are outdated). fix-unit-occupancy doesn't encourage this, as far as I can tell; it just offers it as a possibility (and runs at appropriate times).\n\nFrom a development perspective, I wouldn't say that scripts are more portable across versions - any structure changes are easy to catch when building plugins that haven't been updated, but it's difficult to test all scripts, let alone each line of every script, so errors often go unnoticed after structure changes.\n\nRegarding filesystem hierarchy, the new `type` command should make it more clear where commands are implemented (although as long as they're in the hack/scripts directory, it is still easier to locate scripts).","files":null},{"type":2,"author":{"id":"f7b5a7930d0e1264ae1e4a774b03a7e78c2b7858"},"timestamp":1446513207,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDUyNjg0OTc3"},"title":"Some plugins could be converted to scripts","was":"Some plugins could be converted to scripts"},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1446518227,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ1MjcyODUyMg=="},"added":["idea"],"removed":[]},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1446848037,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NDU1ODQzOQ==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-154558439"},"message":"I meant that your suggestion, making a clone of the scripts repo in hack/scripts, is a bad idea for core developers since CMake will overwrite things in that directory.\nI actually do think this would work, though. I'd probably keep some of my work-in-progress scripts in a separate repo, but a single repo would probably be easier to deal with for core and script devs.","files":null},{"type":3,"author":{"id":"f7b5a7930d0e1264ae1e4a774b03a7e78c2b7858"},"timestamp":1446850490,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NDU2ODY0MA==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-154568640"},"message":"Ah, I see what you mean.  Yes, you'd need to have one install for the core development install target and another for the script development if you wanted to do this.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1446853039,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NDU3NzYzNg==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-154577636"},"message":"Having the scripts submodule in the DFHack source tree (in the current location of the scripts directory) should work too - you just wouldn't be able to combine the two approaches.","files":null},{"type":3,"author":{"id":"f7b5a7930d0e1264ae1e4a774b03a7e78c2b7858"},"timestamp":1446959799,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NDc3NjQwNw==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-154776407"},"message":"#695 has a lot of relevant discussion, and proposes a new cmake target `install-scripts` without non-cmake dependencies for script authors.  it also covers several useful methods for dealing with scripts, including alternative paths.","files":null},{"type":3,"author":{"id":"f7b5a7930d0e1264ae1e4a774b03a7e78c2b7858"},"timestamp":1447040570,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NDkxMDk1NA==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-154910954"},"message":"Dealing with this update is way harder than it needs to be, because it's so hard to tell what's happening when `NEWS` and `dfhack.init` are incomplete due to so much being pulled from 3rdparty repos.  Except at the same time only some things in those repos are included...\n\nSo my alternative proposal to deal with this issue is:  **Just put everything in this repo, manually add 3rdparty scripts, and release often**.  People will either start working in clones of this repo, in which case updates can be fairly coherent, or their work is added in a coherent way anyway.\n\nThoughts?","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447043595,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NDkxODIwMQ==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-154918201"},"message":"I think the DFHack repo is large and more complicated for script authors to work with (e.g. we do all work on the develop branch, so new branches have to be based on that). It would be easier for core devs to work with, but it sounds like the exact approach we were using before the third-part script additions, which didn't seem to work as well (although the current system doesn't seem to have improved things much).","files":null},{"type":3,"author":{"id":"f7b5a7930d0e1264ae1e4a774b03a7e78c2b7858"},"timestamp":1447047612,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NDkzODE3MQ==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-154938171"},"message":"Yeah, that's the logic of my main proposal - working down the list below, trying to find something that works reasonably well for everyone.\n\nEveryone wants DFHack to do all the things they want it to do.  Core devs would additionally like it all to be in the main repo, with nice principles like good code style and less duplication.  Script authors (who aren't DFHack contributors) are just writing scripts that do the things they want, and sharing them.\n\nThe problem is this mismatch where nobody minds putting stuff in DFHack, but most people can't be bothered.  So far:\n1. Hoping people submit stuff hasn't worked\n2. Adding it for them (I've been doing this for a while) doesn't scale well\n3. Adding submodules causes various problems\n4. Making it easier to add stuff (scripts repo) will help **if** the prolific scripters take it up\n\nSo for (4), if we can get Lethosor and Roses to actively support it, enough others will probably pick it up  too (1) that a few people should be able to add in the rest (2).","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1452400322,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE3MDMxMzc3NQ==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-170313775"},"message":"I'm leaning towards the single scripts submodule idea myself. I realize this hasn't seen a lot of activity, but we're mostly dealing with the new version at the moment. I'll look into this when I get a chance.","files":null},{"type":3,"author":{"id":"f7b5a7930d0e1264ae1e4a774b03a7e78c2b7858"},"timestamp":1452414865,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE3MDMyNTg5OA==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-170325898"},"message":"No rush; getting things working again is higher priority and there's not much script development in the interim anyway.","files":null},{"type":3,"author":{"id":"be523fe0f95fc478bda36c722e6f106f8f7a41b5"},"timestamp":1457868411,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE5NTkzOTIxOA==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-195939218"},"message":"I've thought about it and I agree.\n\n@lethosor I'm not sure I understood the problem you were talking about with overwriting files.\n\nPlan:\n- [ ] Make New Scripts Repo\n- [ ] Inline all old scripts and all submodule scripts into it\n- [ ] Replace scripts folder with new scripts submodule (git subtree might make more sense)\n- [ ] Maybe provide a separate installer in case scripters want a convenient \"install scripts\" command","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1457870888,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE5NTk0NjU0Mg==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-195946542"},"message":"That's what I was thinking too.\nAbout overwriting files, my concern was that cloning the scripts repo into hack/scripts in the DF tree would cause issues if someone later tried to build and install DFHack in the same tree. Hopefully nobody will do that, but we could add a cmake sanity check of some kind to prevent it (e.g. check for hack/scripts/.git).","files":null},{"type":3,"author":{"id":"f7b5a7930d0e1264ae1e4a774b03a7e78c2b7858"},"timestamp":1458136324,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE5NzM0MTQ3NQ==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-197341475"},"message":"#823 is now blocked waiting on this change to make some atomic changes to script docstrings.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1458166806,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE5NzU4MjE5OA==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-197582198"},"message":"I've started work on https://github.com/DFHack/scripts, which currently just contains scripts from this repo. I suspect combining the history of the other submodules would be more complicated, so I'll probably end up just copying over the latest versions of the scripts we care about.\n(That repo currently just has a `master` branch, which might be easier for script devs to deal with, and is consistent with how df-structures, clsocket, stonesense, and other repos are set up.)","files":null},{"type":3,"author":{"id":"be523fe0f95fc478bda36c722e6f106f8f7a41b5"},"timestamp":1458218418,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE5Nzg2MDI1Nw==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-197860257"},"message":"Yeah, that makes sense. I'd say we can afford to lose the history.","files":null},{"type":3,"author":{"id":"013c453d589d8f012d01be6d80bd8eb8ae5d8fe2"},"timestamp":1458220469,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE5Nzg3NDQyMw==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-197874423"},"message":"It is not hard to keep the history, though, if you want it: http://stackoverflow.com/a/21495718.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1458251604,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE5ODEwMDM3Mg==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-198100372"},"message":"We aren't using every file from every repo, though, so we'd need to filter out the history of unused files from each repo.","files":null},{"type":3,"author":{"id":"be523fe0f95fc478bda36c722e6f106f8f7a41b5"},"timestamp":1458398945,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE5ODcxNjMwNg==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-198716306"},"message":"\u003e We aren't using every file from every repo\n\nThat does complicate things. It means we can't just have 3rd party scripters fork the repo and just pull in whatever changes they make without complicated filtering and rebasing. I'm not sure what the right answer is.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1458399336,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE5ODcxNzcyNw==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-198717727"},"message":"I'm thinking of just including the scripts we use in DFHack/scripts. People can fork it to work on scripts in it, or use other methods for working on scripts that aren't, so I'm not quite sure what the history issue is.\nIt's possible to set up additional script search paths, although there isn't a good interface for it right now (I'm just adding them through `lua` in dfhack.init, personally).","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1465945572,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDY5MjU2MjA2Ng=="},"added":["organization"],"removed":[]},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1465950234,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDIyNjA1NTQzMw==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-226055433"},"message":"I've finished the migration, I think. Looks like things are working to me.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1467850621,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDIzMDk0NTI0NQ==","github-url":"https://github.com/DFHack/dfhack/issues/723#issuecomment-230945245"},"message":"This is done!","files":null},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1467850621,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NzE1MTAwMzA0"},"status":2}]}