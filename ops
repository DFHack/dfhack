{"version":1,"ops":[{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1497381159,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMwODIxODc1Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1109#issuecomment-308218753"},"message":"Oh, one of those popups. I thought you mean a Lua dialog box.\n\nThe reason for the \"pseudo arena mode\" is that create-unit switches into arena mode temporarily to create a unit. The problem is that after it does this, it tries to press 'c' to open the creature creation screen, which doesn't work when a popup announcement is open.\n\nIt looks like checking `df.global.world.status.popups` would fix this (it has elements only when a popup announcement is visible). Of course, the script should be changed to actually check that the right screen is open as well.","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1497381170,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDExMjIwMDg1NDk="},"added":["bug"],"removed":[]},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1497399252,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTEyMjM5NjE2OA=="},"status":2},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1497399294,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMwODI4MzcxMA==","github-url":"https://github.com/DFHack/dfhack/issues/1109#issuecomment-308283710"},"message":"Okay, I've fixed the issue with popup announcements. I've also improved the script so that any unhandled errors in the future will still restore the original game mode properly.","files":null}]}