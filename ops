{"version":1,"ops":[{"type":3,"author":{"id":"5221f59e75ea9db114593bbdfb180b7354aef9ed"},"timestamp":1478575108,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI1OTAzNDQ1Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1015#issuecomment-259034453"},"message":"There's probably something that fails to consider the possibility that the DFHack console might not exist, which is the case when using [PRINT_MODE:TEXT].\n\nAlso, we don't have the look at init.txt - we can access the configuration settings directly from memory, and we actually _do_ have special logic for TEXT display mode (which apparently isn't enough).","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1478575999,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI1OTAzNjM1NA==","github-url":"https://github.com/DFHack/dfhack/issues/1015#issuecomment-259036354"},"message":"This worked the last time I checked, although that was probably before 0.42. What DFHack build/architecture are you using?","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1478576006,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDg1MDkzNDI1NA=="},"added":["crash/hang"],"removed":[]},{"type":3,"author":{"id":"3a91ba1080f18f9e749dfdfe82d0df9818b001dc"},"timestamp":1478619676,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI1OTE3MTA4Ng==","github-url":"https://github.com/DFHack/dfhack/issues/1015#issuecomment-259171086"},"message":"im using the newest alpha on (the box i sshed into)linux(spec. ubuntu 16.04) 64 bit. Thanks.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1478620034,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI1OTE3Mjc0Mg==","github-url":"https://github.com/DFHack/dfhack/issues/1015#issuecomment-259172742"},"message":"I'm assuming you mean 0.43.05-alpha1, since that's the only one with 64-bit support, but it's helpful if you can specify the version. You'd be surprised at how many people think they're using the newest version when they aren't.\n\nI'll try to look into this soon, hopefully in the next couple days (unless someone beats me to it).","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1478620310,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI1OTE3NDE4Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1015#issuecomment-259174183"},"message":"I tested briefly on OS X - gui/load-screen works, and worldgen didn't crash for me. It's possible that this is related to some missing offsets on 64-bit Linux, although I don't remember what those are exactly.\n\nWas DFHack crashing on startup? If not, the contents of stderr.log probably aren't as relevant, since those commands would (mostly) have been run on startup. Have you been able to narrow it down to a specific script?","files":null},{"type":3,"author":{"id":"3a91ba1080f18f9e749dfdfe82d0df9818b001dc"},"timestamp":1478634424,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI1OTIzOTQyMw==","github-url":"https://github.com/DFHack/dfhack/issues/1015#issuecomment-259239423"},"message":"I can try again later, but it seemed to be the following:\n#enable gui/extended-status\n#view-item-info enable\n#gui/load-screen enable\n these seem to be gui related, ill try to downgrade to 32 bit in the meantime.  Also im on 43.05-alpha1. Dwarf fortress crashes when i go to generate a new world. from the main menu i select start new world and it starts loading and displaying alot of ascii characters, it crashes during the ascii character part. Sorry if that doesnt make sense.","files":null},{"type":3,"author":{"id":"3a91ba1080f18f9e749dfdfe82d0df9818b001dc"},"timestamp":1478634505,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI1OTIzOTgwNA==","github-url":"https://github.com/DFHack/dfhack/issues/1015#issuecomment-259239804"},"message":"it wasn't working at all when i tried again today, but now it worked after doing nothing. Literally tabbed out of the putty session and tabbed back in and it seems to be working. Might be memory related then, huh.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1482875653,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI2OTM4ODAwOA==","github-url":"https://github.com/DFHack/dfhack/issues/1015#issuecomment-269388008"},"message":"Is this still occurring in alpha3?","files":null},{"type":3,"author":{"id":"a2b183d78b1e948a289ff5f1b6ebc4d6743ac683"},"timestamp":1485797463,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI3NjEyOTAxNQ==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-276129015"},"message":"exportlegends had a similar crash for me on Linux 64-bit (Debian-based) in alpha 4. It seems to have been in the maps part, though. Should I post my save and details here or open a new issue?","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1485797834,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI3NjEzMDg0Ng==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-276130846"},"message":"Is it possible that it's related to #958? Does it crash if you don't use the script? Even better, does it crash if you export all of the maps without DFHack? (I think there are only 10-20, but if there are more than I'm remembering, don't feel a need to export all of them manually.)\n\nEdit: sorry, #958 is probably not it if you're using 64-bit DF.","files":null},{"type":3,"author":{"id":"a2b183d78b1e948a289ff5f1b6ebc4d6743ac683"},"timestamp":1485800819,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI3NjE0NzEzOA==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-276147138"},"message":"Hmm, it could be possible. I'd have to have a bit more time to dig into that thread and try out what's in there to be sure. \nI just went through all of the maps and exported one by one and it was fine. Then I moved those .bmps into another folder and tried with dfhack and got this (which is what I was getting before):\n```\n[DFHack]# exportlegends maps\n    Exporting:  Standard biome+site map map\n[DFHack]# Segmentation fault\n```\n\nEdit: I was going to mention the 64-bit Linux as probably ruling out #958. Glad to know I'm not crazy.","files":null},{"type":3,"author":{"id":"a2b183d78b1e948a289ff5f1b6ebc4d6743ac683"},"timestamp":1485886320,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI3NjQ0NDMzMQ==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-276444331"},"message":"A newly-generated world does the same thing. Pending more testing when I have some more time.\nHere's the original save: http://dffd.bay12games.com/file.php?id=12683","files":null},{"type":3,"author":{"id":"d7add89209e2ce64c8ddb8b019901d5691507b59"},"timestamp":1486002088,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI3Njg0ODQwNA==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-276848404"},"message":"@ebrayton when you're running the export, open a task manager/resource monitor and just verify how much memory DF is using compared to what your total available is. Your system is going to be reserving memory for other things, and may still be limiting the amount of memory DF can use so it's probably worth checking out regardless of being on x64 and linux.","files":null},{"type":3,"author":{"id":"a2b183d78b1e948a289ff5f1b6ebc4d6743ac683"},"timestamp":1486531123,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI3ODIzMTg1Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-278231853"},"message":"@sparkybear Thanks. I just tried it with the system monitor open. Before I run exportlegends it shows about 1.6GB in use. `exportlegends maps` fails as above almost instantaneously and I don't see any spike (or even blip) in memory usage. I do only have 4GB total in this old machine, though.\n\n`exportlegends all` gives varying errors once it gets to generally the same area. That is, toward the beginning of the export maps section.\n\nLet me know if there's anything else I should try or if it's probably just my system.","files":null},{"type":3,"author":{"id":"d7add89209e2ce64c8ddb8b019901d5691507b59"},"timestamp":1486535868,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI3ODI0MjEzNA==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-278242134"},"message":"That's your problem. You are running out of memory on your machine. I don't know if there's any way we can change how the legends export works, but basically, everything you are exporting is being dumped into memory before being written to a file. \n\nThis is okay for small worlds, but large worlds could have 1 GB of data added to memory specifically from the legends export. When you leave the Legends view, DF will clean out those objects and it's not an issue for the rest of the game, but if you are exporting all of the legends stuff, it becomes a problem.\n\nSo, solutions for you: \n\nauto hotkey script do basically do the export by hand. Once you are finished exporting a category (say maps), have the script go back to the main DF menu, then re-open legends and then export the next map.\n\nGet more RAM for your PC, you are using nearly 100% between DF and your OS if you only have 4GB. \n\nLastly, we could try to get someone to work on the feature the essentially do what the script did, or find a way to clear objects out of memory after they have been exported to a file so that we are freeing up space every k number of objects.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1486564195,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI3ODM0MzM5Nw==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-278343397"},"message":"Forgot to ask earlier - is there anything at the bottom of stderr.log?\n\nSince this is on 64-bit Linux, I think it's unlikely that you're running out of memory. Even if you run out of physical memory, DF should start swapping instead of crashing (unless you run out of swap space too).","files":null},{"type":3,"author":{"id":"d7add89209e2ce64c8ddb8b019901d5691507b59"},"timestamp":1486569667,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI3ODM3MDIxMg==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-278370212"},"message":"He's only running 4GB total on his machine.\n\nOn Wed, Feb 8, 2017, 6:29 AM Lethosor \u003cnotifications@github.com\u003e wrote:\n\n\u003e Forgot to ask earlier - is there anything at the bottom of stderr.log?\n\u003e\n\u003e Since this is on 64-bit Linux, I think it's unlikely that you're running\n\u003e out of memory. Even if you run out of physical memory, DF should start\n\u003e swapping instead of crashing (unless you run out of swap space too).\n\u003e\n\u003e —\n\u003e You are receiving this because you were mentioned.\n\u003e Reply to this email directly, view it on GitHub\n\u003e \u003chttps://github.com/DFHack/dfhack/issues/1017#issuecomment-278343397\u003e, or mute\n\u003e the thread\n\u003e \u003chttps://github.com/notifications/unsubscribe-auth/AHQpcTcfU5C0fA-Zdql_CABWkC4528Mwks5radFlgaJpZM4KxBez\u003e\n\u003e .\n\u003e","files":null},{"type":3,"author":{"id":"d7add89209e2ce64c8ddb8b019901d5691507b59"},"timestamp":1486570312,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI3ODM3MzQyNQ==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-278373425"},"message":"Sorry, hit reply too early. TheOS will reserve about 2GB for critical\nfunctions and then allow the rest to be allocated to whatever needs it. It\nshould do that intelligently and should take advantage of the swap\npartition as you mentioned. Regardless of the architecture, the OS is still\nreserving most of the memory available on the system and can't allocate a\nlarger address space for DF with that limitation. DF could also have issues\nof not being able to read and write to the swap space quickly enough to\nwork around the limitation of the system.\n\nOn Wed, Feb 8, 2017, 6:29 AM Lethosor \u003cnotifications@github.com\u003e wrote:\n\n\u003e Forgot to ask earlier - is there anything at the bottom of stderr.log?\n\u003e\n\u003e Since this is on 64-bit Linux, I think it's unlikely that you're running\n\u003e out of memory. Even if you run out of physical memory, DF should start\n\u003e swapping instead of crashing (unless you run out of swap space too).\n\u003e\n\u003e —\n\u003e You are receiving this because you were mentioned.\n\u003e Reply to this email directly, view it on GitHub\n\u003e \u003chttps://github.com/DFHack/dfhack/issues/1017#issuecomment-278343397\u003e, or mute\n\u003e the thread\n\u003e \u003chttps://github.com/notifications/unsubscribe-auth/AHQpcTcfU5C0fA-Zdql_CABWkC4528Mwks5radFlgaJpZM4KxBez\u003e\n\u003e .\n\u003e","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1486579022,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI3ODQyMDU3MQ==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-278420571"},"message":"Yes, but DF shouldn't crash unless the OS runs out of memory *and* swap space. In that case, there might be something that shows up in stderr.log. @ebrayton, have you seen anything there?","files":null},{"type":3,"author":{"id":"a2b183d78b1e948a289ff5f1b6ebc4d6743ac683"},"timestamp":1486581504,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI3ODQzMjI4Nw==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-278432287"},"message":"Just to clarify, because I realize that I might've been unclear: 1.6 GB total was in use by the system and DF once in legends mode.\n\nAlso, when I do `exportlegends all`, the total usage increases as it goes along, from 1.6 GB up to 75% of what I have, and then when it gets to the `maps` portion, it dies. So, given that it's fine using more memory for other aspects, it's suspect that it'd die so suddenly when I just do `maps`.\n\n@lethosor There is nothing remarkable at the bottom of stderr.log. The last 5 lines are:\n\n```\nInvoking: gui/load-screen enable\n\u003cvtable-address name='viewscreen_movieplayerst' value='0x7ffff6db9670'/\u003e\nInvoking: gui/prerelease-warning\nloaded map in prerelease build\nInvoking: exportlegends maps\n```\n\n---\n\nI don't know if this is helpful or just a red herring (or it actually running out of memory), but when I do `all`, it goes fine until this point (I added `keys` and `screen` print statements to the `gui.lua`):\n```\n\u003cviewscreen_legendsst: 0x7fff848ded30\u003e\n1                      \t = 238\n\u003cviewscreen_legendsst: 0x7fff848ded30\u003e\n1                      \t = 28\n\u003cviewscreen_legendsst: 0x7fff848ded30\u003e\n1                      \t = 6\n\u003cviewscreen_legendsst: 0x7fff848ded30\u003e\n1                      \t = 240\n    Exporting:  Standard biome+site map map\n\u003cviewscreen_export_graphical_mapst: 0x7fff17055a40\u003e\n1                      \t = 1\n[DFHack]# The futex facility returned an unexpected error code.Aborted\n```\nSimilarly no remarkable lines at the end of stderr.log on that run.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1492987018,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI5NjQ5Mzk1Ng==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-296493956"},"message":"I haven't been able to reproduce this. Let me know if it's still occurring in 0.43.05-beta2 or newer.","files":null},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1492987020,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTA1MzkxMjM2MA=="},"status":2},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1498065459,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxMDE0NjUwMg==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-310146502"},"message":"Okay, I'm getting a crash in 0.43.05-r1 with exportlegends. ~~I think I know what the problem is (the map export screen _closes_ after exporting one map now, so any attempt to access that screen later crashes). I'll try to fix it, but that part of the script is not very clear, so the fix may involve rewriting it.~~","files":null},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1498065459,"metadata":{"github-id":"MDEzOlJlb3BlbmVkRXZlbnQxMTMzMzMzMTc4"},"status":1},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1498065678,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxMDE0NzQxNg==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-310147416"},"message":"That seems to be the case in 0.43.03 too, though. I can't imagine why it would work in 0.43.03 at all, but maybe it's possible.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1498067369,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxMDE1NTMzNQ==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-310155335"},"message":"Also, the layout for viewscreen_export_graphical_mapst is wrong:\n```xml\n        \u003cint32_t name='rgb_buffer' comment='pointer to allocated buffer'/\u003e\n```\n(int32_t? Really?)","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1498068862,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxMDE2MTk3NQ==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-310161975"},"message":"It looks like the only problem was `rgb_buffer`'s type. Fixing that means that moving the list cursor doesn't mess with in_export or (maybe) numtiles_map_height, which also fixed a crash I ran into when trying to export one map in DF after setting sel_idx.","files":null},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1498278249,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTEzNzM1MTQ2NA=="},"status":2},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1498278276,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxMDgxMzA5NQ==","github-url":"https://github.com/DFHack/dfhack/issues/1017#issuecomment-310813095"},"message":"DFHack/df-structures@67f9e61","files":null}]}