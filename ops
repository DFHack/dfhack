{"version":1,"ops":[{"type":1,"author":{"id":"f7b5a7930d0e1264ae1e4a774b03a7e78c2b7858"},"timestamp":1465953623,"metadata":{"github-id":"MDU6SXNzdWUxNjAzMTk0MTI=","github-url":"https://github.com/DFHack/dfhack/issues/947","origin":"github"},"title":"Improve \"help $scriptname\"","message":"The `help` command (aliases `man`, `?`) could work much more effectively with scripts.  At the moment, it doesn't know anything about script documentation beyond the leading comment.  Using the more recent in-script documentation would be a substantial improvement.\n\nThe relevant code is at https://github.com/DFHack/dfhack/blob/master/library/Core.cpp#L256\nPsudeocode diff, because I can't write C++, looks like\n\n```\n+ if is lua script and \"[==== and \"]====]\" are tokens:\n+     return text between tokens\n+ if ruby script and \"=begin\" and \"end\" are tokens:\n+     return text between tokens\n  if find_initial_comment():\n      return comment\n  return \"No help found\"\n```\n\nIt's a pretty simplistic text-extraction trick, but that's how the HTML gets built and it all seems to work there!  Simply work out which of the two token sets should be used, and print the text between them if the tokens are present.","files":null}]}