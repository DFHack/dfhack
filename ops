{"version":1,"ops":[{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1511812871,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDEzNjAwMTc3Nzg="},"added":["bug"],"removed":[]},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1511812871,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDEzNjAwMTc3ODE="},"added":["lua"],"removed":[]},{"type":3,"author":{"id":"33f07099e648cf46b8ff42f17d3bc610247bfb4b"},"timestamp":1529441742,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM5ODU0MjY0NA==","github-url":"https://github.com/DFHack/dfhack/issues/1171#issuecomment-398542644"},"message":"I actually exploited no-copy behavior and made the list read text values every frame from the backing structure using metamods. Is the trashing feature or bug?","files":null},{"type":3,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1529442726,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM5ODU0NzU1Mg==","github-url":"https://github.com/DFHack/dfhack/issues/1171#issuecomment-398547552"},"message":"Unless it's very clearly documented it's a bug, as there's no reasonable reason to expect it either to use the list passed in for its internal use, nor for it to restructure it.\nIn my view a version of the function that explicitly uses the list given to it could be created for those who want it (setReferencedChoices?), while the standard version ought to work without weird side effects.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1529465581,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM5ODYxMzU1Nw==","github-url":"https://github.com/DFHack/dfhack/issues/1171#issuecomment-398613557"},"message":"I don't really like the setReferencedChoices name (or idea) much. It's not consistent with other widgets, for one thing, and the name just doesn't make sense to me without context.\n\nBesides, wouldn't adding strings to the input list later fail with the current implementation? You'd have to structure added items the same way as what List uses internally, which isn't necessarily consistent with the original input list. I think setChoices should just copy the table (not sure if we have a table-copying utility function).\n\n@suokko nearly every field in labels (and therefore list entries) can be a function instead of a primitive. See gui/confirm-opts for an example of providing a `pen` callback for list items. I think that should be cleaner than dealing with metamethods to change item properties in most cases.","files":null},{"type":3,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1529478227,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM5ODY0NjA3Nw==","github-url":"https://github.com/DFHack/dfhack/issues/1171#issuecomment-398646077"},"message":"Adding strings later fails, since the structure has been reworked.\nAnd yes, adding a new operation isn't a good idea. If you want to have direct access to the internals you can achieve that by explicitly accessing the internals. You just have to locate where the reworked structure is anchored and have your manipulator reference that location.\n\nI think the \"copyall\" function should work to make the copy for this case, although \"utils.clone\" should be able to do the job as well.","files":null},{"type":3,"author":{"id":"33f07099e648cf46b8ff42f17d3bc610247bfb4b"},"timestamp":1529498279,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM5ODczMzc1NA==","github-url":"https://github.com/DFHack/dfhack/issues/1171#issuecomment-398733754"},"message":"@lethosor I agree. There is reason why I choose word 'exploit'. I felt it was wrong but it seemed easiest because I had some trouble propogatting pen and string changes correctly. As code was just a prototype I decided to use metamod hack which was simple. I  wanted to check if there wasn't a surprising reason to take reference instead of built a new table.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1529501889,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM5ODc1MTI4Nw==","github-url":"https://github.com/DFHack/dfhack/issues/1171#issuecomment-398751287"},"message":"I think it's expected that the table passed in won't be used later - e.g. in many cases it's a table literal or something generated/returned by a function. That may not be a reasonable expectation.\n\nAre you able to do the things you want with callbacks in the choice list? e.g.\n```lua\n{text = function() return tostring(math.random()) end}\n```","files":null},{"type":3,"author":{"id":"33f07099e648cf46b8ff42f17d3bc610247bfb4b"},"timestamp":1529502125,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM5ODc1MjU2Ng==","github-url":"https://github.com/DFHack/dfhack/issues/1171#issuecomment-398752566"},"message":"I'm already checking if my fix works with dfhack script. If my own script\nbreaks it doesn't really matter.\n\nOn Wed, Jun 20, 2018 at 4:38 PM, Lethosor \u003cnotifications@github.com\u003e wrote:\n\n\u003e I think it's expected that the table passed in won't be used later - e.g.\n\u003e in many cases it's a table literal or something generated/returned by a\n\u003e function. That may not be a reasonable expectation.\n\u003e\n\u003e Are you able to do the things you want with callbacks in the choice list?\n\u003e e.g.\n\u003e\n\u003e {text = function() return tostring(math.random()) end}\n\u003e\n\u003e â€”\n\u003e You are receiving this because you were mentioned.\n\u003e Reply to this email directly, view it on GitHub\n\u003e \u003chttps://github.com/DFHack/dfhack/issues/1171#issuecomment-398751287\u003e, or mute\n\u003e the thread\n\u003e \u003chttps://github.com/notifications/unsubscribe-auth/AAG8yBZ5D25wkJln3Xn5jCeYzqiCvSYdks5t-lBHgaJpZM4PluHF\u003e\n\u003e .\n\u003e","files":null},{"type":3,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1529502536,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM5ODc1NDc5MA==","github-url":"https://github.com/DFHack/dfhack/issues/1171#issuecomment-398754790"},"message":"I don't find an expectation that the list would be a throwaway list to be reasonable. After all, the report was generated as a result of attempting to update my list and get that update to be reflected by the table, such as a user adding or removing items to a list.\nIt's true that in many cases there's a need for an additional list to map selections back to items, but sometimes the strings can be used to do the selection mapping directly.\n\nSince the report was made quite some time ago I don't remember if the trigger was trying to sort an updated list (thus blowing up on comparing strings with the tables the function replaced entries with), or whether setChoices barfed when fed an updated list as it couldn't process its own manipulated list contents.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1529503315,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM5ODc2MDQ5Mg==","github-url":"https://github.com/DFHack/dfhack/issues/1171#issuecomment-398760492"},"message":"setChoices can definitely handle the choices it creates.","files":null},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1530593106,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTcxMzAzMjU3MQ=="},"status":2}]}