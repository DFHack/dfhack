{"version":1,"ops":[{"type":3,"author":{"id":"0541b7dd92e4d9285c31215454cda686ef6b8a4e"},"timestamp":1535228229,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQxNTk5Mzk1Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1399#issuecomment-415993953"},"message":"The plugin that actually does this is cleanowned. Presumably LNP is setting up a repeating trigger to run cleanowned periodically.\n\nAccording to the [wiki](http://dwarffortresswiki.org/index.php/DF2014:Miasma) a dropped food item can arise if someone who was eating something is interrupted; such items cannot be picked up because they're marked as \"owned\", which prevents them from being stored away except by the owner, who will never do so. (See [reported bug on Mantis](http://www.bay12games.com/dwarves/mantisbt/view.php?id=1299). \n\nIt's possible that meals that are in the process of being eaten are not distinguishable from meals that have been abandoned; if so, cleanowned should test for that and avoid confiscating meals that are in the process of being eaten as opposed to those that have been abandoned.","files":null},{"type":6,"author":{"id":"0541b7dd92e4d9285c31215454cda686ef6b8a4e"},"timestamp":1535228229,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDEyMzE5NDUxMg=="},"target":"3b6f9c1a2d9820cc1599ea43bd2e259c0afa4478082b03f10a200ecf0c80853e","message":"The plugin that actually does this is cleanowned. Presumably LNP is setting up a repeating trigger to run cleanowned periodically.\n\nAccording to the [wiki](http://dwarffortresswiki.org/index.php/DF2014:Miasma) a dropped food item can arise if someone who was eating something is interrupted; such items cannot be picked up because they're marked as \"owned\", which prevents them from being stored away except by the owner, who will never do so. (See [reported bug on Mantis](http://www.bay12games.com/dwarves/mantisbt/view.php?id=1299).)\n\nIt's possible that meals that are in the process of being eaten are not distinguishable from meals that have been abandoned; if so, cleanowned should test for that and avoid confiscating meals that are in the process of being eaten as opposed to those that have been abandoned.","files":null},{"type":6,"author":{"id":"0541b7dd92e4d9285c31215454cda686ef6b8a4e"},"timestamp":1535228318,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDEyMzE5NDYyMQ=="},"target":"3b6f9c1a2d9820cc1599ea43bd2e259c0afa4478082b03f10a200ecf0c80853e","message":"The plugin that actually does this is cleanowned. Presumably LNP is setting up a repeating trigger to run cleanowned periodically.\n\nDropped food items can arise even if you have forbidden your militia from carrying food. According to the [wiki](http://dwarffortresswiki.org/index.php/DF2014:Miasma), an owned, dropped food item can arise if someone who was eating something is interrupted. Such items cannot be picked up because they're marked as \"owned\", which prevents them from being stored away except by the owner, who will never do so. (See [reported bug on Mantis](http://www.bay12games.com/dwarves/mantisbt/view.php?id=1299).) \n\nIt's possible that meals that are in the process of being eaten are not distinguished from meals that have been abandoned; if so, cleanowned should test for that and avoid confiscating meals that are in the process of being eaten as opposed to those that have been abandoned.","files":null},{"type":5,"author":{"id":"0541b7dd92e4d9285c31215454cda686ef6b8a4e"},"timestamp":1535228492,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDE4MDkxMjM0NTE="},"added":["possible bug"],"removed":[]},{"type":3,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1549880125,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ2MjI3NjAyNQ==","github-url":"https://github.com/DFHack/dfhack/issues/1399#issuecomment-462276025"},"message":"Looking at the code of cleanowned and comparing with a current confiscated meal in my fortress, I think checking that the flags.in_job flag of the item isn't set ought to be sufficient to block confiscation of food items in the process of being eaten. The meal in my fortress is on the ground (in a stockpile) and is marked as being in a job, while the resident whose item has been confiscated has the \"Eat\" job.\n\nI'm not completely sure such a change might not have undesirable side effects, though. Dropped militia rations in the process of being hauled to the militia member's room would not be confiscated, for instance, but should be confiscated the next time, unless it was stored in a chest (which the code might want to look for).\n\nA further, unrelated, comment after looking at the code is that \"scattered\" cleaning might want to raid cabinets as well (which happens with the 'x' or 'X' arguments for worn items), and that confiscation of worn worn items (yes, English is weird) might be undesirable if there are no replacements available (such as those worn, but hard to get, underwear).","files":null}]}