{"version":1,"ops":[{"type":1,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1514404839,"metadata":{"github-id":"MDU6SXNzdWUyODQ3ODY4NTA=","github-url":"https://github.com/DFHack/dfhack/issues/1209","origin":"github"},"title":"Ruby codegen can't handle vmethods that return std::string's","message":"enabler::GetKeyDisplay() is new in https://github.com/DFHack/df-structures/commit/559c23baa06f68d62a0ba674669389273bfcfb97#diff-cee8bfd3ccf90f6603c9dc081d54d943\n\nThis produces a `vmethod unkret DFHack.vmethod_call(self, 0, InterfaceKey.int(arg0))` message in ruby/codegen.pl, and it looks like the generated function calls `rb_dfget_rtti_classname`, which can crash. The output below is from 64-bit OS X 0.44.03; note that the returned value for \"2\" is 0x101ee35c0, which is the address of `enabler`.\n```\n[DFHack]# rb puts df.enabler.GetKeyDisplay 2\n4327355840\n[DFHack]# rb puts df.enabler.GetKeyDisplay 3\n(segfault)\n```","files":null}]}