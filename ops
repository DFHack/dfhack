{"version":1,"ops":[{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1541314413,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQzNTY0Njc0Mg==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-435646742"},"message":"Can you reproduce it with DFHack disabled entirely?","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1541343980,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQzNTY3NzE1OA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-435677158"},"message":"No, I just confirmed from a fresh installation, with vanilla dwarf fortress I can save my game without issue, when I install dfhack and try to save that is when it starts crashing. \n\nDoes that SIGABRT mean anything to you? It's pretty vague about the error but my understanding is that it often happens with memory corruption. If there's any tips you can give me to get more information I'd be happy to try","files":null},{"type":3,"author":{"id":"5221f59e75ea9db114593bbdfb180b7354aef9ed"},"timestamp":1541469317,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQzNjEwMzg3OQ==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-436103879"},"message":"SIGABRT is typically generated from assertion errors, sanity checks guarding against invalid/impossible situations - while heap corruption is certainly **one** such situation, it's definitely not the only one.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543436659,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MjU5MTk1NA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442591954"},"message":"@Queuecumber sorry for the delay here. Can you run `unload -all` before loading the game and see if that changes anything?","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543459922,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MjY4NzIyMg==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442687222"},"message":"@lethosor No problem, and interestingly enough that did fix the crash. \n\nI first verified that on a fresh start of dfhack, the crash still happens on save. Then I used the `unload -all` command, and I was able to save the world successfully.\n\nWhat are the repercussions of running that command?","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543462105,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MjY5MzM0Mg==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442693342"},"message":"That unloads all plugins. So the crash is probably from a plugin. What plugins are you using? Running \"install-info\" to generate a full report would be best.","files":null},{"type":6,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543462105,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDE1NjUzNjY0OQ=="},"target":"e5428b63fd22b6e4917106cd8ac21fab2647082f39906295cd1d8142572627d0","message":"That unloads all plugins. So the crash is probably from a plugin. What plugins are you using? Running \"install-info\" to generate a full report would be best.\nMy next step would be to unload a few at a time, or unload all of them and reintroduce a few at a time, so try that.","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543462725,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MjY5NTA4NA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442695084"},"message":"I didnt install any particular plugins, it should just be the standard dfhack install. Heres the report\n\n[install-info.txt](https://github.com/DFHack/dfhack/files/2627507/install-info.txt)","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543464707,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MjcwMDA0Mg==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442700042"},"message":"Sorry, I should have been more clear - run it with a world loaded, and *without* running `unload -all`.\n\nAnd in any case, I know it's an issue with a core DFHack plugin... if it were some third-party plugin, I would tell you to report the issue somewhere else instead.","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543465505,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MjcwMTk1OA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442701958"},"message":"OK heres the corrected report \n\n[install-info.txt](https://github.com/DFHack/dfhack/files/2627583/install-info.txt)","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543465925,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MjcwMjk0MA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442702940"},"message":"Yeah, not seeing anything unusual there. Does it occur with every world or just this one?\n\nI'd try unloading various plugins until the issue goes away to narrow this down to a specific plugin. One way to do this is to make a temporary folder, move half the plugins there (from hack/plugins), run DF, then move more into the temporary folder if the crash persists or move some back if the crash goes away.","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543465930,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDE5OTQyMzYzMjU="},"added":["crash/hang"],"removed":[]},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543505113,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0Mjg3Mjg1Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442872853"},"message":"I'll take a shot at debugging this today, are there any specific plugins that would be doing something on world save that might narrow down my search set?","files":null},{"type":6,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543505113,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDE1Njc2MzUwNw=="},"target":"664c3a08dcd7184787a531d2ec0a8e13898fa6ed7a6a0b4d07420b6540db4c97","message":"I'll take a shot at debugging this today, are there any specific plugins that would be doing something on world save that might narrow down my search set?\n\nAnd yes it happens with every world but only on that setup for some reason, it works fine on other machines, even if I copy the worlds over. I have no idea what it is about that machine that is interfering with it but I suspect finding the plugin that is crashing will give us a clue","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543506571,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0Mjg4MzI2NQ==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442883265"},"message":"I traced it back to `dwarfvet.plug.so`. When I move that plugin to the disabled folder I can save fine. \n\nLet me know how you want to proceed","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543506929,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0Mjg4NTcwOA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442885708"},"message":"I'm suspicious of this guy here:\n\nhttps://github.com/DFHack/dfhack/blob/master/plugins/dwarfvet.cpp#L417\n\nCrash happens right after the line it prints to stdout and its a sigabt which would be consistent with a bad memory access and this code is freeing memory\n\nAny reason not to use a `std::shared_ptr` here?","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543510044,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MjkwNjYwNQ==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442906605"},"message":"The plot thickens\n\nIt is actually that exact line 417, eg the printing is causing the crash. My guess is that this is because I'm not running it in a normal terminal environment, I'm running it on a server. It's supposed to be allocating a tty, but maybe something is going wrong with that. My guess is that anything that is printing extraneous stuff is going to crash it in that environment.","files":null},{"type":6,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543510044,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDE1NjgwMjE4NA=="},"target":"cc3f1961a47fc0da9644df76ce67f6314544d78391ead7541bd4b83e9af06e46","message":"The plot thickens\n\nIt is actually that exact line 417, eg the printing is causing the crash. When I comment that line out I can save no problem. My guess is that this is because I'm not running it in a normal terminal environment, I'm running it on a server. It's supposed to be allocating a tty, but maybe something is going wrong with that. My guess is that anything that is printing extraneous stuff is going to crash it in that environment.","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543512549,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MjkyMjAwNA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442922004"},"message":"And so of course using \n\n`DFHACK_DISABLE_CONSOLE` \n\nfixes this issue. I think this is the solution because it's a quirk of the environment I'm using, but I'll leave this open so you can review it in case there's anything you want to see. Feel free to close it and thanks for the debugging tip.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543517144,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0Mjk0NzQwNQ==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442947405"},"message":"The TTY should already be allocated, and the fact that you're seeing the message printed makes me think that's not the issue. What happens if you change print to printerr there?","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543523545,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0Mjk4Mjc5MQ==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442982791"},"message":"That still crashes it\n\nIt's definitely something to do with the way this environment captures the stdout/stderr streams, maybe its even related to the coloring you are doing (but I kind of doubt it). Same setup works fine when I run it on my machine, I can even ssh into that server and run the commands manually and it all works fine. It's a docker image running in kubernetes for reference.\n\nI'm happy to continue trying things out though in case there is some better way to handle it","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543523953,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0Mjk4NDg3NA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-442984874"},"message":"It's not doing anything more special than other output you're seeing from DFHack (besides the prompt). I've been meaning to remove that print statement, but that's an unsatisfying fix for the issue at hand. Can you run `load adsfghj` while a world is loaded, but from somewhere other than the console? (Ctrl-Shift-P for command-prompt in-game, or the dfhack-run utility in the DF folder.) That should print to the console indirectly, I think.","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543530407,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzAxNzI4NA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443017284"},"message":"Loading that plugin immediately crashed it \n\n```\nDFHack is ready. Have a nice day!\n DFHack version 0.44.12-r1 (release) on x86_64\n Type in '?' or 'help' for general help, 'ls' to see all commands.\n [DFHack]# Plugin does not exist: adsfghj\n Plugin does not exist: adsfghj\n Aborted (core dumped)\n(B\n```\n\nwhen I have the console enabled and has no effect if I have the console disabled. I know it sounds weird but it really seems like its the way kubernetes is handling the output streams.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543538234,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzA0NzE0Ng==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443047146"},"message":"Yeah, that does make it seem more likely. Are you able to run commands in the console, and if so, does running something like \"help\" crash?\n\nAnd I forgot to ask this: what does stderr.log contain, particularly at the end? You can just upload the whole thing if you want too.","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543584870,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzIwNDgyNA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443204824"},"message":"\u003e Yeah, that does make it seem more likely. Are you able to run commands in the console, and if so, does running something like \"help\" crash?\n\nI can't run commands using the console, kubernetes does not provide a way to enter content to stdin. If you allocate a tty, it will use a dummy stdin that just never provides input to the program in question (could that be related in some way?). I use `dfhack-run` to run all my commands by execing into the container.\n\n\u003e And I forgot to ask this: what does stderr.log contain, particularly at the end? You can just upload the whole thing if you want too.\n\nHere is both stderr.log and stdout.log \n[stderr.log](https://github.com/DFHack/dfhack/files/2633356/stderr.log)\n[stdout.log](https://github.com/DFHack/dfhack/files/2633357/stdout.log)","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543592520,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzI0MzQ0MQ==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443243441"},"message":"Those files are identical, but I'm pretty sure they're both stderr.log; unfortunately, nothing useful there.\nI don't know _why_ DFHack is crashing when printing to the console, and I don't see anywhere that DFHack calls abort() which could be triggered here. DFHACK_DISABLE_CONSOLE is probably the best fix for now, although I'd still like to figure out why this happens. You could also try `TERM=dumb`, I guess.","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543597765,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzI3MTg3Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443271873"},"message":"For me, since I can't get to the console anyway, `DFHACK_DISABLE_CONSOLE` is fine for me, but I'll give `TERM=dumb` a shot later so we have more workarounds in case this hits anyone else. \n\nIt is definitely a strange one, and I am considering approaching the Kubernetes people about it but I'm not sure exactly what to tell them.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543598241,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzI3NDI3OA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443274278"},"message":"Just curious, do you have gdb available? If so, does the backtrace from it give any information as to where it's crashing? `dfhack -g` should work, I think.","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543601892,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzI5MjM0Mg==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443292342"},"message":"OK thats a good idea, I can build with debug symbols and try to get a better trace out of it than I got last time. I can try that out later today","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543602005,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzI5Mjg5Ng==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443292896"},"message":"I'm guessing the abort is in some system library that already has symbols, but a debug build might help. The one on buildmaster might work: https://buildmaster.lubar.me/applications/3/builds/build?releaseNumber=0.0.0\u0026buildNumber=181124001","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543602169,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzI5MzY2NA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443293664"},"message":"Debug build would at least tell us the last place in dfhack that the abort came from (I think), I had to build it myself to do make the source code changes I was using to debug earlier, I'll just use my own and switch it into debug mode","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543602268,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzI5NDA0OA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443294048"},"message":"Otherwise the gdb output (release mode) is what I posted earlier \n\n```\nGNU gdb (Ubuntu 8.1-0ubuntu3) 8.1.0.20180409-git\n Copyright (C) 2018 Free Software Foundation, Inc.\n License GPLv3+: GNU GPL version 3 or later \u0026lt;http://gnu.org/licenses/gpl.html\u0026gt;\n This is free software: you are free to change and redistribute it.\n There is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\n and \"show warranty\" for details.\n This GDB was configured as \"x86_64-linux-gnu\".\n Type \"show configuration\" for configuration details.\n For bug reporting instructions, please see:\n \u0026lt;http://www.gnu.org/software/gdb/bugs/\u0026gt;.\n Find the GDB manual and other documentation resources online at:\n \u0026lt;http://www.gnu.org/software/gdb/documentation/\u0026gt;.\n For help, type \"help\".\n Type \"apropos word\" to search for commands related to \"word\"...\n Reading symbols from ./libs/Dwarf_Fortress...(no debugging symbols found)...done.\n [Thread debugging using libthread_db enabled]\n Using host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\n [New Thread 0x7fffe99fa700 (LWP 52)]\n [New Thread 0x7fffe91f9700 (LWP 53)]\n Sound devices available:\n OpenAL Soft\n Picking OpenAL Soft. If your desired device was missing, make sure you have the appropriate 32-bit libraries installed. If you wanted a different device, configure ~/.openalrc appropriately.\n [New Thread 0x7ffff7fbf700 (LWP 54)]\n [New Thread 0x7fffe3fff700 (LWP 55)]\n [Thread 0x7ffff7fbf700 (LWP 54) exited]\n [New Thread 0x7fffe3fff700 (LWP 56)]\n [Thread 0x7fffe3fff700 (LWP 55) exited]\n [New Thread 0x7fffe8302700 (LWP 57)]\n Perfect OpenAL context attributes GET\n Loading bindings from data/init/interface.txt\n [New Thread 0x7fffc6786700 (LWP 58)]\n [New Thread 0x7fffbdf85700 (LWP 59)]\n [New Thread 0x7fffc5f85700 (LWP 60)]\n [New Thread 0x7fffc5784700 (LWP 61)]\n Resetting textures\n [New Thread 0x7fffa57b3700 (LWP 62)]\n TWBT: version 6.55\n TWBT: no display patch (not an error)\n [New Thread 0x7fff93fff700 (LWP 63)]\n [New Thread 0x7fff937fe700 (LWP 64)]\n [New Thread 0x7fff92ffd700 (LWP 65)]\n DFHack is ready. Have a nice day!\n DFHack version 0.44.12-r1 (release) on x86_64\n Type in '?' or 'help' for general help, 'ls' to see all commands.\n [DFHack]# Clearing all animal hospitals\n Thread 3 \"Dwarf_Fortress\" received signal SIGABRT, Aborted.\n[Switching to Thread 0x7fffe91f9700 (LWP 53)]\n __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\n 51\t../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n```","files":null},{"type":6,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543602268,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDE1NzMwNDQ3MQ=="},"target":"8f97faba1267f691f544e4eeda888b4014f51e97e937a06578923ccfacab05eb","message":"Otherwise the gdb output (release mode) is what I posted earlier:\n\n```\nGNU gdb (Ubuntu 8.1-0ubuntu3) 8.1.0.20180409-git\n Copyright (C) 2018 Free Software Foundation, Inc.\n License GPLv3+: GNU GPL version 3 or later \u0026lt;http://gnu.org/licenses/gpl.html\u0026gt;\n This is free software: you are free to change and redistribute it.\n There is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\n and \"show warranty\" for details.\n This GDB was configured as \"x86_64-linux-gnu\".\n Type \"show configuration\" for configuration details.\n For bug reporting instructions, please see:\n \u0026lt;http://www.gnu.org/software/gdb/bugs/\u0026gt;.\n Find the GDB manual and other documentation resources online at:\n \u0026lt;http://www.gnu.org/software/gdb/documentation/\u0026gt;.\n For help, type \"help\".\n Type \"apropos word\" to search for commands related to \"word\"...\n Reading symbols from ./libs/Dwarf_Fortress...(no debugging symbols found)...done.\n [Thread debugging using libthread_db enabled]\n Using host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\n [New Thread 0x7fffe99fa700 (LWP 52)]\n [New Thread 0x7fffe91f9700 (LWP 53)]\n Sound devices available:\n OpenAL Soft\n Picking OpenAL Soft. If your desired device was missing, make sure you have the appropriate 32-bit libraries installed. If you wanted a different device, configure ~/.openalrc appropriately.\n [New Thread 0x7ffff7fbf700 (LWP 54)]\n [New Thread 0x7fffe3fff700 (LWP 55)]\n [Thread 0x7ffff7fbf700 (LWP 54) exited]\n [New Thread 0x7fffe3fff700 (LWP 56)]\n [Thread 0x7fffe3fff700 (LWP 55) exited]\n [New Thread 0x7fffe8302700 (LWP 57)]\n Perfect OpenAL context attributes GET\n Loading bindings from data/init/interface.txt\n [New Thread 0x7fffc6786700 (LWP 58)]\n [New Thread 0x7fffbdf85700 (LWP 59)]\n [New Thread 0x7fffc5f85700 (LWP 60)]\n [New Thread 0x7fffc5784700 (LWP 61)]\n Resetting textures\n [New Thread 0x7fffa57b3700 (LWP 62)]\n TWBT: version 6.55\n TWBT: no display patch (not an error)\n [New Thread 0x7fff93fff700 (LWP 63)]\n [New Thread 0x7fff937fe700 (LWP 64)]\n [New Thread 0x7fff92ffd700 (LWP 65)]\n DFHack is ready. Have a nice day!\n DFHack version 0.44.12-r1 (release) on x86_64\n Type in '?' or 'help' for general help, 'ls' to see all commands.\n [DFHack]# Clearing all animal hospitals\n Thread 3 \"Dwarf_Fortress\" received signal SIGABRT, Aborted.\n[Switching to Thread 0x7fffe91f9700 (LWP 53)]\n __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\n 51\t../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n```","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543616740,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzM1ODIzMg==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443358232"},"message":"Does `bt` in gdb list anything? If not, yeah, you might have to build your own.","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543623092,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzM3Nzc3MA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443377770"},"message":"That i'm going to need to thing about how to test, I cant interact with the primary command I run so it's a little tricky. I guess I can put it into the \"script\" thing","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543703556,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzQ2Mzg0Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443463843"},"message":"This is going to be a long one\n\nI'm trying to go about this by getting a core dump and doing the analysis on my PC, let me know if you can think of something better though. I'm using `dfhack -g` on my end and then loading the core that I pull out of the docker container. I'm building my own dfhack so I can be absolutely sure that the core matches the binary.\n\nFor release mode I'm not getting much of anything. This all I can get out of it:\n\n```\nNOTICE: libs/libstdc++.so.6 has been moved to libs/libstdc++.so.6.backup\nfor better compatibility. If you are using an older distro and this breaks,\nrun \"cp libs/libstdc++.so.6.backup libs/libstdc++.so.6\", or add this to\n/home/max/.dfhackrc to affect future DFHack installations:\n\n    export DFHACK_NO_RENAME_LIBSTDCXX=1\n\nGNU gdb (Ubuntu 8.2-0ubuntu1) 8.2\nCopyright (C) 2018 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later \u003chttp://gnu.org/licenses/gpl.html\u003e\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\nType \"show copying\" and \"show warranty\" for details.\nThis GDB was configured as \"x86_64-linux-gnu\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n\u003chttp://www.gnu.org/software/gdb/bugs/\u003e.\nFind the GDB manual and other documentation resources online at:\n    \u003chttp://www.gnu.org/software/gdb/documentation/\u003e.\n\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nReading symbols from ./libs/Dwarf_Fortress...(no debugging symbols found)...done.\n(gdb) core ~/core.Dwarf_Fortress.43 \n[New LWP 49]\n[New LWP 43]\n[New LWP 50]\n[New LWP 48]\n[New LWP 52]\n[New LWP 51]\n[New LWP 53]\nwarning: .dynamic section for \"/lib/x86_64-linux-gnu/libpthread.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/lib64/ld-linux-x86-64.so.2\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libasound.so.2\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libpangocairo-1.0.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libcairo.so.2\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libgdk_pixbuf-2.0.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libgio-2.0.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libpangoft2-1.0.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libpango-1.0.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libglib-2.0.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libfontconfig.so.1\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libjpeg.so.8\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libXinerama.so.1\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/liblz4.so.1\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libFLAC.so.8\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/lib/x86_64-linux-gnu/libbsd.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libdatrie.so.1\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/lib/x86_64-linux-gnu/libgpg-error.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: Could not load shared library symbols for 93 libraries, e.g. /df_linux/libs/libgraphics.so.\nUse the \"info sharedlibrary\" command to see the complete listing.\nDo you need \"set solib-search-path\" or \"set sysroot\"?\nWarning: couldn't activate thread debugging using libthread_db: Cannot find new threads: debugger service failed\nwarning: File \"/lib/x86_64-linux-gnu/libthread_db-1.0.so\" auto-loading has been declined by your `auto-load safe-path' set to \"$debugdir:$datadir/auto-load\".\nTo enable execution of this file add\n\tadd-auto-load-safe-path /lib/x86_64-linux-gnu/libthread_db-1.0.so\nline to your configuration file \"/home/max/.gdbinit\".\nTo completely disable this security protection add\n\tset auto-load safe-path /\nline to your configuration file \"/home/max/.gdbinit\".\nFor more information about this security protection see the\n\"Auto-loading safe path\" section in the GDB manual.  E.g., run from the shell:\n\tinfo \"(gdb)Auto-loading safe path\"\nwarning: Unable to find libthread_db matching inferior's thread library, thread debugging will not be available.\nWarning: couldn't activate thread debugging using libthread_db: Cannot find new threads: debugger service failed\nwarning: File \"/lib/x86_64-linux-gnu/libthread_db-1.0.so\" auto-loading has been declined by your `auto-load safe-path' set to \"$debugdir:$datadir/auto-load\".\nwarning: Unable to find libthread_db matching inferior's thread library, thread debugging will not be available.\nCore was generated by `./libs/Dwarf_Fortress'.\nProgram terminated with signal SIGABRT, Aborted.\n#0  0x00007ffff5e75e97 in ?? ()\n[Current thread is 1 (LWP 49)]\n(gdb) bt\n#0  0x00007ffff5e75e97 in  ()\n#1  0x000000000e017007 in  ()\n#2  0x0000000000000000 in  ()\n(gdb) quit\n```\n\nThe next issue is that when I build in debug mode, the crash happens on world *load* instead of save. Presumably this is because more stuff is being printed out?\n\nHere's the stdout/stderr from the debug build:\n\n```\nNOTICE: libs/libstdc++.so.6 has been moved to libs/libstdc++.so.6.backup\n for better compatibility. If you are using an older distro and this breaks,\n run \"cp libs/libstdc++.so.6.backup libs/libstdc++.so.6\", or add this to\n /root/.dfhackrc to affect future DFHack installations:\n \n     export DFHACK_NO_RENAME_LIBSTDCXX=1\n \n Loading bindings from data/init/interface.txt\n New window size: 1920x1080\n Font size: 18x18\n Resizing grid to 106x60\n Resizing font to 18x18\n \n Resetting textures\n Could not activate tweak stable-cursor (stable_cursor_hook::feed)\n Could not activate tweak advmode-contained (advmode_contained_hook::feed)\n Could not activate tweak fast-trade (fast_trade_assign_hook::feed)\n Could not activate tweak fast-trade (fast_trade_select_hook::feed)\n Could not activate tweak military-stable-assign (military_assign_hook::feed)\n Could not activate tweak military-color-assigned (military_assign_hook::render)\n Could not activate tweak craft-age-wear (craft_age_wear_hook::ageItem)\n Could not activate tweak farm-plot-select (farm_select_hook::feed)\n Could not activate tweak farm-plot-select (farm_select_hook::render)\n Could not activate tweak import-priority-category (takerequest_hook::feed)\n Could not activate tweak import-priority-category (takerequest_hook::render)\n Could not activate tweak condition-material (condition_material_hook::feed)\n Could not activate tweak hotkey-clear (hotkey_clear_hook::feed)\n Could not activate tweak hotkey-clear (hotkey_clear_hook::render)\n Could not activate tweak embark-profile-name (embark_profile_name_hook::feed)\n Could not activate tweak block-labors (block_labors_hook::feed)\n Could not activate tweak block-labors (block_labors_hook::render)\n Could not activate tweak burrow-name-cancel (burrow_name_cancel_hook::feed)\n Could not activate tweak cage-butcher (cage_butcher_hook::feed)\n Could not activate tweak cage-butcher (cage_butcher_hook::render)\n Could not activate tweak civ-view-agreement (civ_agreement_view_hook::render)\n Could not activate tweak eggs-fertile (egg_fertile_hook::render)\n Could not activate tweak hide-priority (hide_priority_hook::feed)\n Could not activate tweak hide-priority (hide_priority_hook::render)\n Could not activate tweak kitchen-prefs-all (kitchen_prefs_all_hook::feed)\n Could not activate tweak kitchen-prefs-all (kitchen_prefs_all_hook::render)\n Could not activate tweak kitchen-prefs-empty (kitchen_prefs_empty_hook::render)\n Could not activate tweak max-wheelbarrow (max_wheelbarrow_hook::render)\n Could not activate tweak max-wheelbarrow (max_wheelbarrow_hook::feed)\n Could not activate tweak shift-8-scroll (shift_8_scroll_hook::feed)\n Could not activate tweak stone-status-all (stone_status_all_hook::feed)\n Could not activate tweak stone-status-all (stone_status_all_hook::render)\n Could not activate tweak title-start-rename (title_start_rename_hook::feed)\n Could not activate tweak title-start-rename (title_start_rename_hook::render)\n Could not activate tweak tradereq-pet-gender (pet_gender_hook::render)\n Could not enable plugin: title-version\n Could not enable plugin: manipulator\n Could not enable plugin: search\n Could not enable plugin: automaterial\n Could not enable plugin: confirm\n ./hack/lua/plugins/dwarfmonitor.lua:3: attempt to index a nil value (field 'global')\n stack traceback:\n \t./hack/lua/plugins/dwarfmonitor.lua:3: in main chunk\n \t[C]: in function 'require'\n Could not enable plugin: dwarfmonitor\n Could not enable plugin: mousequery\n Could not insert autogem hooks!\n Could not enable plugin: autogems\n Could not enable plugin: automelt\n Could not enable plugin: autotrade\n Could not enable plugin: buildingplan\n Could not enable plugin: resume\n Could not insert trackstop hooks!\n Could not enable plugin: trackstop\n Could not enable plugin: zone\n Could not enable plugin: stocks\n Could not enable plugin: autochop\n Could not enable plugin: stockpiles\n DFHack is ready. Have a nice day!\n DFHack version 0.44.12-r1 (development build 0.44.12-r1-1-g55d5d477) on x86_64\n Type in '?' or 'help' for general help, 'ls' to see all commands.\n [DFHack]# ./hack/lua/gui.lua:542: native code: Missing vtable address: viewscreen\n stack traceback:\n \t[C]: in field 'show'\n \t./hack/lua/gui.lua:542: in method 'show'\n \t/df_linux/hack/scripts/gui/load-screen.lua:503: in global 'mkscreen'\n \t/df_linux/hack/scripts/gui/load-screen.lua:488: in function \u0026lt;/df_linux/hack/scripts/gui/load-screen.lua:483\u0026gt;\n Aborted (core dumped)\n(B\n```\n\nHeres stderr.log:\n\n[stderr.log](https://github.com/DFHack/dfhack/files/2636374/stderr.log)\n\nAnd heres the core analysis, which also does not seem very informative:\n\n```\nGNU gdb (Ubuntu 8.2-0ubuntu1) 8.2\nCopyright (C) 2018 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later \u003chttp://gnu.org/licenses/gpl.html\u003e\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\nType \"show copying\" and \"show warranty\" for details.\nThis GDB was configured as \"x86_64-linux-gnu\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n\u003chttp://www.gnu.org/software/gdb/bugs/\u003e.\nFind the GDB manual and other documentation resources online at:\n    \u003chttp://www.gnu.org/software/gdb/documentation/\u003e.\n\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nReading symbols from ./libs/Dwarf_Fortress...(no debugging symbols found)...done.\n(gdb) core ~/core.Dwarf_Fortress.41 \n[New LWP 49]\n[New LWP 41]\n[New LWP 51]\n[New LWP 48]\n[New LWP 52]\n[New LWP 53]\n[New LWP 50]\nwarning: .dynamic section for \"/lib/x86_64-linux-gnu/libpthread.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/lib64/ld-linux-x86-64.so.2\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libasound.so.2\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libpangocairo-1.0.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libcairo.so.2\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libgdk_pixbuf-2.0.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libgio-2.0.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libpangoft2-1.0.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libpango-1.0.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libglib-2.0.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libfontconfig.so.1\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libjpeg.so.8\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libXinerama.so.1\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/liblz4.so.1\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libFLAC.so.8\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/lib/x86_64-linux-gnu/libbsd.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/usr/lib/x86_64-linux-gnu/libdatrie.so.1\" is not at the expected address (wrong library or version mismatch?)\nwarning: .dynamic section for \"/lib/x86_64-linux-gnu/libgpg-error.so.0\" is not at the expected address (wrong library or version mismatch?)\nwarning: Could not load shared library symbols for 93 libraries, e.g. /df_linux/libs/libgraphics.so.\nUse the \"info sharedlibrary\" command to see the complete listing.\nDo you need \"set solib-search-path\" or \"set sysroot\"?\nWarning: couldn't activate thread debugging using libthread_db: Cannot find new threads: debugger service failed\nwarning: File \"/lib/x86_64-linux-gnu/libthread_db-1.0.so\" auto-loading has been declined by your `auto-load safe-path' set to \"$debugdir:$datadir/auto-load\".\nTo enable execution of this file add\n\tadd-auto-load-safe-path /lib/x86_64-linux-gnu/libthread_db-1.0.so\nline to your configuration file \"/home/max/.gdbinit\".\nTo completely disable this security protection add\n\tset auto-load safe-path /\nline to your configuration file \"/home/max/.gdbinit\".\nFor more information about this security protection see the\n\"Auto-loading safe path\" section in the GDB manual.  E.g., run from the shell:\n\tinfo \"(gdb)Auto-loading safe path\"\nwarning: Unable to find libthread_db matching inferior's thread library, thread debugging will not be available.\nWarning: couldn't activate thread debugging using libthread_db: Cannot find new threads: debugger service failed\nwarning: File \"/lib/x86_64-linux-gnu/libthread_db-1.0.so\" auto-loading has been declined by your `auto-load safe-path' set to \"$debugdir:$datadir/auto-load\".\nwarning: Unable to find libthread_db matching inferior's thread library, thread debugging will not be available.\nCore was generated by `./libs/Dwarf_Fortress'.\nProgram terminated with signal SIGABRT, Aborted.\n#0  0x00007ffff5e75e97 in ?? ()\n[Current thread is 1 (LWP 49)]\n(gdb) bt\n#0  0x00007ffff5e75e97 in  ()\n#1  0x000000000e017007 in  ()\n#2  0x0000000000000000 in  ()\n(gdb) \n\n```","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543704229,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzQ2NDQ4OQ==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443464489"},"message":"The printing of \"Missing vtable address: viewscreen\" is probably why it's crashing earlier. Something about your build is wrong. I don't think that the missing vtable is the cause of the crash, but it could be, so you should try to resolve that.\n* Which architecture of DF/DFHack are you using (32 or 64-bit)?\n* Run `grep 'vtable.*viewscreenst' hack/symbols.xml` in the DF folder and paste the output\n* Run `install-info` again and attach the resulting file (I really only care about the version info in the first section, before plugin statuses)","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543719431,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzQ3Njc1Mg==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443476752"},"message":"Ok the problem with the debug build was that `libdfhack.so` is being renamed (I think this is cmake default behavior) to `libdfhack-debug,so`, so the that library wasnt being preloaded and who knows what could go wrong in that case.\n\nSo I manually renamed that lib file and rebuilt the docker image and now I am getting the debug build to crash in the same place. \n\nNext thing is I wasn't super happy about the amount of libraries that GDB was reporting were different than the core file, but I realized since this is just docker anyway I can actually run the container interactively on my PC and mount a volume with the core file and do the core analysis in that. This ensures that Im running exactly what was running on my server.\n\nSo here's that core analysis w/ debug symbols. It's marginally more interesting\n\n```\nroot@0c47f34c4a4f:/df_linux# ./dfhack -g\nNOTICE: libs/libstdc++.so.6 has been moved to libs/libstdc++.so.6.backup\nfor better compatibility. If you are using an older distro and this breaks,\nrun \"cp libs/libstdc++.so.6.backup libs/libstdc++.so.6\", or add this to\n/root/.dfhackrc to affect future DFHack installations:\n\n    export DFHACK_NO_RENAME_LIBSTDCXX=1\n\nGNU gdb (Ubuntu 8.1-0ubuntu3) 8.1.0.20180409-git\nCopyright (C) 2018 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later \u003chttp://gnu.org/licenses/gpl.html\u003e\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-linux-gnu\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n\u003chttp://www.gnu.org/software/gdb/bugs/\u003e.\nFind the GDB manual and other documentation resources online at:\n\u003chttp://www.gnu.org/software/gdb/documentation/\u003e.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nReading symbols from ./libs/Dwarf_Fortress...(no debugging symbols found)...done.\n(gdb) core /max/core.Dwarf_Fortress.47 \n[New LWP 55]\n[New LWP 47]\n[New LWP 56]\n[New LWP 54]\n[New LWP 58]\n[New LWP 57]\n[New LWP 59]\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\nCore was generated by `./libs/Dwarf_Fortress'.\nProgram terminated with signal SIGABRT, Aborted.\n#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\n51\t../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n[Current thread is 1 (Thread 0x7fffe95b2700 (LWP 55))]\n(gdb) bt\n#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\n#1  0x00007ffff5bac801 in __GI_abort () at abort.c:79\n#2  0x00007ffff659d8fb in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#3  0x00000000e54286c8 in ?? ()\n#4  0xf37dc0813bbba700 in ?? ()\n#5  0x00007fffe54286a0 in ?? ()\n#6  0x00007ffff68919b8 in typeinfo for std::length_error ()\n   from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#7  0x00007ffff65b9860 in std::ios_base::Init::Init() ()\n   from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#8  0x00007fffe54286c0 in ?? ()\n#9  0x00007ffff659f8c1 in setvbuf@plt () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#10 0x74735f6369736162 in ?? ()\n#11 0x75733a3a676e6972 in ?? ()\n#12 0x5f5f203a72747362 in ?? ()\n#13 0x6968772820736f70 in ?? ()\n#14 0x3131207369206863 in ?? ()\n#15 0x73696874203e2029 in ?? ()\n#16 0x2928657a69733e2d in ?? ()\n#17 0x2068636968772820 in ?? ()\n#18 0x0000002930207369 in ?? ()\n#19 0x0000000000000000 in ?? ()\n(gdb) \n```\n\nStill not sure what to make of it, except that the error is coming from `ios_base` so definitely to do with the streams as we were thinking.","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543719624,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzQ3Njg4Mg==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443476882"},"message":"BTW if you want to mess around with this I can give you this core file and the docker container is `queuecumber/dwarf-fortress-vnc-debug`. I got the shell into it with `docker run  -v /home/max:/max -it queuecumber/dwarf-fortress-vnc-debug bash` with the `-v` path being the place where the core file is","files":null},{"type":6,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543719624,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDE1NzU1MjE0Ng=="},"target":"48ca37126139265a07c35acfd37f129c6465a4f85c28c9ce47319f91eb2ea92e","message":"BTW if you want to mess around with this I can give you the core file and the docker container is `queuecumber/dwarf-fortress-vnc-debug`. I got the shell into it with `docker run  -v /home/max:/max -it queuecumber/dwarf-fortress-vnc-debug bash` with the `-v` path being the place where the core file is","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1543724436,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzQ4MDI0NA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443480244"},"message":"That's weird. What if you comment out the flush_proxy call in vprint() in ColorText.cpp (around line 112?)?\nAlso, what GCC version did you build with?","files":null},{"type":3,"author":{"id":"274ae38fa737b1b7ca0032e224819d68cad9506c"},"timestamp":1543790553,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MzU0OTM1NA==","github-url":"https://github.com/DFHack/dfhack/issues/1411#issuecomment-443549354"},"message":"OK that was actually able to save without crashing, although I see the animal hospital output twice for some reason:\n\n```\nNOTICE: libs/libstdc++.so.6 has been moved to libs/libstdc++.so.6.backup\n for better compatibility. If you are using an older distro and this breaks,\n run \"cp libs/libstdc++.so.6.backup libs/libstdc++.so.6\", or add this to\n /root/.dfhackrc to affect future DFHack installations:\n \n     export DFHACK_NO_RENAME_LIBSTDCXX=1\n \n \n The VNC desktop is:      dwarf-fortress-debug-67b5dff449-98ct9:0\n PORT=5900\n Loading bindings from data/init/interface.txt\n New window size: 1920x1080\n Font size: 18x18\n Resizing grid to 106x60\n Resizing font to 18x18\n \n Resetting textures\n DFHack is ready. Have a nice day!\n DFHack version 0.44.12-r1 (development build 0.44.12-r1-1-g55d5d477) on x86_64\n Type in '?' or 'help' for general help, 'ls' to see all commands.\n [DFHack]# Clearing all animal hospitals\n Clearing all animal hospitals\n```","files":null}]}