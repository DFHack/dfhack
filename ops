{"version":1,"ops":[{"type":6,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1533059355,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDExNDU4NTY2OA=="},"target":"c550834fcb4d6cbf4f473e3506e9f8c5d8106ad03621c0fbc76b05ee491287f3","message":"I have a crash that happens reproducibly around the same time every time I load the game. Start the game with -g gave me:\n```\n#0  0x0000000000000000 in  ()\n#1  0x0000000000d9c184 in  ()\n#2  0x0000000000d9e040 in  ()\n#3  0x0000000000daa035 in  ()\n#4  0x000000000074fa5a in  ()\n#5  0x00007fffd718ffe4 in dwarfmode_hook::interpose_fn_logic() ()\n    at /mnt/nvme/games/LinuxLNP-0.44.12-r01/df_linux/hack/plugins/twbt.plug.so\n#6  0x00007ffff699beb2 in interfacest::loop() () at /mnt/nvme/games/LinuxLNP-0.44.12-r01/df_linux/libs/libgraphics.so\n#7  0x00000000009ccdee in mainloop() ()\n#8  0x00007ffff69801c5 in enablerst::async_loop() ()\n    at /mnt/nvme/games/LinuxLNP-0.44.12-r01/df_linux/libs/libgraphics.so\n#9  0x00007ffff69804e0 in call_loop(void*) () at /mnt/nvme/games/LinuxLNP-0.44.12-r01/df_linux/libs/libgraphics.so\n#10 0x00007ffff6f8ee18 in  () at /usr/lib/x86_64-linux-gnu/libSDL-1.2.so.0\n#11 0x00007ffff6fcdf69 in  () at /usr/lib/x86_64-linux-gnu/libSDL-1.2.so.0\n#12 0x00007ffff53c75aa in start_thread (arg=0x7fffe8402700) at pthread_create.c:463\n#13 0x00007ffff5d49cbf in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:95\n```\nUnfortunately no debug symbols, but it appears that the twbt plugin calls something that makes the interpose_fn_logic jump to a low undefined address.","files":null},{"type":3,"author":{"id":"b5eb4c1a4ccf4a3c2d5ba670bed6a33694610c35"},"timestamp":1533057191,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTI5Nzg5Ng==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409297896"},"message":"Note I reproduced it both with LinuxLNP and my own build and installation (I switched to LinuxLNP to see if something in my setup might have triggered the crash),","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1533057236,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTI5ODExOQ==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409298119"},"message":"If it doesn't reproduce when TWBT is off, this is a TWBT bug that should be reported in https://github.com/mifki/df-twbt/issues instead.","files":null},{"type":3,"author":{"id":"b5eb4c1a4ccf4a3c2d5ba670bed6a33694610c35"},"timestamp":1533057946,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMwMTcxOQ==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409301719"},"message":"Right, that is the ONE plugin that wasn't provided by the base dfhack package. sorry","files":null},{"type":3,"author":{"id":"b5eb4c1a4ccf4a3c2d5ba670bed6a33694610c35"},"timestamp":1533059268,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMwNjY0Nw==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409306647"},"message":"Okay, it crashes at the same time even without TWBT:\n\n#0  0x000000000047e5d0 in  ()\n#1  0x00007ffff7d85ee8 in df::global::ui () at ./hack/libdfhack.so\n#2  0x00007ffff783ed99 in getDwarfmodeViewDims_default() () at ./hack/libdfhack.so\n#3  0x00007ffff78417d8 in DFHack::Gui::getDwarfmodeViewDims() () at ./hack/libdfhack.so\n#4  0x00007fffceff91fa in buildingplan_hook::interpose_fn_render() ()\n    at /mnt/nvme/games/LinuxLNP-0.44.12-r01/df_linux/hack/plugins/buildingplan.plug.so\n#5  0x00007fffdab3fec5 in resume_hook::interpose_fn_render() ()\n    at /mnt/nvme/games/LinuxLNP-0.44.12-r01/df_linux/hack/plugins/resume.plug.so\n#6  0x00007fff9b241d18 in  ()\n#7  0x000000000000002a in  ()\n#8  0x0000000000000037 in  ()\n#9  0x00007fff9b2441fe in  ()\n#10 0x000000000000000d in  ()\n#11 0x00007fffaa3928b0 in  ()\n#12 0x0000000000e63303 in  ()\n#13 0x0000000000e6539a in  ()\n#14 0x000000000113a994 in  ()\n#15 0x000000000071ee47 in  ()\n#16 0x000000000074fa5a in  ()\n#17 0x00007ffff699beb2 in interfacest::loop() () at /mnt/nvme/games/LinuxLNP-0.44.12-r01/df_linux/libs/libgraphics.so\n#18 0x00000000009ccdee in mainloop() ()\n#19 0x00007ffff69801c5 in enablerst::async_loop() ()\n    at /mnt/nvme/games/LinuxLNP-0.44.12-r01/df_linux/libs/libgraphics.so\n#20 0x00007ffff69804e0 in call_loop(void*) () at /mnt/nvme/games/LinuxLNP-0.44.12-r01/df_linux/libs/libgraphics.so\n#21 0x00007ffff6f8ee18 in  () at /usr/lib/x86_64-linux-gnu/libSDL-1.2.so.0\n#22 0x00007ffff6fcdf69 in  () at /usr/lib/x86_64-linux-gnu/libSDL-1.2.so.0\n#23 0x00007ffff53c75aa in start_thread (arg=0x7fffe8402700) at pthread_create.c:463\n#24 0x00007ffff5d49cbf in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:95","files":null},{"type":6,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1533059268,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDExNDU4NTEyNw=="},"target":"ecef5c9b6d0d2e79ab591983c3ce57c1861a0338ffee2b211fa200d9f92c2cbb","message":"Okay, it crashes at the same time even without TWBT:\n\n```\n#0  0x000000000047e5d0 in  ()\n#1  0x00007ffff7d85ee8 in df::global::ui () at ./hack/libdfhack.so\n#2  0x00007ffff783ed99 in getDwarfmodeViewDims_default() () at ./hack/libdfhack.so\n#3  0x00007ffff78417d8 in DFHack::Gui::getDwarfmodeViewDims() () at ./hack/libdfhack.so\n#4  0x00007fffceff91fa in buildingplan_hook::interpose_fn_render() ()\n    at /mnt/nvme/games/LinuxLNP-0.44.12-r01/df_linux/hack/plugins/buildingplan.plug.so\n#5  0x00007fffdab3fec5 in resume_hook::interpose_fn_render() ()\n    at /mnt/nvme/games/LinuxLNP-0.44.12-r01/df_linux/hack/plugins/resume.plug.so\n#6  0x00007fff9b241d18 in  ()\n#7  0x000000000000002a in  ()\n#8  0x0000000000000037 in  ()\n#9  0x00007fff9b2441fe in  ()\n#10 0x000000000000000d in  ()\n#11 0x00007fffaa3928b0 in  ()\n#12 0x0000000000e63303 in  ()\n#13 0x0000000000e6539a in  ()\n#14 0x000000000113a994 in  ()\n#15 0x000000000071ee47 in  ()\n#16 0x000000000074fa5a in  ()\n#17 0x00007ffff699beb2 in interfacest::loop() () at /mnt/nvme/games/LinuxLNP-0.44.12-r01/df_linux/libs/libgraphics.so\n#18 0x00000000009ccdee in mainloop() ()\n#19 0x00007ffff69801c5 in enablerst::async_loop() ()\n    at /mnt/nvme/games/LinuxLNP-0.44.12-r01/df_linux/libs/libgraphics.so\n#20 0x00007ffff69804e0 in call_loop(void*) () at /mnt/nvme/games/LinuxLNP-0.44.12-r01/df_linux/libs/libgraphics.so\n#21 0x00007ffff6f8ee18 in  () at /usr/lib/x86_64-linux-gnu/libSDL-1.2.so.0\n#22 0x00007ffff6fcdf69 in  () at /usr/lib/x86_64-linux-gnu/libSDL-1.2.so.0\n#23 0x00007ffff53c75aa in start_thread (arg=0x7fffe8402700) at pthread_create.c:463\n#24 0x00007ffff5d49cbf in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:95\n```","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1533059237,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMwODYzNw==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409308637"},"message":"I don't think getDwarfmodeViewDims_default does anything that could possibly crash. Can you upload your stderr.log? Also, the output of `:lua ~gps` and `:lua ~ui_menu_width` might help.","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1533059441,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDE3NjMzNjY1Njg="},"added":["crash/hang"],"removed":[]},{"type":3,"author":{"id":"b5eb4c1a4ccf4a3c2d5ba670bed6a33694610c35"},"timestamp":1533059708,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMxMTA3Mg==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409311072"},"message":"I am running it in valgrind. This is going to take a while, but I found one interesting line in the stderr.log:\n\nUNKNOWN CLASS 'ack21dfhack_lua_viewscreenE': vtable = 0x590ba30","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1533059998,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMxMjcwMA==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409312700"},"message":"That's irrelevant, and always shows up when you open a lua viewscreen. The full log file would be more helpful.","files":null},{"type":3,"author":{"id":"b5eb4c1a4ccf4a3c2d5ba670bed6a33694610c35"},"timestamp":1533061826,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMyMjQ1MQ==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409322451"},"message":"[dfhack.log](https://github.com/DFHack/dfhack/files/2246616/dfhack.log)\n[stderr.log](https://github.com/DFHack/dfhack/files/2246617/stderr.log)","files":null},{"type":3,"author":{"id":"b5eb4c1a4ccf4a3c2d5ba670bed6a33694610c35"},"timestamp":1533061846,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMyMjU1MA==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409322550"},"message":"Nothing in the stderr.log around the time of the crash though","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1533062150,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMyNDE0NQ==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409324145"},"message":"What is dfhack.log? Is that from GDB? DFHack itself no longer creates a file by that name.\n\nAlso, can you run the Lua commands? `:lua ~gps` and `:lua ~ ui_menu_width`","files":null},{"type":3,"author":{"id":"b5eb4c1a4ccf4a3c2d5ba670bed6a33694610c35"},"timestamp":1533062227,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMyNDUyNg==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409324526"},"message":"dfhack.log is the output in console where I launched dfhack","files":null},{"type":3,"author":{"id":"b5eb4c1a4ccf4a3c2d5ba670bed6a33694610c35"},"timestamp":1533062337,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMyNTExMQ==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409325111"},"message":"[DFHack]# :lua ~gps\n\u003cgraphic: 0x183ef40\u003e\nscreenx                  = 23\nscreeny                  = 0\nscreenf                  = 7\nscreenb                  = 3\nscreenbright             = 1\nscreen                   = \u003cuint8_t: 0x2ba2650\u003e\nscreentexpos             = \u003clong: 0x2ba5cd0\u003e\nscreentexpos_addcolor    = \u003cint8_t: 0x2bc2b60\u003e\nscreentexpos_grayscale   = \u003cuint8_t: 0x2b9f1f0\u003e\nscreentexpos_cf          = \u003cuint8_t: 0x2b9ffa0\u003e\nscreentexpos_cbr         = \u003cuint8_t: 0x2bac9b0\u003e\nclipx                    = \u003clong[]: 0x183ef88\u003e\nclipy                    = \u003clong[]: 0x183ef98\u003e\ntex_pos                  = \u003clong[]: 0x183efa8\u003e\nrect_id                  = -1\nprint_time               = \u003clarge_integer[]: 0x183efb8\u003e\nprint_index              = 0\ndisplay_frames           = 1\nforce_full_display_count         = 0\noriginal_rect            = 1\ndimx                     = 81\ndimy                     = 43\nmouse_x                  = -1\nmouse_y                  = -1\nscreen_limit             = \u003cuint8_t: 0x2ba5cbc\u003e","files":null},{"type":3,"author":{"id":"b5eb4c1a4ccf4a3c2d5ba670bed6a33694610c35"},"timestamp":1533062351,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMyNTE5OA==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409325198"},"message":"[DFHack]# :lua ~ ui_menu_width\n\u003cint8_t[]: 0x183ed41\u003e\n0                        = 2\n1                        = 3","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1533062478,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMyNTg4MA==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409325880"},"message":"Yeah, there's no way that getDwarfmodeViewDims_default can crash, then. Are you sure that backtrace is correct?\nYou could also try removing all plugins (or just rename hack/plugins), then run `:lua ~dfhack.gui.getDwarfmodeViewDims()` after loading a world.","files":null},{"type":3,"author":{"id":"b5eb4c1a4ccf4a3c2d5ba670bed6a33694610c35"},"timestamp":1533062520,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMyNjA5NA==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409326094"},"message":"That was why I tried running it in valgrind. It almost has to be a memory corruption","files":null},{"type":3,"author":{"id":"b5eb4c1a4ccf4a3c2d5ba670bed6a33694610c35"},"timestamp":1533063053,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMyODgwMA==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409328800"},"message":"I have lost the ability to reproduce the crash. I moved the save closer and closer to where it always happened, and now it no longer triggers. I had thought the old saves would still be there, but now the last save is few months back.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1533063806,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMzMjU1MA==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409332550"},"message":"Wait, this wasn't happening right when you loaded the game? I thought that's what you meant in your original report.","files":null},{"type":3,"author":{"id":"b5eb4c1a4ccf4a3c2d5ba670bed6a33694610c35"},"timestamp":1533064643,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwOTMzNjUzNg==","github-url":"https://github.com/DFHack/dfhack/issues/1381#issuecomment-409336536"},"message":"No, it happened on a specific date while the game was running.","files":null}]}