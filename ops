{"version":1,"ops":[{"type":3,"author":{"id":"5221f59e75ea9db114593bbdfb180b7354aef9ed"},"timestamp":1513381864,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MjE0MDEwNg==","github-url":"https://github.com/DFHack/dfhack/issues/1198#issuecomment-352140106"},"message":"I just used that exact same command to create bauxite blocks in 0.44.02-alpha1 with Windows 32-bit and 64-bit and they both worked correctly.\n\nOn what platform are you playing? And what other plugins/scripts are you using?","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1513381976,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MjE0MDM0MQ==","github-url":"https://github.com/DFHack/dfhack/issues/1198#issuecomment-352140341"},"message":"I'm thinking it's save-specific somehow. I'll test the save when I get a chance.","files":null},{"type":3,"author":{"id":"6f68f373d287ed6bcd7e19879d9ba921dbf0d4dc"},"timestamp":1513384772,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MjE0NTcwNw==","github-url":"https://github.com/DFHack/dfhack/issues/1198#issuecomment-352145707"},"message":"This was on Windows 10, 64-bit with latest updates installed. I can port the save over to a Mac or Linux system to test if you would like.\n\nI believe that all I have running is TWBT and Multilevel View. I am also using the GemSet tileset but doubt that has any relation here. You can find a [gist of my PyLNP.json here](https://gist.github.com/backlands/9b1dc049053e6105c9a01a466143be5f) so you can replicate my setup, in case there is some setting in there causing the issue, not sure why it would but you never know!","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1513385359,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MjE0Njc0Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1198#issuecomment-352146743"},"message":"For the record, I've heard a few reports of this on the forums before. Can you try it with a citizen selected if you aren't doing that already?","files":null},{"type":3,"author":{"id":"6f68f373d287ed6bcd7e19879d9ba921dbf0d4dc"},"timestamp":1513386092,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MjE0Nzg0NQ==","github-url":"https://github.com/DFHack/dfhack/issues/1198#issuecomment-352147845"},"message":"That did it, it looks like if I am over a citizen either with the `v` or `k` selector tools the block remains. if I am off of a unit or a non-citizen unit the item created disappears after unpausing.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1513400639,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MjE2MTYxMg==","github-url":"https://github.com/DFHack/dfhack/issues/1198#issuecomment-352161612"},"message":"Looks like it's teleporting to the position of a magma crab, which is world.units.active[0].","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1513401397,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MjE2MjEzNg==","github-url":"https://github.com/DFHack/dfhack/issues/1198#issuecomment-352162136"},"message":"Interestingly enough, this patch correctly selects the first citizen, but the item is still teleported to the location of units.active[0]. Selecting the same (first) citizen before running `createitem` does *not* teleport the item. Not sure what's going on here.\n\n```diff\ndiff --git a/plugins/createitem.cpp b/plugins/createitem.cpp\nindex e65d1979..79971aa1 100644\n--- a/plugins/createitem.cpp\n+++ b/plugins/createitem.cpp\n@@ -1,5 +1,7 @@\n // Create arbitrary items\n \n+#include \u003calgorithm\u003e\n+\n #include \"Core.h\"\n #include \"Console.h\"\n #include \"Export.h\"\n@@ -11,6 +13,7 @@\n #include \"modules/Gui.h\"\n #include \"modules/Items.h\"\n #include \"modules/Materials.h\"\n+#include \"modules/Units.h\"\n #include \"modules/World.h\"\n \n #include \"DataDefs.h\"\n@@ -354,15 +357,25 @@ command_result df_createitem (color_ostream \u0026out, vector \u003cstring\u003e \u0026 parameters)\n     df::unit *unit = Gui::getSelectedUnit(out, true);\n     if (!unit)\n     {\n+        auto \u0026active = world-\u003eunits.active;\n         if (*gametype == game_type::ADVENTURE_ARENA || World::isAdventureMode())\n         {\n             // Use the adventurer unit\n-            unit = world-\u003eunits.active[0];\n+            unit = active[0];\n         }\n-        else if (!world-\u003eunits.active.empty() \u0026\u0026 cursor-\u003ex \u003e= 0)\n+        else if (!active.empty() \u0026\u0026 cursor-\u003ex \u003e= 0)\n         {\n+            auto iter = find_if(active.begin(), active.end(), Units::isCitizen);\n+            if (iter != active.end()) {\n+                unit = *iter;\n+            }\n+            else {\n+                out.printerr(\"Could not find a citizen on the map. Please select a unit.\\n\");\n+                return CR_FAILURE;\n+            }\n+            out.print(\"found unit %i\\n\", unit-\u003eid);\n             // Use the first possible unit and the cursor position\n-            unit = world-\u003eunits.active[0];\n+            unit = active[0];\n             move_to_cursor = true;\n         }\n         else\n```","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1513401419,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDEzOTA2MzEzMzc="},"added":["bug"],"removed":[]},{"type":3,"author":{"id":"5221f59e75ea9db114593bbdfb180b7354aef9ed"},"timestamp":1513428155,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MjE4MTE5MA==","github-url":"https://github.com/DFHack/dfhack/issues/1198#issuecomment-352181190"},"message":"The problem is most likely in the \"move_to_cursor\" logic - modifying the makeItem function to ensure that it only ever calls item-\u003emoveToGround() *once* (either adding \"if (move_to_cursor) on_ground = false;\" or by reversing the on_ground/move_to_cursor cases and using \"else if\") should fix the problem.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1513458407,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MjIxMTg1Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1198#issuecomment-352211853"},"message":"Yeah, that fixed it. Thanks!","files":null},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1513458623,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTM5MDg3NzA0NA=="},"status":2}]}