{"version":1,"ops":[{"type":1,"author":{"id":"6a08ce56ad514124fb3932e81e3105edd8abfb04"},"timestamp":1447544509,"metadata":{"github-id":"MDU6SXNzdWUxMTY5NjAyNDY=","github-url":"https://github.com/DFHack/dfhack/issues/747","origin":"github"},"title":"malformed keybinding invocations in onLoadWorld.init crash DFHack","message":"**Issue:** a malformed _keybinding_ command executed in onLoadWorld.init will crash DF/DFHack when a game is loaded.  \n- On Windows the window simply disappears - no crash message.  \n- On Linux, it seg faults: `Segmentation fault (core dumped)`\n\n**Systems tested:**\n- Windows 10, x64, DFHack downloaded from releases\n- Linux, Ubuntu 15.04 x64, DFHack self-compiled (GCC 4.9)\n\n**Replication steps**:\n- DF 40.24\n  - Windows: Customised init with Spacefox 16x16 art\n  - Linux: Tested with the same, and also default init, art and raw files\n- DFHack -r4, entirely as per release (no extra plugins added.)\n- Only default DFHack config: `dfhack.init.example` renamed `dfhack.init`; no other init except:\n- Create `onLoadWorld.init` with the following single line:\n  `keybinding crashme`\n- Run DF, load a save.  \n  - On Windows: at the end of the normal DF loading, DF and DFHack windows will disappear.\n  - On Linux, the same except it displays a segfault: `Segmentation fault (core dumped)`\n  - `stderr.log` last line will be `keybinding crashme`\n- Further tests performed:\n  - Crash: Various other invalid keybinding commands\n    - The original command that caused me to find this was mistakenly using: `keybinding remove Ctrl-K` instead of `clear`\n  - No Crash: Same command added to dfhack.init\n    - shows expected \"keybinding: usage\" in DFHack console\n  - No Crash: Other invalid commands not involving keybinding\n    - `workflow crashme`\n    - `fix-unit-occupancy crashme`\n    - `crashme`\n    - all result in expected \"Usage\" display in Console.\n- I have loaded multiple saves and multiple worlds, and three crashed and one did not\n  - Specifically, I have two worlds available and I loaded two saves from each world\n    - World 1: both saves crashed\n    - World 2: one save crashed, the other did not.\n  - It may therefore be related to information on-screen at the time?\n\nSave game that will trigger the issue when `onLoadWorld.init` is created as described above: https://goo.gl/NdbnnN\n\nNote that this save uses Modest Mod + Accelerated, which removes a lot of object information.  However the other world I tested is non-modded and crashed the same.\n\nIf required I can upload the save I tested that did not crash.\n\nI have not yet tested this on -r3, only -r4.","files":null}]}