{"version":1,"ops":[{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1433536972,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDMyMzk2NjE5OQ=="},"added":["bug"],"removed":[]},{"type":3,"author":{"id":"78ba4f5d813d93eaa6e692a2e66d44d9e98552ad"},"timestamp":1433969691,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDExMDkxMTAzOQ==","github-url":"https://github.com/DFHack/dfhack/issues/628#issuecomment-110911039"},"message":"Hey, I think I managed to fix it! Mostly.\nI took a long hard look at the working stuff in nb_item_info and found the discrepancies that did it.\n\nGetReactionProduct\n\nSwitching out this:\n\n``` lua\n    for k,v in pairs (inmat.reaction_product.id) do\n        if v.value == reaction then\n            return {inmat.reaction_product.material.mat_type[k],\n                    inmat.reaction_product.material.mat_index[k]}\n```\n\n...for this:\n\n``` lua\n    for k,v in pairs (inmat.reaction_product.id) do\n        if v.value == reaction then\n            return inmat.reaction_product.material.mat_type[k],inmat.reaction_product.material.mat_index[k]\n```\n\n...got the \"decode\" failure to shut up. No idea why, maybe it's a lua formatting thing. After that, the brewable plant snagged on the \"targetmat\" error like the rest.\n\nLooking at this:\n\n``` lua\n        for k,v in pairs (plant.material_defs) do\n            if v ~= -1 and string.find (k,\"type_\") and not string.find (k,\"type_basic\")\n                    or string.find (k,\"type_seed\") or string.find (k,\"type_tree\") then\n                local targetmat = dfhack.matinfo.decode (v,\n                    plant.material_defs[\"idx_\"..string.match (k,\"type_(.+)\")])\n```\n\n...showed that there was a single set of parentheses missing from the original that wrapped together the three latter string.find commands, like this:\n\n``` lua\n        for k,v in pairs (plant.material_defs) do\n            if v ~= -1 and string.find (k,\"type_\") and not (string.find (k,\"type_basic\")\n                    or string.find (k,\"type_seed\") or string.find (k,\"type_tree\")) then\n                local targetmat = dfhack.matinfo.decode (v,\n                    plant.material_defs[\"idx_\"..string.match (k,\"type_(.+)\")])\n```\n\n...and that did it! I can see at least one thing wrong, though.\n![Shot of the mangled end result](http://i.imgur.com/RGzmp9q.png)\n\nStill not an optimal result. I don't have the brains to figure out where that other product is leaking from right now, but at least it looks like it won't scream the console full of red anymore.\n\nedit: Blood amaranths don't have the extra \"...is brewed into\" line like prickle berries and potatoes do. The cave wheat and rock nuts in the wagon don't trigger any product information lines at all.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1433976808,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDExMDk0MDQ5Nw==","github-url":"https://github.com/DFHack/dfhack/issues/628#issuecomment-110940497"},"message":":+1: Make a pull request!\nAlso, you can copy text from the console on Windows instead of taking screenshots by right-clicking in the title bar.","files":null},{"type":3,"author":{"id":"78ba4f5d813d93eaa6e692a2e66d44d9e98552ad"},"timestamp":1433979367,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDExMDk0NjUxNA==","github-url":"https://github.com/DFHack/dfhack/issues/628#issuecomment-110946514"},"message":"Noted. Also, I think we can open another issue for the rest of this mess.","files":null},{"type":4,"author":{"id":"78ba4f5d813d93eaa6e692a2e66d44d9e98552ad"},"timestamp":1433979387,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MzI3OTgwNzQ1"},"status":2}]}