{"version":1,"ops":[{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1592669342,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDM0NjQ4MTMzMTc="},"added":["bug"],"removed":[]},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1592669700,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY0NzAxNTIwNA==","github-url":"https://github.com/DFHack/dfhack/issues/1594#issuecomment-647015204"},"message":"Interestingly enough, the only one of those mentioned explicitly in exportlegends is `slayer_caste`, but I think it's effectively a no-op that can be removed:\nhttps://github.com/DFHack/scripts/blob/47d9b3c9390d21ecc49ddaba477b16071884ee87/exportlegends.lua#L835-L836\n`v` there is a `history_hit_item` which doesn't even have those two fields:\nhttps://github.com/DFHack/df-structures/blob/bc42fe3114a7943850b32231559adf54bb1d0c60/df.history.xml#L20-L34","files":null},{"type":3,"author":{"id":"d4ba99f16422e9377de56dab81d2b84415f00388"},"timestamp":1592671112,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY0NzAxODIxMw==","github-url":"https://github.com/DFHack/dfhack/issues/1594#issuecomment-647018213"},"message":"In `historical_events` the type changes depending on the events.\nHere is an example of where the `slayer_caste` is present:\n```\n[DFHack]# lua ~df.global.world.history.events[272]\n\u003chistory_event_hist_figure_diedst: 0x7fffaa352a10\u003e\nyear                   \t = 4\nseconds                \t = -1\nflags                  \t = \u003cBitArray\u003c\u003e: 0x7fffaa352a20\u003e\nid                     \t = 309\nvictim_hf              \t = 101\nslayer_hf              \t = 34\nslayer_race            \t = 819\nslayer_caste           \t = 0\nweapon                 \t = \u003chistory_hit_item: 0x7fffaa352a44\u003e\nsite                   \t = -1\nsubregion              \t = 1\nfeature_layer          \t = -1\ndeath_cause            \t = 7\n```\nAnd here the `old_caste` and `new_caste`:\n```\n[DFHack]# lua ~df.global.world.history.events[134]\n\u003chistory_event_change_creature_typest: 0x7fffaa34e990\u003e\nyear                   \t = 1\nseconds                \t = 201600\nflags                  \t = \u003cBitArray\u003c\u003e: 0x7fffaa34e9a0\u003e\nid                     \t = 151\nchangee                \t = 98\nchanger                \t = 34\nold_race               \t = 573\nold_caste              \t = 0\nnew_race               \t = 819\nnew_caste              \t = 1\n```\nSo it will just print all other values that are not handled in one of the if statements and print them directly.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1592671531,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY0NzAxOTA0OA==","github-url":"https://github.com/DFHack/dfhack/issues/1594#issuecomment-647019048"},"message":"Right - my point was unrelated, just pointing out that the one occurrence of `slayer_caste` in the script is actually not doing anything at the moment. I think you're correct about where the problematic line is: https://github.com/DFHack/scripts/blob/47d9b3c9390d21ecc49ddaba477b16071884ee87/exportlegends.lua#L856","files":null},{"type":3,"author":{"id":"d4ba99f16422e9377de56dab81d2b84415f00388"},"timestamp":1592671919,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY0NzAxOTgxMA==","github-url":"https://github.com/DFHack/dfhack/issues/1594#issuecomment-647019810"},"message":"I could handle this at some point in the future, if you want me to. Just don't have the time right now. But wanted to get this filed so it is not forgotten.","files":null}]}