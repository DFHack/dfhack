{"version":1,"ops":[{"type":3,"author":{"id":"4f2823b111a40d19603a11dc9e0f3c589bea0f03"},"timestamp":1330122568,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQxNjY0MTM=","github-url":"https://github.com/DFHack/dfhack/issues/132#issuecomment-4166413"},"message":"Interesting. I never tried to build libgraphics myself, but if this is true, then it would mean building libgraphics actually changes the DF binary too... which is weird.\n\nYou could try adding the md5 sum it found to the symbols.xml file roughly at this point:\nhttps://github.com/peterix/df-structures/blob/master/symbols.xml#L237\nusing the line above as an example. It's possible this will work with no further changes... and it's also possible that DFHack will break. Hard to tell really. I'd be interested in what happens :)","files":null},{"type":3,"author":{"id":"9072dce320fe1cce1508c8c130f4ff658672e5a9"},"timestamp":1330122899,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQxNjY1MTA=","github-url":"https://github.com/DFHack/dfhack/issues/132#issuecomment-4166510"},"message":"In fact, the main itself is in the libgraphics.so file, although the executable and system code calling main is still in the Dwarf_Fortress executable.\n\nI don't know what information dfhack relies on to determine whether the running process is a DF instance or not, but I'm pretty sure that the executable code is untouched. Although the shared symbols (the order they are loaded and their location?) may be.\n\nI'll try with the original libgraphics.so as well and see if anything changes. I missed the md5 in the log file, I'll try using it.","files":null},{"type":3,"author":{"id":"a6d2abf78871d7b4f339b9521961addb6a015515"},"timestamp":1330123908,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQxNjY3ODM=","github-url":"https://github.com/DFHack/dfhack/issues/132#issuecomment-4166783"},"message":"I've tried fiddling with my libgraphics.so and changing it doesn't alter the md5 that DFHack sees. Your Dwarf Fortress executable is different -- Linux 0.34.02 downloaded from Bay12 gives this:\n\n```\nELF Header:\nMagic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00 \nClass:                             ELF32\nData:                              2's complement, little endian\nVersion:                           1 (current)\nOS/ABI:                            UNIX - System V\nABI Version:                       0\nType:                              EXEC (Executable file)\nMachine:                           Intel 80386\nVersion:                           0x1\nEntry point address:               0x804c990\nStart of program headers:          52 (bytes into file)\nStart of section headers:          14103244 (bytes into file)\nFlags:                             0x0\nSize of this header:               52 (bytes)\nSize of program headers:           32 (bytes)\nNumber of program headers:         8\nSize of section headers:           40 (bytes)\nNumber of section headers:         28\nSection header string table index: 27 \n```\n\nAnd, edited to match your ELF header:\n\n```\nELF Header:\nMagic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00 \nClass:                             ELF32\nData:                              2's complement, little endian\nVersion:                           1 (current)\nOS/ABI:                            UNIX - System V\nABI Version:                       0\nType:                              EXEC (Executable file)\nMachine:                           Intel 80386\nVersion:                           0x1\nEntry point address:               0x804c990\nStart of program headers:          52 (bytes into file)\nStart of section headers:          14101412 (bytes into file)\nFlags:                             0x0\nSize of this header:               52 (bytes)\nSize of program headers:           32 (bytes)\nNumber of program headers:         8\nSize of section headers:           40 (bytes)\nNumber of section headers:         27\nSection header string table index: 26\n```\n\nYou have a different number of section headers and a different offset for the start of the section headers, for some reason.","files":null},{"type":3,"author":{"id":"9072dce320fe1cce1508c8c130f4ff658672e5a9"},"timestamp":1330125617,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQxNjcyMDA=","github-url":"https://github.com/DFHack/dfhack/issues/132#issuecomment-4167200"},"message":"Indeed, for some reason, a \".comment\" section is stripped out from the binary during my packaging or installation process.\n\nThe executable I use in my sources has been imported from df_34_02_linux.tar.bz2 (and the header is identical as the one you've pasted above), and the only operation that may have modified it is the debian packaging process or the installation of the package itself.\n\nI'll try to find out what does this exactly, but it's good to know.","files":null},{"type":3,"author":{"id":"a6d2abf78871d7b4f339b9521961addb6a015515"},"timestamp":1330126195,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQxNjczMTc=","github-url":"https://github.com/DFHack/dfhack/issues/132#issuecomment-4167317"},"message":"It's the installation that's doing it. Running \"strip -R .comment Dwarf_Fortress\" gives me the same md5sum as you, and I found reference to Debian's \"install -s\" using \"--remove-section=.comment\" here: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=188731","files":null},{"type":3,"author":{"id":"9072dce320fe1cce1508c8c130f4ff658672e5a9"},"timestamp":1330174961,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQxNzI3MDQ=","github-url":"https://github.com/DFHack/dfhack/issues/132#issuecomment-4172704"},"message":"Alright, I'll close this as I know now the origin of the problem (and as updating the md5 works fine).","files":null},{"type":4,"author":{"id":"9072dce320fe1cce1508c8c130f4ff658672e5a9"},"timestamp":1330174961,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTAyMjA2MDY="},"status":2},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1423168956,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDIzMTA0Njg2Mg=="},"added":["bug"],"removed":[]}]}