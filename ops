{"version":1,"ops":[{"type":1,"author":{"id":"3777bd9464a985e5d5f5348b51d9318b5e1c4118"},"timestamp":1582573191,"metadata":{"github-id":"MDU6SXNzdWU1NzAwOTA5NDM=","github-url":"https://github.com/DFHack/dfhack/issues/1506","origin":"github"},"title":"Protobuf build problems due to missing include \u003cfstream\u003e","message":"I just tried to build dfhack on Fedora 32 (with gcc 10), and protobuf failed to compile:\n\n```\n/builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/message.cc: In member function ‘bool google::protobuf::Message::ParseFromIstream(std::istream*)’:\n/builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/message.cc:130:60: error: invalid use of incomplete type ‘std::istream’ {aka ‘class std::basic_istream\u003cchar\u003e’}\n  130 |   return ParseFromZeroCopyStream(\u0026zero_copy_input) \u0026\u0026 input-\u003eeof();\n      |                                                            ^~\nIn file included from /usr/include/c++/10/bits/localefwd.h:41,\n                 from /usr/include/c++/10/string:43,\n                 from /builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/stubs/common.h:41,\n                 from /builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/stubs/hash.h:39,\n                 from /builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/message.cc:36:\n/usr/include/c++/10/iosfwd:83:11: note: declaration of ‘std::istream’ {aka ‘class std::basic_istream\u003cchar\u003e’}\n   83 |     class basic_istream;\n      |           ^~~~~~~~~~~~~\n/builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/message.cc: In member function ‘bool google::protobuf::Message::ParsePartialFromIstream(std::istream*)’:\n/builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/message.cc:135:67: error: invalid use of incomplete type ‘std::istream’ {aka ‘class std::basic_istream\u003cchar\u003e’}\n  135 |   return ParsePartialFromZeroCopyStream(\u0026zero_copy_input) \u0026\u0026 input-\u003eeof();\n      |                                                                   ^~\nIn file included from /usr/include/c++/10/bits/localefwd.h:41,\n                 from /usr/include/c++/10/string:43,\n                 from /builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/stubs/common.h:41,\n                 from /builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/stubs/hash.h:39,\n                 from /builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/message.cc:36:\n/usr/include/c++/10/iosfwd:83:11: note: declaration of ‘std::istream’ {aka ‘class std::basic_istream\u003cchar\u003e’}\n   83 |     class basic_istream;\n      |           ^~~~~~~~~~~~~\n/builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/message.cc: In member function ‘bool google::protobuf::Message::SerializeToOstream(std::ostream*) const’:\n/builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/message.cc:175:16: error: invalid use of incomplete type ‘std::ostream’ {aka ‘class std::basic_ostream\u003cchar\u003e’}\n  175 |   return output-\u003egood();\n      |                ^~\nIn file included from /usr/include/c++/10/bits/localefwd.h:41,\n                 from /usr/include/c++/10/string:43,\n                 from /builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/stubs/common.h:41,\n                 from /builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/stubs/hash.h:39,\n                 from /builddir/build/BUILD/dfhack-0.47.03-alpha0/depends/protobuf/google/protobuf/message.cc:36:\n/usr/include/c++/10/iosfwd:86:11: note: declaration of ‘std::ostream’ {aka ‘class std::basic_ostream\u003cchar\u003e’}\n   86 |     class basic_ostream;\n      |           ^~~~~~~~~~~~~\n```\n\nAfter digging around a bit I was able to fix the problem by adding an ```#include \u003cfstream\u003e``` to protobuf/message.cc. I'm not sure what changed, exactly, that caused this problem (it only started happening for me on Fedora 32/gcc 10, but might be unrelated to these), but I guess this vanished from another file somewhere and suddenly needed to be explicitly included.\n\nIt's not obvious to me what the right thing to do upstream is-- just add that include?","files":null}]}