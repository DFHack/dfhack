{"version":1,"ops":[{"type":1,"author":{"id":"d4ba99f16422e9377de56dab81d2b84415f00388"},"timestamp":1588023677,"metadata":{"github-id":"MDU6SXNzdWU2MDc4NzI1OTc=","github-url":"https://github.com/DFHack/dfhack/issues/1557","origin":"github"},"title":"ExportLegends: historical_events have reason as object and value","message":"This talks about the [exportlegends.lua](https://github.com/DFHack/scripts/blob/master/exportlegends.lua) script.\n\nIn historical_events the `\u003creason\u003e`-tag has double meaning.\nIt contains a value if type is: change_hf_state\nAnd contains a structure if type is: artifact_created (and a bunch of other types)\nThis could mess with programs that parse the files.\n\nHere the 2 results:\n```\n\u003chistorical_event\u003e\n        \u003cid\u003e0\u003c/id\u003e\n        \u003ctype\u003echange_hf_state\u003c/type\u003e\n        \u003chfid\u003e0\u003c/hfid\u003e\n        \u003cstate\u003e1\u003c/state\u003e\n        \u003creason\u003e-1\u003c/reason\u003e \u003c!-- Here as value --\u003e\n        \u003csite\u003e-1\u003c/site\u003e\n\u003c/historical_event\u003e\n\n\u003chistorical_event\u003e\n        \u003cid\u003e414\u003c/id\u003e\n        \u003ctype\u003eartifact_created\u003c/type\u003e\n        \u003cartifact_id\u003e0\u003c/artifact_id\u003e\n        \u003ccreator_unit_id\u003e-1\u003c/creator_unit_id\u003e\n        \u003ccreator_hfid\u003e306\u003c/creator_hfid\u003e\n        \u003csite\u003e-1\u003c/site\u003e\n        \u003ccircumstance\u003e\n                \u003ctype\u003e-1\u003c/type\u003e\n        \u003c/circumstance\u003e\n        \u003creason\u003e \u003c!-- Here as structure --\u003e\n                \u003ctype\u003enone\u003c/type\u003e\n        \u003c/reason\u003e\n\u003c/historical_event\u003e\n```\n\nThe first `\u003creason\u003e` is generated by: \nhttps://github.com/DFHack/scripts/blob/2079b9fb69b8b4db48aa35ec54a96f5cca7cc8ef/exportlegends.lua#L856\n```\nelse\n    file:write(\"\\t\\t\u003c\"..k..\"\u003e\"..tostring(v)..\"\u003c/\"..k..\"\u003e\\n\")\n```\n\nThe second `\u003creason\u003e` is generated by: \nhttps://github.com/DFHack/scripts/blob/2079b9fb69b8b4db48aa35ec54a96f5cca7cc8ef/exportlegends.lua#L626\n```\nfile:write(\"\\t\\t\u003creason\u003e\\n\")\n```\n\nI would suggest changing the name of the second instance to something else. This tag was added about a month ago in: https://github.com/DFHack/scripts/commit/2b4b9ae73f21a4253312cf61b97ecfd479a49928\n\nHere are some possible options to change it to: `\u003ccause\u003e`, `\u003cevent_reason\u003e`, `\u003ccausation\u003e`, ...","files":null}]}