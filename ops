{"version":1,"ops":[{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1460391326,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDIwODQzMTE3Ng==","github-url":"https://github.com/DFHack/dfhack/issues/892#issuecomment-208431176"},"message":"DFHack needs to be built in an actual git repository, or it will fail to build when trying to generate version information.","files":null},{"type":3,"author":{"id":"3777bd9464a985e5d5f5348b51d9318b5e1c4118"},"timestamp":1460397245,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDIwODQ3MzkxNA==","github-url":"https://github.com/DFHack/dfhack/issues/892#issuecomment-208473914"},"message":"Well, in that case, .git should be included with such a tarball as well.\n\nMy other agenda for asking this is that I'd like to start building RPM packages of dfhack for Fedora, and it'd be much more convenient if there was a single tarball I could point my spec file at that was officially provided by dfhack upstream. :)","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1460408069,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDIwODU1NzE2MQ==","github-url":"https://github.com/DFHack/dfhack/issues/892#issuecomment-208557161"},"message":"I don't think distributing .git would be a good idea for a couple reasons:\n- In the two main clones I have set up, .git is over 130 MB. This is probably more like 100 MB for a fresh clone, but that's still unreasonable to distribute (it's over an order of magnitude larger than the source tarball). Compressing it is unlikely to shrink its size significantly.\n- .git is largely a \"black box\" of sorts - I don't think it's safe to rely on any git version being able to use any .git folder (at least not across different platforms, and providing separate source distributions for all platforms isn't any better)\n\nAnyway, you already need git installed to build DFHack (one step of the build process shells out to git). I'm not familiar with RPM packages at all, but is it really impossible to have a package grab source code from a git repo? Just `git clone --depth=1 --recursive -b master git://github.com/dfhack/dfhack \u0026\u0026 cd dfhack \u0026\u0026 git tag some-release-name` would be enough to get DFHack building with minimal space requirements.\n\nOne possible solution (on our end) would be to distribute the generated files that contain git information for releases somehow, and alter git-describe.cmake to use those instead of shelling out to git when a specific option is passed to cmake. The issue there is that the file has to contain the current commit ID (and other information), which is somewhat of a challenge to do with git.","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1460408074,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDYyMzEzMDU0OA=="},"added":["idea"],"removed":[]},{"type":3,"author":{"id":"3777bd9464a985e5d5f5348b51d9318b5e1c4118"},"timestamp":1460425559,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDIwODY2MDI1NA==","github-url":"https://github.com/DFHack/dfhack/issues/892#issuecomment-208660254"},"message":"\u003e In the two main clones I have set up, .git is over 130 MB. This is probably more like 100 MB for a fresh clone, but that's still unreasonable to distribute (it's over an order of magnitude larger than the source tarball). Compressing it is unlikely to shrink its size significantly.\n\nThis could be averted by running with `--depth -1`, no? That seems to result (in a brand new clone) of a `.git` with size around 4 MB, which is much more reasonable. However:\n\n\u003e .git is largely a \"black box\" of sorts - I don't think it's safe to rely on any git version being able to use any .git folder (at least not across different platforms, and providing separate source distributions for all platforms isn't any better)\n\nThat's a good point, yeah. I certainly know nothing about the structure of a .git directory.\n\n\u003e Anyway, you already need git installed to build DFHack (one step of the build process shells out to git). I'm not familiar with RPM packages at all, but is it really impossible to have a package grab source code from a git repo? Just git clone --depth=1 --recursive -b master git://github.com/dfhack/dfhack \u0026\u0026 cd dfhack \u0026\u0026 git tag some-release-name would be enough to get DFHack building with minimal space requirements.\n\nHaving git installed as a build dependency isn't the issue; the issue would be downloading additional source code during the package build.\n\nWhile it would be technically possible (I think) to have a spec file do that, it would be \"bad practice\"; the Fedora packaging guidelines (and by extension the rpmfusion guidelines, which is likely where a dfhack RPM would end up-- rpmfusion is the biggest \"unofficial\" Fedora repository of nonfree software or stuff that depends on nonfree software) require that it be possible for packages to be built without an internet connection. \n\nHaving said that, I _could_ run those commands myself, tar up the contents, and then pass them to `rpmbuild` as the source tarball; that would be fine (or write a small helper script to do it). It'd just be a mild inconvenience to have to remake the tarball every time I go to rebuild the package, which is why I was wondering if this would be a thing dfhack upstream could distribute. \n\nBut it sounds like the simplest solution is probably that I just deal with this downstream when making the package, which is fine. I may be the only person who would actually benefit from these changes anyway. :)\n\n\u003e One possible solution (on our end) would be to distribute the generated files that contain git information for releases somehow, and alter git-describe.cmake to use those instead of shelling out to git when a specific option is passed to cmake. The issue there is that the file has to contain the current commit ID (and other information), which is somewhat of a challenge to do with git.\n\nPossibly this could be done with some kind of push receive hook, or something?  But yes, I agree it would probably be difficult.","files":null},{"type":3,"author":{"id":"3777bd9464a985e5d5f5348b51d9318b5e1c4118"},"timestamp":1466197826,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDIyNjg4MjQxMA==","github-url":"https://github.com/DFHack/dfhack/issues/892#issuecomment-226882410"},"message":"Just to follow up here, I've written the following script to do this, if anyone else should want it for whatever reason-- build-dfhack-tarball. The resulting tarball can be used to build and install dfhack without network access.\n\n```\n#!/bin/bash\n\n# Run this script as \"build-dfhack-tarball RELEASE_NAME\":\n\nRELEASE_NAME=$1\n\nUPSTREAM=\"git://github.com/dfhack/dfhack\"\n\n# Fetch the repo.\ngit clone --depth=1 --recursive -b ${RELEASE_NAME} ${UPSTREAM}\n\n# Tarball it up.\ntar cfJv dfhack-${RELEASE_NAME}.tar.bz2 dfhack/\n\n# Delete checkout directory.\nrm -rfv dfhack/\n\necho \"Done. Wrote dfhack-${RELEASE_NAME}.tar.bz2.\"\n```\n\n(I haven't actually made progress working on a dfhack RPM for Fedora, unfortunately, as I haven't had the time. But I still intend to have a go at it sometime!)","files":null},{"type":3,"author":{"id":"3777bd9464a985e5d5f5348b51d9318b5e1c4118"},"timestamp":1466226985,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDIyNjkyMjc5Mg==","github-url":"https://github.com/DFHack/dfhack/issues/892#issuecomment-226922792"},"message":"\u003e (I haven't actually made progress working on a dfhack RPM for Fedora, unfortunately, as I haven't had the time. But I still intend to have a go at it sometime!)\n\nAnd by \"sometime\", I apparently meant \"this evening\"; there are now functioning (but not yet entirely polished) dfhack packages available [here](https://www.acm.jhu.edu/~bjr/pages/dwarf-fortress-for-fedora.html). :)\n\nThis can probably be closed, as the script above is sufficient for my purpose.","files":null},{"type":3,"author":{"id":"f7b5a7930d0e1264ae1e4a774b03a7e78c2b7858"},"timestamp":1470741064,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDIzODUyMjcxOA==","github-url":"https://github.com/DFHack/dfhack/issues/892#issuecomment-238522718"},"message":"@lethosor - issue closable?","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1470778387,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDIzODY5ODc2Mg==","github-url":"https://github.com/DFHack/dfhack/issues/892#issuecomment-238698762"},"message":"Sure.","files":null},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1470778387,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NzUwNTAwNDE1"},"status":2}]}