{"version":1,"ops":[{"type":1,"author":{"id":"50f59a96b9b7e087929d72d59e95c4aa34b5cdc8"},"timestamp":1577788332,"metadata":{"github-id":"MDU6SXNzdWU1NDQxNTM0NzE=","github-url":"https://github.com/DFHack/dfhack/issues/1477","origin":"github"},"title":"dfhack console causes SEGFAULT with Steam","message":"When launching the DF executable with DFHack via Steam's \"non-Steam game\" shortcut, either using the `dfhack` shell script or an executable that exports the relevant DFHack environment variables (`DYLD_LIBRARY_PATH`, `DYLD_FRAMEWORK_PATH`, `DYLD_INSERT_LIBRARIES`), after the DF window is drawn and DFHack finishes loading, DFHack grabs the TTY and attempts to read \u0026 write its console prompt.\n\nHowever when launching DF from Steam, on macOS, there is no TTY, so DF promptly segfaults:\n\n```\nCrashed Thread:        12\n\nException Type:        EXC_BAD_ACCESS (SIGSEGV)\nException Codes:       KERN_INVALID_ADDRESS at 0x0000000000000068\nException Note:        EXC_CORPSE_NOTIFY\n\nâ€¦\n\nThread 12 Crashed:\n0   libsystem_c.dylib             \t0x00007fff71d8c59c flockfile + 18\n1   libsystem_c.dylib             \t0x00007fff71d8dda0 fputs + 66\n2   libdfhack.1.0.0.dylib         \t0x00000001025f26cc DFHack::Console::add_text(DFHack::color_value, std::string const\u0026) + 204\n\n```\n\nDFHack needs a \"-q\" or \"quiet\" option that will prevent ALL attempts to interact with the console.\n\n(Naturally, launching DF without DFHack in this fashion works fine.)","files":null}]}