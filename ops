{"version":1,"ops":[{"type":3,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1498925412,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxMjQ0MDYyMg==","github-url":"https://github.com/DFHack/dfhack/issues/1125#issuecomment-312440622"},"message":"As far as I can see, the error lies in gui.lua:compute_frame_rect() and the same logical flaw occurs with the vertical logic. The lines\n```lua\n local sw = wavail - (spec.l or 0) - (spec.r or 0)  \n local sh = havail - (spec.t or 0) - (spec.b or 0) \n```\nEdit: The blasted insert code keeps removing the newline between the lines, and I can't get it to display correctly...\nessentially remove the left/top boundary twice: first as itself and then as part of the right/bottom one, when both are specified, and you actually want the specified width when specified, and the part to the left when only the right boundary is specified (and the corresponding logic for the vertical case).\nI believe the two lines should be replace by:\n```lua\n       local sw\n\tif spec.r then\n\t  sw = spec.r - (spec.l or 0) + 1\n\telse\n\t  sw = wavail - (spec.l or 0)\n\tend\n\t\n\tlocal sh\n\tif spec.b then\n\t  sh = spec.b - (spec.t or 0) + 1\n\telse\n\t  sh = havail - (spec.t or 0)\n\tend\n```\nI've tried it with a brief test of my bugged case, and it seems to work correctly there, although I haven't tried boundary cases, just resizing the DF window. Since my case has issues with the horizontal logic only, that's what I've tested.","files":null},{"type":2,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1498925610,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50MTE0Njk5NDYwNg=="},"title":"gui.widgets List and Label don't like specification of right frame parameter (gui.lua is guilty)","was":"gui.widgets List and Label don't like specification of right frame parameter (gui.lua is guilty)"},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1498925737,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxMjQ0MDg5OA==","github-url":"https://github.com/DFHack/dfhack/issues/1125#issuecomment-312440898"},"message":"You need three backticks for multi-line code blocks.\n\nAnd as long as it doesn't break existing scripts, that change is fine with me.","files":null},{"type":3,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1498928532,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxMjQ0MzUyMQ==","github-url":"https://github.com/DFHack/dfhack/issues/1125#issuecomment-312443521"},"message":"It definitely shouldn't break existing code that lack r and b parameters respectively, since you end up in the second branch where I've removed what then resolves to  '- 0'.\nProvided that the parameter is actually used as width the top branch is correct, which seems to be the case as the code is read through a number of times. I can't say I'm completely comfortable with my understanding of the gap/alignment stuff, but I can't see anything wrong with it: it looks OK.","files":null},{"type":3,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1498933421,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxMjQ0Nzk4NA==","github-url":"https://github.com/DFHack/dfhack/issues/1125#issuecomment-312447984"},"message":"It DOES \"break\" gui/gm-editor. A list displaying an enum showed only the first character, and an edit box for an integer displayed incorrectly. I've found I've made the mistake of defining what's essentially edit boxes to have exactly the dimensions of the data to fit into it, but the prompt adds an extra character: I assume gui/gm-editor has done the same. However, I'll check the script to verify, and take a look at the list issue as well.","files":null},{"type":3,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1498935516,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxMjQ0OTczMg==","github-url":"https://github.com/DFHack/dfhack/issues/1125#issuecomment-312449732"},"message":"Well, this is a mess...\n\nI've found two errors in dialogs.lua:\n\nIn InputBox:preinit() there's a `frame = { l = 0, r = 0, h = 1 }`. Removing the \"r = 0\" constraint to a single character allows the box to work correctly.\n\nIn ListBox:init the \"self:addviews\" definition contains `frame = { l = 0, r = 0 }`. Removing the definition of a single character box by removing \"r = 0\" causes the listbox to display correctly.\n\nApart from being those instances gui/gm-editor uses, they're also the only ones I can find in that file. I've tested it by commenting out the lines and replaced them with copies without the definition of 'r', and gui/gm-editor seems to return to normal. (\"Seems\" as in all the problems I've seen have been removed, but there are advanced edit options I've never used).\n\nIt also means there is nothing wrong with gui/gm-editor, as it doesn't specify edit field sizes incorrectly (or, indeed, at all).\n\nEdit:\nWhat further testing is needed to accept these three corrections (one in gui.lua and two in dialogs.lua) into DFHack?","files":null},{"type":3,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1501426529,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDMxODkwNzA0MQ==","github-url":"https://github.com/DFHack/dfhack/issues/1125#issuecomment-318907041"},"message":"I've realized I've totally misunderstood the purpose and usage of the 'r' and 'b' frame parameters respectively. Thus, the only errors are me using the parameters as they are not indices but distances from the right and bottom edges, respectively.","files":null},{"type":4,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1501426529,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTE4NDgxNjAxMw=="},"status":2},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1526323697,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDE2MjU1NDQxNzc="},"added":["bug"],"removed":[]},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1526323697,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDE2MjU1NDQxNzg="},"added":["lua"],"removed":[]}]}