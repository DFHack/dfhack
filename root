{"version":1,"ops":[{"type":1,"author":{"id":"d4ba99f16422e9377de56dab81d2b84415f00388"},"timestamp":1590711423,"metadata":{"github-id":"MDU6SXNzdWU2MjY5MTI3MjU=","github-url":"https://github.com/DFHack/dfhack/issues/1580","origin":"github"},"title":"ExportLegends: historical_events non UTF-8","message":"I was parsing a legends(_plus) file and there is a non UTF8 encoded character in the export.\n\nThis character was in `historical_event.item_subtype`. See the `\u003c88\u003e` below.\nThis is a 0x88 this is probably a CP437 encoded character. And should be an `ê` I think.\n([Latin Small Letter E with Circumflex U+00EA](https://unicode-table.com/en/00EA/))\nSo an `thêmnol`? This only appreas in [`[T_WORD:INCONVENIENT:thêmnol]`](https://dwarffortresswiki.org/index.php/Dwarven_language/raw)\n\nSo this field should be escaped.\n\nPart of file output: (my editor converted the `0x88` to `\u003c88\u003e` so that is not the problem.)\n([0x88 is not a printable UTF-8 character](https://unicode-table.com/en/0088/))\n```xml\n\u003chistorical_event\u003e\n        \u003cid\u003e219696\u003c/id\u003e\n        \u003ctype\u003eitem_stolen\u003c/type\u003e\n        \u003citem_type\u003einstrument\u003c/item_type\u003e\n        \u003citem_subtype\u003eth\u003c88\u003emnol\u003c/item_subtype\u003e\n        \u003cmat\u003edwarf bone\u003c/mat\u003e\n        \u003citem\u003e949\u003c/item\u003e\n        \u003centity\u003e814\u003c/entity\u003e\n        \u003chistfig\u003e1592\u003c/histfig\u003e\n        \u003csite\u003e310\u003c/site\u003e\n        \u003cstructure\u003e-1\u003c/structure\u003e\n        \u003ccircumstance\u003e\n                \u003ctype\u003e233\u003c/type\u003e\n                \u003cHistEventCollection\u003e9237\u003c/HistEventCollection\u003e\n        \u003c/circumstance\u003e\n        \u003creason\u003e\n                \u003ctype\u003enone\u003c/type\u003e\n        \u003c/reason\u003e\n\u003c/historical_event\u003e\n```","files":null}]}