{"version":1,"ops":[{"type":1,"author":{"id":"e4bf8bd4d5e909340d062464050b953afa8cd4e7"},"timestamp":1600054269,"metadata":{"github-id":"MDU6SXNzdWU3MDA3MzExNjE=","github-url":"https://github.com/DFHack/dfhack/issues/1646","origin":"github"},"title":"ruby UnitPreference incorrect","message":"In 47.02 r2, ruby values for unit preferences are always 0 for types `:LikeShape` `:LikeItem` `:LikeCreature` `:HateCreature`.\n\nExample of unit that likes circles.\n\n```\n[DFHack]# lua ~unit.status.current_soul.preferences[3]\n\u003cunit_preference: 0x17b5f3380\u003e\ntype                   \t = 8\nitem_type              \t = 4\ncreature_id            \t = 4\ncolor_id               \t = 4\nshape_id               \t = 4\nplant_id               \t = 4\npoetic_form_id         \t = 4\nmusical_form_id        \t = 4\ndance_form_id          \t = 4\nitem_subtype           \t = -1\nmattype                \t = -1\nmatindex               \t = -1\nmat_state              \t = 0\nactive                 \t = true\nprefstring_seed        \t = 861673989\n```\n\n```\n[DFHack]# lua ~world.raws.descriptors.shapes[4]\n\u003cdescriptor_shape: 0x15f907fc0\u003e\nid                     \t = CIRCLE\nwords_str              \t = \u003cvector\u003cstring*\u003e[0]: 0x15f907fc8\u003e\nwords                  \t = \u003cvector\u003cint32_t\u003e[0]: 0x15f907fe0\u003e\nname                   \t = circle\nname_plural            \t = circles\nadj                    \t = \u003cvector\u003cstring*\u003e[0]: 0x15f908008\u003e\ngems_use               \t = \u003cdescriptor_shape.T_gems_use: 0x15f908020\u003e\ncategory               \t = \u003cvector\u003cstring*\u003e[1]: 0x15f908028\u003e\nfaces                  \t = 1\ntile                   \t = 9\n```\n\nBut `shape_id` `shape_tg` for this preference return 0 in ruby instead of 4.","files":null}]}