{"version":1,"ops":[{"type":6,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1539257349,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDEzOTMzNzU4Nw=="},"target":"dc7738b9883277bce4bfc725611afbe21539eedcd65b4e436c661dbfa905d817","message":"The script/plugin (\"names\"?) [edit: it's actually gui/rename] allowing you to assign (nick)names to units and things have largely, but not completely, been made obsolete by native naming support. One of the things DFHack is needed for is to nickname units not belonging to you (such as keeping track of quester groups to easier locate infiltrators when one of them tries to sneak attack, and the whole fortress erupts in chaos). Another usage is to name vampires identified by the arrival message (or identified otherwise). However, if they operate under a false identity, the nickname is attacked to their real name rather than the false one used.\nInterestingly, when updating the nickname, the interface shows a blank nickname, indicating it was retrieved from the false identity, not the real one it's stored to.\nPresumably, this doesn't only affect vampires, but any units operating under a false identity (including, your own migrants if you're unlucky and I've read the bug reports correctly).","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1539194515,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQyODY3MTQyNw==","github-url":"https://github.com/DFHack/dfhack/issues/1410#issuecomment-428671427"},"message":"Is it possible that this was fixed with #1279?","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1539194519,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDE4OTYyNDAwODg="},"added":["bug"],"removed":[]},{"type":3,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1539257289,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQyODg0ODc1Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1410#issuecomment-428848753"},"message":"If #1279 is included in the current DFHack release (0.44.12-r1), as it seems to have been, it wasn't. I'm using the r03 LNP which includes the only 0.44.12 DFHack release made.\nI'll see if I can look into it further, as I've currently got the vampire locked up (in one of the entrance tunnels, so I can kill it once it quester buddies have left).","files":null},{"type":6,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1539257289,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDEzOTMzNzI3OQ=="},"target":"7270de23e457d98f346a04731c6d28f489f30f15743b7cd17edbe10f8cfc13b6","message":"If #1279 is included in the current DFHack release (0.44.12-r1), as it seems to have been, it wasn't. I'm using the r03 LNP which includes the only 0.44.12 DFHack release made.\nI'll see if I can look into it further, as I've currently got the vampire locked up (in one of the entrance tunnels, so I can kill it once it quester buddies have left).\n\nEdit: I've looked a little further. The script I used turned out to be \"gui/rename\", and the issue is not resolved by #1279 (although that probably solved a problem that would have shown up). \nUnits::getVisibleName goes through identities to select the name to display, while Units::setNickName probably hasn't been updated to look at those, so the correct (i.e. the visible) name is retrieved for editing, but the entered nickname is saved to other places.\nI suspect a correction would need to take different cases into consideration, as a nickname of a false identity shouldn't show when/if the unit shows up under a different one (which may be the real one), but a nickname for a real name should reflect back to the hist fig (as is currently the case) as well as the unit.\nI don't yet know if the presence of an identity is a sufficient reason to just update that one and skip the rest, or if units using false identities also have its real identity as one of them, in which case you'd have to detect if an identity is the real one (and update the other entries as well) or a false one (in which case I would expect only that identity should be updated.","files":null},{"type":6,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1539259889,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDEzOTM1MTQ1OQ=="},"target":"7270de23e457d98f346a04731c6d28f489f30f15743b7cd17edbe10f8cfc13b6","message":"If #1279 is included in the current DFHack release (0.44.12-r1), as it seems to have been, it wasn't. I'm using the r03 LNP which includes the only 0.44.12 DFHack release made.\nI'll see if I can look into it further, as I've currently got the vampire locked up (in one of the entrance tunnels, so I can kill it once it quester buddies have left).\n\nEdit: I've looked a little further. The script I used turned out to be \"gui/rename\", and the issue is not resolved by #1279 (although that probably solved a problem that would have shown up). \nUnits::getVisibleName goes through identities to select the name to display, while Units::setNickName probably hasn't been updated to look at those, so the correct (i.e. the visible) name is retrieved for editing, but the entered nickname is saved to other places.\nI suspect a correction would need to take different cases into consideration, as a nickname of a false identity shouldn't show when/if the unit shows up under a different one (which may be the real one), but a nickname for a real name should reflect back to the hist fig (as is currently the case) as well as the unit.\nI don't yet know if the presence of an identity is a sufficient reason to just update that one and skip the rest, or if units using false identities also have its real identity as one of them, in which case you'd have to detect if an identity is the real one (and update the other entries as well) or a false one (in which case I would expect only that identity should be updated.\n\nEdit 2: My vampire has only a single \"extra\" identity, so there's not a copy of a real one in that case, at least. However, the current code does handle identities later, when dealing with demons, but that code seems to update a (presumably assumed false) hist fig id rather than the identity in the false identity, and my vampire's false identity refers to his real hist fig id, so the real hist fig nickname gets set twice.\n\nIf I'm guessing correctly, you'd need to first check for a false identity. If you find one you should probably set its nickname regardless (but that's not done by the current demon handling code, which indicates that guess is wrong). You'd then check if the false identities hfid is the same as the hf's id. If it is, you're done and can return. If it isn't, it's a demon that presumably should have its false hist fig updated, but I don't see why you'd want its real hf or unit to be updated in that case, so I'd suggest you'd quit updating the demon after updating the false histfig (and possibly its unit).\nIf there wasn't a false identity involved, the current code would be invoked to update the unit, current soul, and the histfig (if any).\nHowever, this would need to be fixed by someone who actually knows how demons behave with the current DF code.","files":null},{"type":3,"author":{"id":"c5dc12e676729a798fbc3db3de85bdb7691ec563"},"timestamp":1541609512,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQzNjY5NDU4Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1410#issuecomment-436694583"},"message":"Also, nicknaming a dwarf in fortress mode pre-embark will cause that dwarf to not enage in any work, and be idle all the time when using autolabor/automanager.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1541610165,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQzNjY5ODU2Mg==","github-url":"https://github.com/DFHack/dfhack/issues/1410#issuecomment-436698562"},"message":"I doubt that's the cause, unless you were doing something really strange to rename the dwarf.","files":null}]}