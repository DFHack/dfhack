{"version":1,"ops":[{"type":3,"author":{"id":"d43bbc88f959d3b3a7dc2c667ab022148be6266a"},"timestamp":1589920778,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzMTA2OTcxOA==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-631069718"},"message":"RemoteFortressReader uses google protobuff as the RPC channel.\nThe plugin register the rpc methods\n\nRemoteFortressReader.cpp:238\n`\n\n    DFhackCExport RPCService *plugin_rpcconnect(color_ostream \u0026)\n\n    RPCService *svc = new RPCService();\n\n    svc-\u003eaddFunction(\"GetMaterialList\", GetMaterialList, SF_ALLOW_REMOTE);\n\n    svc-\u003eaddFunction(\"GetGrowthList\", GetGrowthList, SF_ALLOW_REMOTE);\n\n    etc`\n\nAnd the you, as a client,  send each protobuf message type with the in parameters filled and receive the out parameters.\n\nAll the protobuff messages are defined in RemoteFortressReader.proto. For example\n\n\n    message MaterialList\n    {\n        repeated MaterialDefinition material_list = 1;\n    }\n\ncorresponds to the the first function added to the RPC service","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1589931648,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzMTE0NDgwOA==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-631144808"},"message":"devel/dump-rpc is intended for CI to verify that all RPC functions are registered properly. It's not really intended to be user-facing or complete.","files":null},{"type":3,"author":{"id":"50f59a96b9b7e087929d72d59e95c4aa34b5cdc8"},"timestamp":1589990373,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzMTU2NzIwOA==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-631567208"},"message":"Right, I saw the protobuf types.  But they don't help you determine the actual functions.  For example `MaterialList` isn't the first function; it's the return type of the RPC function `GetMaterialList : EmptyMessage -\u003e MaterialList`.\n\n`GetMaterialList` isn't the \"first\" function either, in terms of `id`, even though it appears so.  When an `RPCService` [is finalized](https://github.com/DFHack/dfhack/blob/develop/library/RemoteServer.cpp#L120), it writes pushes its functions to someone else's vector.   That's the confusing part.  There's no indication or way of discerning what order the plugins are so loaded.  By experimentation, the \"first\" function available to RPC clients is `BindMethod` (with `id` = 0).\n\nHow should RFR clients discover the `id`s of methods?\n\nIs there a way to specify methods by string?","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1590074301,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzMjE0NDU1OA==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-632144558"},"message":"https://github.com/RosaryMala/RemoteClientDF-Net/blob/master/DFHack/RemoteFunction.cs and https://github.com/RosaryMala/RemoteClientDF-Net/blob/master/DFHack/RemoteClient.cs seem to be looking up RPC functions by name. @RosaryMala might be more able to answer specific questions about it than me.","files":null},{"type":3,"author":{"id":"8eec94822f0cd94318fe65f78e120bf220e9fbf8"},"timestamp":1590114049,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzMjQ0MTQyOA==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-632441428"},"message":"There's really no real need to know the ID. The IDs are essentially random and shared amongst all plugins, which may or may not add more functions. Part of the server connection handshake involves getting a list of functions and corresponding IDs.","files":null},{"type":3,"author":{"id":"50f59a96b9b7e087929d72d59e95c4aa34b5cdc8"},"timestamp":1590128425,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzMjUwOTc4Ng==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-632509786"},"message":"@RosaryMala \n\u003e Part of the server connection handshake involves getting a list of functions and corresponding IDs.\n\nThe key bit of information.  Is this documented anywhere?\n\nAlso, unrelatedly, do you know why `GetBlocksList` returns an illegal first block with no `map_x`, `map_y`, and `map_z`? [You can see here in GetBlockList()](https://github.com/DFHack/dfhack/blob/0272fd57f8cf662537f1896beca31e2c0041bba8/plugins/remotefortressreader/remotefortressreader.cpp#L1478) that if `firstBlock` is true, but nothing else, then `map_x`, `map_y`, and `map_z` are never written.  This is illegal, as [the protobuf requires those fields](https://github.com/DFHack/dfhack/blob/82f082d7cbd6b823ab4c54d0dfbbf578f7fb1c4a/plugins/proto/RemoteFortressReader.proto#L359).  This frequently happens to me, resulting in protobuf parser failures.  You need to write those fields for every block, i.e. right after `net_block = out-\u003eadd_map_blocks();`.","files":null},{"type":3,"author":{"id":"8eec94822f0cd94318fe65f78e120bf220e9fbf8"},"timestamp":1590159438,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzMjczNjI5MA==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-632736290"},"message":"Yeah, this is indeed an oversight on my part. Feel free to make a PR to fix that, or I can get around it at some point. \n\nThat said, RemoteFortressReader is terrible and I had no idea what I was doing when I wrote it, and it'd probably be a better idea to just kind of make your own from scratch that matches your use-case. Either that, or we can work together to make RFR less terrible.","files":null},{"type":3,"author":{"id":"8eec94822f0cd94318fe65f78e120bf220e9fbf8"},"timestamp":1590160045,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzMjc0MjQ4MQ==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-632742481"},"message":"Okay, fixed in 3db490ee9e31c7a0f950f242b8c338a161a63fcc","files":null},{"type":3,"author":{"id":"50f59a96b9b7e087929d72d59e95c4aa34b5cdc8"},"timestamp":1590195668,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzMjk1OTIyMw==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-632959223"},"message":"Happy to help where I can.  I'm working on browser bindings for native DFHack access from JS, so I'm running across all the problems of a naive implementor of this API.  I think I have the network bindings down for RFR (it's not the best designâ€¦ ðŸ˜†), and am working on a proof-of-concept in-browser viewer now.\n\nTbh I would put all those subsequent tests (e.g. `if (tileChanged) {...} if ...`) within the braces of `if (tileChanged || desChanged || spatterChanged || firstBlock || itemsChanged || flows) {...}` as well.  They're never meant to run when the union isn't true, and hygienic coding practices like that reduce possible bugs from future changes.","files":null},{"type":3,"author":{"id":"50f59a96b9b7e087929d72d59e95c4aa34b5cdc8"},"timestamp":1590196575,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzMjk2MTM1MA==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-632961350"},"message":"@RosaryMala Once it's in a less hideous state, I'll post the JS library on github / the forums.  Any interest in writing a browser-based AV Lite with [voxeljs](http://www.voxeljs.com/) / [threejs](https://threejs.org/)?","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1590200456,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzMjk3MTQ0NA==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-632971444"},"message":"That sounds pretty neat! (Not that I'm a graphics person, but I'll keep an eye out for it)\n\nAlso, documentation of the RPC protocol is practically nonexistent, so we'd gladly also welcome improvements there if you're able to contribute. (I can help with the Sphinx side of things but I'm not really familiar with the RPC side myself)","files":null},{"type":3,"author":{"id":"8eec94822f0cd94318fe65f78e120bf220e9fbf8"},"timestamp":1590201637,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzMjk3MzU1Nw==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-632973557"},"message":"Yeah, I went through a similar thing when I ported remoteclient library from C++ to C+","files":null},{"type":3,"author":{"id":"fefd87bd170e69ba989c5932b26d53a6f30e8666"},"timestamp":1591150521,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzNzkxMTg4Mw==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-637911883"},"message":"There is now a Wireshark dissector for the RPC\n\nhttps://github.com/DFHack/df_misc/blob/master/wireshark_dfhack_rpc.lua","files":null},{"type":3,"author":{"id":"fefd87bd170e69ba989c5932b26d53a6f30e8666"},"timestamp":1591151728,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzNzkxNjk5MA==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-637916990"},"message":"Here's some temporary documentation until it's part of the official DFHack docs: https://gist.github.com/BenLubar/1f51cf570b4c8dca275db9687fa6b9e3\n\nBasically, for anything apart from IDs -4 through 1, you ask method 0 and it gives you back an ID.\n\nID -4 and all non-negative IDs are sent by the client. -3, -2, and -1 are sent by the server.","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1593960421,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDM1MTMzODY5MDk="},"added":["documentation"],"removed":[]},{"type":3,"author":{"id":"50f59a96b9b7e087929d72d59e95c4aa34b5cdc8"},"timestamp":1594060254,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY1NDM5NzUzOA==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-654397538"},"message":"@RosaryMala @BenLubar The JavaScript bindings to DFHack/RFR are now up: https://github.com/alexchandel/dfhack-remote.  It's a very thin wrapper over RFR, but it has every function including Lua commands.\n\nIf anyone has experience with DF + web graphics, we now have the capability for a complete web GUI (no more SDLv1!!!).","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1595399118,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY2MjI2NzU4MQ==","github-url":"https://github.com/DFHack/dfhack/issues/1574#issuecomment-662267581"},"message":"https://docs.dfhack.org/en/latest/docs/Remote.html has been added with more detail (when it's finished building, anyway), largely taken from posts in this thread. It's still preliminary, so let me know if there are any changes you'd like to see.","files":null},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1602389697,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50Mzg2MzMyNDk5NA=="},"status":2}]}