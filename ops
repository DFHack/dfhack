{"version":1,"ops":[{"type":1,"author":{"id":"a55edbee53315f24476eb310d9a4c61bfce4f84c"},"timestamp":1441723276,"metadata":{"github-id":"MDU6SXNzdWUxMDUzOTY2MTA=","github-url":"https://github.com/DFHack/dfhack/issues/682","origin":"github"},"title":"Seedwatch ignores map load event, prevents autoloading of plugin.","message":"# Summary:\n\nIf you try to auto-load `seedwatch` it will always fail, because it ignores DF's map load event.\n# Fix\n\nI think the only code change required is:\n\n```\ncase SC_MAP_LOADED:\ncase SC_MAP_UNLOADED:\n```\n\nto:\n\n```\ncase SC_MAP_LOADED:\n    running = true;\n    out.print(\"seedwatch supervision started.\\n\");\n    break;\n\ncase SC_MAP_UNLOADED:\n```\n\nBecause [`seedwatch start` only toggles a bool](https://github.com/DFHack/dfhack/blob/master/plugins/seedwatch.cpp#L144).\n# Details:\n\nPlacing into one of the automatically ran config files such as `onLoadWorld.init` or `PyLNP_dfhack_onLoad.init` (From the PyLNP pack) will not work. Which gives the following DFHack output error:\n\n```\nseedwatch deactivated due to game load/unload\n```\n\n This is the config used:\n\n```\n# autobutcher runs fine; yet seedwatcher fails.\nenable seedwatch\nenable autobutcher\nseedwatch start\nautobutcher autowatch\nautobutcher start\n\n# Debug output shows seedwatcher fails\nseedwatch info\nautobutcher list\n```\n\nEven with this config every game save and load you must retype `seedwatch start`.\n\nThis is because [seedwatcher does not load on `DFHack::SC_MAP_LOADED`](https://github.com/DFHack/dfhack/blob/master/plugins/seedwatch.cpp#L286), compared to [autobutcher which does](https://github.com/DFHack/dfhack/blob/master/plugins/zone.cpp#L295). (Seedwatcher toggles itself off when the event fires).","files":null}]}