{"version":1,"ops":[{"type":1,"author":{"id":"6879b8f55db2bdc58a4a5acfa01cd947d04b59d2"},"timestamp":1502682171,"metadata":{"github-id":"MDU6SXNzdWUyNDk5MjU3NzA=","github-url":"https://github.com/DFHack/dfhack/issues/1151","origin":"github"},"title":"Lag diagnostic feature?","message":"We're having periodic lags in our fortress, and it reminds me of a case where autochop went crazy and created too many jobs.  Then autounsuspend was waking up too often, walking the huge job list, and dragging the FPS way down:  https://github.com/DFHack/dfhack/issues/1076\n\nTo diagnose the current periodic hang (like 10-20 secs), I've tried disabling some dfhack plugins and/or adding text when they start or stop.  We haven't narrowed it down yet.\n\nWhat would be more convenient, though, is if there was a way to hook into dfhack at a higher level such that any periodic jobs/processes emit what plugin is running and its elapsed time (and cpu time?!).\n\nIs there a central place to do this in the dfhack code?  What is the model for running external lua and ruby?   It seems like there might be a mutex somewhere that gets locked before something is run ... that might be a good spot to add performance reporting.\n\nWith some pointers I might be able to figure it out and make a pull request.\n\nThanks!","files":null}]}