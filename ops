{"version":1,"ops":[{"type":6,"author":{"id":"d4ba99f16422e9377de56dab81d2b84415f00388"},"timestamp":1590711456,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDozODY5NDU0NjQ="},"target":"82d1264958a4214e4f3ae8886789e37234c791a03c19d3114b5a6a430d3558b9","message":"I was parsing a legends(_plus) file and there is a non UTF-8 encoded character in the export.\n\nThis character was in `historical_event.item_subtype`. See the `\u003c88\u003e` below.\nThis is a 0x88 this is probably a CP437 encoded character. And should be an `ê` I think.\n([Latin Small Letter E with Circumflex U+00EA](https://unicode-table.com/en/00EA/))\nSo an `thêmnol`? This only appreas in [`[T_WORD:INCONVENIENT:thêmnol]`](https://dwarffortresswiki.org/index.php/Dwarven_language/raw)\n\nSo this field should be escaped.\n\nPart of file output: (my editor converted the `0x88` to `\u003c88\u003e` so that is not the problem.)\n([0x88 is not a printable UTF-8 character](https://unicode-table.com/en/0088/))\n```xml\n\u003chistorical_event\u003e\n        \u003cid\u003e219696\u003c/id\u003e\n        \u003ctype\u003eitem_stolen\u003c/type\u003e\n        \u003citem_type\u003einstrument\u003c/item_type\u003e\n        \u003citem_subtype\u003eth\u003c88\u003emnol\u003c/item_subtype\u003e\n        \u003cmat\u003edwarf bone\u003c/mat\u003e\n        \u003citem\u003e949\u003c/item\u003e\n        \u003centity\u003e814\u003c/entity\u003e\n        \u003chistfig\u003e1592\u003c/histfig\u003e\n        \u003csite\u003e310\u003c/site\u003e\n        \u003cstructure\u003e-1\u003c/structure\u003e\n        \u003ccircumstance\u003e\n                \u003ctype\u003e233\u003c/type\u003e\n                \u003cHistEventCollection\u003e9237\u003c/HistEventCollection\u003e\n        \u003c/circumstance\u003e\n        \u003creason\u003e\n                \u003ctype\u003enone\u003c/type\u003e\n        \u003c/reason\u003e\n\u003c/historical_event\u003e\n```","files":null},{"type":2,"author":{"id":"d4ba99f16422e9377de56dab81d2b84415f00388"},"timestamp":1590711444,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50MzM4NTE0MTIwNA=="},"title":"ExportLegends: historical_events non UTF-8","was":"ExportLegends: historical_events non UTF-8"},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1590713392,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzNTY5MzYxOA==","github-url":"https://github.com/DFHack/dfhack/issues/1580#issuecomment-635693618"},"message":"I think I fixed this in https://github.com/DFHack/scripts/commit/47d9b3c9390d21ecc49ddaba477b16071884ee87 - I assume you're running 0.47.04-r1? Can you try upgrading the script and see if that fixes it?","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1590713410,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDMzODUyMDIyNjk="},"added":["bug"],"removed":[]},{"type":3,"author":{"id":"d4ba99f16422e9377de56dab81d2b84415f00388"},"timestamp":1591300658,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYzOTA4MzEwNw==","github-url":"https://github.com/DFHack/dfhack/issues/1580#issuecomment-639083107"},"message":"This was still an old export from a previous version.\nUpdated everything and the fix above indeed resolved the issue.\nExport now shows (as expected):\n```xml\n\u003chistorical_event\u003e\n        \u003cid\u003e219696\u003c/id\u003e\n        \u003ctype\u003eitem_stolen\u003c/type\u003e\n        \u003citem_type\u003einstrument\u003c/item_type\u003e\n        \u003citem_subtype\u003ethêmnol\u003c/item_subtype\u003e\n        \u003cmat\u003edwarf bone\u003c/mat\u003e\n        \u003citem\u003e949\u003c/item\u003e\n        \u003centity\u003e814\u003c/entity\u003e\n        \u003chistfig\u003e1592\u003c/histfig\u003e\n        \u003csite\u003e310\u003c/site\u003e\n        \u003cstructure\u003e-1\u003c/structure\u003e\n        \u003ccircumstance\u003e\n                \u003ctype\u003e233\u003c/type\u003e\n                \u003chist_event_collection\u003e9237\u003c/hist_event_collection\u003e\n        \u003c/circumstance\u003e\n        \u003creason\u003e\n                \u003ctype\u003enone\u003c/type\u003e\n        \u003c/reason\u003e\n\u003c/historical_event\u003e\n```","files":null},{"type":4,"author":{"id":"d4ba99f16422e9377de56dab81d2b84415f00388"},"timestamp":1591300658,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MzQwODQ5NjUxNQ=="},"status":2}]}