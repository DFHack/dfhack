{"version":1,"ops":[{"type":1,"author":{"id":"df7feee793b3a4f60453609739052ef8e882d092"},"timestamp":1498815819,"metadata":{"github-id":"MDU6SXNzdWUyMzk3MjkxNDI=","github-url":"https://github.com/DFHack/dfhack/issues/1123","origin":"github"},"title":"The DFHack console can get its colors confused.","message":"I suspect the DFHack console thread has an unsafe handover between the command executed and DFHack's own prompt.\nA couple of small scripts used to produce odd results (at least on my system):\n```lua\nfunction y ()\n  for i = 1, 1000 do\n  dfhack.printerr (\"Do I bleed?\")\n  end\n  dfhack.println (\"What?\")\n--  error (\"Not really...\")\n--  dfhack.println (\"What?\")\n--  dfhack.println (\"What?\")\nend\n\ny ()\n```\nand\n```lua\nfunction z ()\n  dfhack.color (COLOR_BLUE)\n  dfhack.println (\"What color is this?\")\nend\n\nz ()\n```\nEach test is run on a freshly started DF (with an associated DFHack terminal). Script output were as expected unless noted.\n- Running y causes the DFHack prompt to become red (actually light red), and if I run z after that I then get a blue prompt. Typing garbage (in blue) resulted in a red error message and a red prompt.\n- Running z followed by y caused the final standard color output line from y to become blue followed by a blue prompt.","files":null}]}