{"version":1,"ops":[{"type":1,"author":{"id":"a5c87d878b20f41eb4abe3fd98098c0fa4587035"},"timestamp":1549313798,"metadata":{"github-id":"MDU6SXNzdWU0MDY1MTU4NDA=","github-url":"https://github.com/DFHack/dfhack/issues/1431","origin":"github"},"title":"Emotions stress level not modified in `fixnaked`","message":"The `fixnaked.lua` removes the thoughts, but it does not modify the stress level of the unit.\n\nI can work on this, but need some help: I am trying to understand how `add-thought` does this, but I have been unable to reproduce why it does what it does. \n\nSpecifically, below I am looping through the list of units (lua), and compare the stress level of the unit with the stress level computed by the sum of `severity/divider`, which the add-thought [uses](https://github.com/DFHack/scripts/blob/master/add-thought.lua#L44). I am unable to get any reasonable match between the two.\n\n```\nfor _, unit in ipairs(df.global.world.units.all) do\n        if unit.race == df.global.ui.race_id and unit.status.current_soul then\n    \t    local emotions = unit.status.current_soul.personality.emotions\n\n            local stress = 0\n            for i, emotion in pairs(emotions) do\n                  local divider = df.emotion_type.attrs[emotion.type].divider\n                  if divider ~= 0 then\n                      stress = stress + math.ceil(emotion.severity/divider)\n                  end\n            end\n            print(stress, unit.status.current_soul.personality.stress_level)\n        end\nend\n```\n\nmore generally, it seems that `emotion.severity` is almost always 0.","files":null}]}