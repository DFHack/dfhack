{"version":1,"ops":[{"type":2,"author":{"id":"6a08ce56ad514124fb3932e81e3105edd8abfb04"},"timestamp":1447544541,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDY0NjQ5NzA4"},"title":"keybinding: typo/invalid command from onLoadWorld.init crashes DF/Hack","was":"malformed keybinding invocations in onLoadWorld.init crash DFHack"},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447549218,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ2NDY2NjAxMg=="},"added":["bug"],"removed":[]},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447549218,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ2NDY2NjAxMw=="},"added":["crash/hang"],"removed":[]},{"type":2,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447550495,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDY0NjY4MTkz"},"title":"malformed keybinding invocations in onLoadWorld.init crash DFHack","was":"keybinding: typo/invalid command from onLoadWorld.init crashes DF/Hack"},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447552218,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1Njc2OTc4Mw==","github-url":"https://github.com/DFHack/dfhack/issues/747#issuecomment-156769783"},"message":"The problem is the call to `Gui::getFocusString(Core::getTopViewscreen())`. For some reason, the vtable pointer in the top viewscreen is bad at that instant, which causes `virtual_identity::find(void *vtable)` to segfault.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447555118,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1Njc3MTcyNA==","github-url":"https://github.com/DFHack/dfhack/issues/747#issuecomment-156771724"},"message":"Found the problem: `top_viewscreen` is only changed right before SC_VIEWSCREEN_CHANGED events are triggered, which happens _after_ world and map-related events. This means that anything handling those events that refers to `top_viewscreen` is referring to the top viewscreen from the last tick, which was just deleted in this case.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447555939,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1Njc3NDA5Mg==","github-url":"https://github.com/DFHack/dfhack/issues/747#issuecomment-156774092"},"message":"Should be fixed now.\nIf you're curious, the root problem here dates back to at least 0.31.25, although I'm not aware of a way to trigger it prior to 0.34.11-r4, where initial support for onLoad.init scripts was added (9f6638432f28fa534a9045324516224b985ad0d3).","files":null},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447555939,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDY0NjgxMzIz"},"status":2},{"type":3,"author":{"id":"6a08ce56ad514124fb3932e81e3105edd8abfb04"},"timestamp":1447592005,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NjgwOTU5Nw==","github-url":"https://github.com/DFHack/dfhack/issues/747#issuecomment-156809597"},"message":"Good job on the fast fix!","files":null}]}