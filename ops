{"version":1,"ops":[{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447107192,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTIxNTYzMg==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-155215632"},"message":"- Does DF also crash without DFHack (e.g. `./df`)?\n- It looks like you installed it in a MacNewbie pack - did you replace the entire `hack` folder or just overwrite some files? (You should replace the entire folder, although you can rename/back up the old one if you like.)\n- Does the `dfhack-config` folder exist (and have contents)?\n- What plugins do you have enabled (check `plug` or `enable`)? Does disabling everything help?","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447107474,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ1OTQxNjgzNA=="},"added":["crash/hang"],"removed":[]},{"type":3,"author":{"id":"0ca329a55351dcb94457e4b8044a4490f2818e02"},"timestamp":1447111621,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTIzMTY3NA==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-155231674"},"message":"I replaced the entire `hack` folder.  Re: `dfhack-config`, it exists and there is a `dfhack-config/dfstats.lua`, `dfhack-config/dwarfmonitor.json`, and additional copies in `dfhack-config/default`.  Plugins enabled with `enable` are `manipulator`, `autotrade`, `buildingplan`, `resume`, `zone`, `automaterial`, `search`, `stocks`, `automelt`, `autochop`, `dwarfmonitor`, `stockpiles`, `stockflow`, `gui/load-screen`, `title-version`, `trackstop`, `confirm` and `fix-unit-occupancy`.  Additional ones I know I'm using are `seedwatch`, `workflow`, `autolabor` and `autonestbox`.\n\nWorking on testing without dfhack (a bit tricky because I am using `autolabor`) but I'll get back to you ASAP.","files":null},{"type":3,"author":{"id":"0ca329a55351dcb94457e4b8044a4490f2818e02"},"timestamp":1447112171,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTIzMzI5NQ==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-155233295"},"message":"I do not experience a crash running without `dfhack`.  I have not tried isolating plugins yet.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447120003,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTI1Njc5MA==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-155256790"},"message":"I'd try disabling workflow, fix-unit-occupancy, confirm, and dwarfmonitor first (roughly in that order), since they're ones I remember are new or changed in r4. \nWhere's fix-unit-occupancy being enabled, by the way? It doesn't look like it's enabled in dfhack.init-example - did you add it yourself?","files":null},{"type":3,"author":{"id":"0ca329a55351dcb94457e4b8044a4490f2818e02"},"timestamp":1447121875,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTI2MTY4MQ==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-155261681"},"message":"Some digging later, the problem occurs when this plugin list is happening:\n\n```\n        add-spatter:    off (controlled elsewhere)\n           autochop:    off\n           autodump:    off\n         autohauler:    off\n          autolabor:    on\n       automaterial:    off\n           automelt:    off\n          autotrade:    off\n       buildingplan:    off\n            burrows:    on  (controlled elsewhere)\n            confirm:    off\n           digFlood:    off\n    diggingInvaders:    off\n       dwarfmonitor:    off\n       embark-tools:    off\n          fastdwarf:    off\n         fix-armory:    off\n fix-unit-occupancy:    off\n             follow:    off (controlled elsewhere)\n           fortplan:    off\n        infiniteSky:    off\n        manipulator:    off\n         mousequery:    off\n      petcapRemover:    off\n        power-meter:    off (controlled elsewhere)\n             rename:    off (controlled elsewhere)\n             resume:    off\n             reveal:    off (controlled elsewhere)\n               ruby:    off\n             search:    off\n          seedwatch:    off\n       siege-engine:    off\n       steam-engine:    off (controlled elsewhere)\n          stockflow:    off\n         stockpiles:    off\n             stocks:    off\n         stonesense:    on  (controlled elsewhere)\n      title-version:    off\n          trackstop:    off\n              tweak:    on  (controlled elsewhere)\n           workflow:    on\n               zone:    on\n```\n\nand does not happen if I manually disable workflow.","files":null},{"type":3,"author":{"id":"0ca329a55351dcb94457e4b8044a4490f2818e02"},"timestamp":1447122123,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTI2MjM2Mg==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-155262362"},"message":"Yeah, I added it myself.  The crash appears to be happening in workflow.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447128105,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTI3NzQ1OQ==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-155277459"},"message":"This could be a result of #617. Were you using workflow in this save previously (with an older DFHack version), and were workflow jobs present when you updated?","files":null},{"type":3,"author":{"id":"0ca329a55351dcb94457e4b8044a4490f2818e02"},"timestamp":1447129662,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTI4MzIzNw==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-155283237"},"message":"Brand new fort with this DFHack version.  Workflow output appears pretty normal, and is as follows:\n\n```\nConstraint BUCKET amount 10 (gap 5)\n  items: amount 12; 12 stacks available, 0 in use.\n  job 8923: MakeBucket [wood wood2] (suspended)\nConstraint BARREL amount 10 (gap 5)\n  items: amount 22; 22 stacks available, 36 in use.\n  job 8922: MakeBarrel [wood wood2] (suspended)\nConstraint BIN amount 10 (gap 5)\n  items: amount 7; 7 stacks available, 10 in use.\n  job 8921: ConstructBin [wood wood2]\nConstraint FOOD:ITEM_FOOD_BISCUITS amount 50 (gap 35)\n  items: amount 37; 13 stacks available, 0 in use.\n  job 2399: PrepareMeal (suspended)\nConstraint THREAD/PLANT amount 10 (gap 5)\n  items: amount 8; 8 stacks available, 0 in use.\n  job 2401: ProcessPlants (suspended)\nConstraint LIQUID_MISC/PLANT amount 10 (gap 5)\n  job 2402: ProcessPlantsBarrel (suspended)\nConstraint BED amount 10 (gap 5)\n  items: amount 10; 10 stacks available, 0 in use.\n  job 8918: ConstructBed [wood wood2] (suspended)\nConstraint DRINK amount 100 (gap 50)\n  items: amount 45; 9 stacks available, 0 in use.\n  job 2571: BREW_DRINK_FROM_PLANT (suspended)\n  job 2572: BREW_DRINK_FROM_PLANT (suspended)\nConstraint TOOL:ITEM_TOOL_NEST_BOX amount 10 (gap 5)\n  items: amount 11; 11 stacks available, 0 in use.\n  job 8981: MakeTool [wood wood2] (suspended)\nConstraint AMMO:ITEM_AMMO_BOLTS/WOOD amount 50 (gap 20)\n  items: amount 0; 0 stacks available, 4 in use.\n  job 8980: MakeAmmo [wood wood2] (suspended)\nConstraint CHAIR amount 10 (gap 5)\n  items: amount 7; 7 stacks available, 0 in use.\n  job 8920: ConstructThrone [wood wood2]\n  job 9435: ConstructThrone [rock] (suspended)\nConstraint TABLE/WOOD amount 10 (gap 5)\n  items: amount 7; 7 stacks available, 0 in use.\n  job 8919: ConstructTable [wood wood2]\nConstraint CAGE amount 10 (gap 5)\n  items: amount 2; 2 stacks available, 0 in use.\n  job 8924: MakeCage [wood wood2]\n```","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447130368,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTI4NTUxNw==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-155285517"},"message":"Could you upload the save somewhere?\n(@acwatkins: not sure if this is related to #617, but you may be interested)","files":null},{"type":3,"author":{"id":"0ca329a55351dcb94457e4b8044a4490f2818e02"},"timestamp":1447134169,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTMwMDE5OQ==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-155300199"},"message":"I can't remember exactly how much you need (been a while; the new DFHack release was my cue to start playing again) so here's everything: https://www.dropbox.com/s/mfso8zlcuir4j4a/crashydf.zip?dl=0","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447190939,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTU3MjcyMg==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-155572722"},"message":"Just the data/save/regionX folder is enough. Is that 188 MB, or did you compress your entire DF/LNP folder?","files":null},{"type":3,"author":{"id":"0ca329a55351dcb94457e4b8044a4490f2818e02"},"timestamp":1447191081,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTU3MzI2OQ==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-155573269"},"message":"I compressed the entire thing.  Here's just the `data/save/region1`. https://dl.dropboxusercontent.com/u/3088107/crashysave.zip","files":null},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447192136,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ2MDY0NzIxNg=="},"added":["bug"],"removed":[]},{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447192136,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ2MDY0NzIxNw=="},"added":["workflow"],"removed":[]},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447192487,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTU3OTEyNg==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-155579126"},"message":"That save crashes without DFHack for me, but canceling all jobs (without DFHack) stops the crash, so it's likely workflow-related.","files":null},{"type":3,"author":{"id":"41351f340d450d83b1b4f7ee2bf3df35b0b720cf"},"timestamp":1447596041,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NjgxMzY1Ng==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-156813656"},"message":"I have the same crash:\n[dwarfort.exe_2015-11-15-144333_Sinans-iMac.txt](https://github.com/DFHack/dfhack/files/34876/dwarfort.exe_2015-11-15-144333_Sinans-iMac.txt)\n\nVersion:\nhttp://www.bay12forums.com/smf/index.php?topic=128960.msg6353416#msg6353416\n\nSave:\nhttps://dl.dropboxusercontent.com/u/86443457/region1-military.zip\n\nSteps to reproduce:\nCreate a new Squad add all hunters to it, unpause. Wait for it.\n\nIf i disable the workflow plugin it does not crash.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1447596389,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NjgxMzkwNQ==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-156813905"},"message":"Do you have any workflow-enabled jobs? I'm not sure why squads would be related, but workflow jobs would be.","files":null},{"type":3,"author":{"id":"41351f340d450d83b1b4f7ee2bf3df35b0b720cf"},"timestamp":1447597000,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NjgxNDMyNA==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-156814324"},"message":"They will grab armor, quiver and ammo and the corresponding jobs will be resumed.\n\nConstraint FLASK/LEATHER amount 5 (gap 4)\n  items: amount 0; 0 stacks available, 6 in use.\n  job 8002: MakeFlask [leather](suspended)\nConstraint BACKPACK/LEATHER amount 5 (gap 4)\n  items: amount 0; 0 stacks available, 2 in use.\n  job 8003: MakeBackpack [leather](suspended)\nConstraint QUIVER/LEATHER amount 5 (gap 4)\n  items: amount 0; 0 stacks available, 5 in use.\n  job 8004: MakeQuiver [leather](suspended)\nConstraint ARMOR:ITEM_ARMOR_LEATHER/LEATHER amount 10 (gap 5)\n  items: amount 0; 0 stacks available, 1 in use.\n  job 8005: MakeArmor [leather](suspended)\nConstraint AMMO:ITEM_AMMO_BOLTS/WOOD amount 160 (gap 5)\n  items: amount 50; 2 stacks available, 9 in use.\n  job 8128: MakeAmmo [wood wood2](suspended)\nConstraint AMMO:ITEM_AMMO_BOLTS/BONE amount 150 (gap 5)\n  items: amount 0; 0 stacks available, 73 in use.\n  job 10685: MakeAmmo [bone](suspended)","files":null},{"type":3,"author":{"id":"41351f340d450d83b1b4f7ee2bf3df35b0b720cf"},"timestamp":1447619954,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1Njg1MTU0Mg==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-156851542"},"message":"FYI \nWhen the workflow Plugin is disabled and i manually resume the old workflow jobs df crashes too. \n\nEdit:\nOk. Looks like it only crashes when the workflow job gets resumed but immediately canceled again because no material is available.","files":null},{"type":3,"author":{"id":"1d743145e739364f08dd7d3a286c26de3406a9db"},"timestamp":1447768118,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NzM3NDQ0Mw==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-157374443"},"message":"@lethosor: [Here's another crashing save for this.](https://www.dropbox.com/s/p0ewyp6pol8b52p/region1_workflow_crash.zip?dl=0)\nGame was generated with dfhack.40.24-r3, crashes with -r3, -r4, and also if I disable dfhack. The crash happens usually within a minute of resuming, but sometimes it can operate for 10s of minutes.  \nI tried finding the corrupted job, but couldn't narrow it down to one, it looks like multiple ones are problematic. One job that crashes is in the Kitchen (Hotkey: F5):\nThe worker collects the ingredients, then cancels the job with\n\"...cancels Prepare Fine Meal: **Inappropriate building.\"**\nAt that point the game CTDs 9 times out of 10.\n\nI tried disabling the plugin, deleting the constrains, deleting the suspended jobs, building another kitchen to see if any of these help.","files":null},{"type":3,"author":{"id":"62d857a3eff39bd922ea82044c15e25f82e04be1"},"timestamp":1447772275,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NzM5MzYyMA==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-157393620"},"message":"@lethosor Perhaps, there were crashes involved in modifying that unknown variable in the past, however, this was modifying all of them rather than a subset.  Perhaps it is a race on changing one of those fields at the same time.  Is there a lock I should acquire before modifying job records?  Don't really know the architecture, but I didn't see any in the other workflow code.  If I get a chance, I'll check out the save tonight.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448404691,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTQyODUwNQ==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159428505"},"message":"You should be using a CoreSuspender somehow (which should be handled if this is called from plugin_onupdate), but the crash appears to occur some time after workflow modifies jobs.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448405249,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTQzMDQ0Ng==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159430446"},"message":"The first save appears to work intermittently - usually, `Resuming job 2402: ProcessPlantsBarrel (delayed)` is logged to the console shortly before crashing, but I saw this once (before quitting DF manually):\n\n```\nResuming job 2402: ProcessPlantsBarrel (delayed)\nResuming job 2402: ProcessPlantsBarrel (delayed)\nResuming job 2402: ProcessPlantsBarrel (delayed)\nSuspending job 8980: MakeAmmo [wood wood2]\nResuming job 2402: ProcessPlantsBarrel (delayed)\nSuspending job 8919: ConstructTable [wood wood2]\nSuspending job 8920: ConstructThrone [wood wood2]\nSuspending job 8921: ConstructBin [wood wood2]\nResuming job 8980: MakeAmmo [wood wood2]\n```\n\nIt's possible that job 2402 is the issue, although it could well be another broken job.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448412348,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTQ0OTc1NA==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159449754"},"message":"@fricy hold on, did the problem in the save you posted start in r3?\n\nAnyway, here's what Toady says about unk_v4020_1:\n\n\u003e That's for the job priority system -- it's called posting_index.  There's the whole \"employment ad\" system now where a job gets posted as one of the new job_posting structures, and the posting index is its index in the array there for quick lookup.  The postings are stored in the job handler right after the job list.  After the postings in the handler there's also a job application binary heap.\n\nI'm not entirely sure what sorts of issues would happen by setting it to -1, but failing to account for it correctly could cause crashes starting in 0.40.20.","files":null},{"type":3,"author":{"id":"1d743145e739364f08dd7d3a286c26de3406a9db"},"timestamp":1448413440,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTQ1MjYyNA==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159452624"},"message":"Hmm. Now that you mention it:I _think_ that save was generated with a -r3 develop build.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448418067,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTQ2NjgyOQ==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159466829"},"message":"Yeah, yours was first loaded in 96df70f, which is after #617 was merged (c5f61af172b5c74f5cd431b336bdb8496a0cc1f8)","files":null},{"type":3,"author":{"id":"88b79c31fdfd52952dafcabb16168259734368cc"},"timestamp":1448436275,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTUyNDE4Ng==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159524186"},"message":"@lethosor's /Toady's comment: is that added to structures?","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448465498,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTY0MjA0Mg==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159642042"},"message":"The field isn't named yet. I don't know if the other structures he mentioned have been researched at all, although they sound a little familiar.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448481894,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTcxNzQ4Mw==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159717483"},"message":"The issue with Fricy's save does appear to be the \"prepare fine meal\" job (ID 4136). DF cancels it due to an inappropriate building, DFHack sets the suspend flag (unk_v4020_1/posting_index is already 1), and DF crashes shortly after.\n\nEdit: Even without setting the suspend flag, DF crashes.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448485990,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTczMjYzNA==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159732634"},"message":"That job starts with no workers assigned (i.e. no instances of general_ref_unit_workerst in general_refs), but is then assigned more than one worker, which causes DF to crash after the job finishes because both general_ref_unit_workerst instances are deleted but the units assigned later retain their references to the job (which no longer exists!). Fortunately, the basic layout of the posting structure was identified in https://github.com/DFHack/df-structures/commit/7392d2ec490378563f67435736fda756d3569a66.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448499750,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTc2OTk5MQ==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159769991"},"message":"Okay, I think I've gotten this fixed. When (un)suspending a job, flagging all of its postings as dead stops multiple workers from being assigned (and Toady says that's what DF itself does). This won't fix already-broken jobs/postings, but I've added a separate command to do that.\n\n@gchpaco and @fricy: Both of your saves run for a while without crashing for me (in @gchpaco's save, the issue was with the two brewing jobs, and DF seems to be assigning both of them workers properly now), but I'll upload a fixed plugin for OS X if you want to test it yourself. I'll check @BioLogisch's save shortly.","files":null},{"type":3,"author":{"id":"0ca329a55351dcb94457e4b8044a4490f2818e02"},"timestamp":1448499793,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTc3MDA1Mg==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159770052"},"message":"Excellent!  Thank you very much!","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448504297,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTc4MzgxNw==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159783817"},"message":"@BioLogisch's save exhibits the same sort of problem with extra job postings, for the leather waterskin job as well as a loom job. I assume setting up the squad triggered a crash with the former job, but I couldn't actually get it to crash before the job got suspended for some reason (which triggered the new workflow code that gets rid of all of the job's postings). The fix does repair the issue, though.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448505350,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTc4NTc2Mw==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159785763"},"message":"Here's an OS X build (it looks like most of you use OS X, so this should be more useful than I expected): https://github.com/lethosor/dfhack/releases/tag/0.40.24-r4-wf1\nIf you like testing things, feel free to test the confirm plugin and make sure issues like #744 are fixed as well. (The dialogs that were too aggressive included the ones for deleting hauling routes, notes and note-related routes, and squads and uniforms.)","files":null},{"type":3,"author":{"id":"0ca329a55351dcb94457e4b8044a4490f2818e02"},"timestamp":1448527832,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTg1MDE5OQ==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159850199"},"message":"I just went a whole season without a crash, so I think you did it.  And the confirm worked for me, at least for hauling routes.","files":null},{"type":2,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448552482,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDc1NzAzOTQ0"},"title":"workflow crash bug on 0.40.24-r4","was":"workflow crash bug on 0.40.24-r4"},{"type":3,"author":{"id":"c831a0801f796fa6596762f5d38bae89ef9bf7a5"},"timestamp":1448565073,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTk3ODQ4Nw==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159978487"},"message":"I just got a workflow crash. Four times.\nIt happens directly after:\n\n```\nResuming job 5327: BREW_DRINK_FROM_PLANT (delayed)\nResuming job 5328: BREW_DRINK_FROM_PLANT_GROWTH (delayed)\nResuming job 5327: BREW_DRINK_FROM_PLANT (delayed)\n```\n\nI then let VS2015 debug (for science). Continue. A little later it spits out another exception this time unrecoverable / uncontinueable but interesting enough the still is suddenly filled with repeating suspending jobs whereas before the exception there were only two. I also happen to be running out of barrels and producing them while this happens.\n\nIt sounds like this just got fixed! If not, let me know I have a crashing save.\n\nEDIT: Hmm. Just crashed without workflow managing those jobs. No job spam on continue either. Let me test a bit more...\nStill crashing with workflow disabled.\nImmediate crash on removing the still workshops.\nEDIT2:Alright... Even vanilla DF crashes on removing the stills... I'm lost. ...is there any way I can save my game from its apparent doom?\nEDIT3:Yay, saved it. Forbidding some items in the workshop worked.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448568446,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTk4NzU4MQ==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159987581"},"message":"It should be fixed in the next DFHack release (and the issue should be detected and fixed in existing saves too). The workflow plugin causes the issue, but it triggers a crash later (sometimes) which doesn't necessarily require DFHack to be running.\n\n[Here](https://github.com/lethosor/dfhack-scripts/blob/master/devel/watch-ws-job.lua) is a script you can use - save it to the hack/scripts/devel folder, run `devel/watch-ws-job` with the job you think is broken selected in the UI (there could well be multiple broken jobs, but the brewing jobs are a good place to start), and unpause and let DF run for a while. You should see multiple workers or multiple postings logged to the console if the job is problematic. (This won't actually fix the jobs, but I can put a script together that might.)","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448568741,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTk4ODQ4NQ==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159988485"},"message":"Actually, that script won't work in r4. I'll try to set up something that will fix the job issue temporarily, though.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448570627,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1OTk5MTcwOA==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-159991708"},"message":"Here's a script that should work in r4 and the latest development build: https://github.com/lethosor/dfhack-scripts/blob/master/devel/fix-job-postings.lua\n(Be sure to save it to hack/scripts/devel/fix-job-postings.lua, to avoid confusion with the newer fix-job-postings command added by workflow.)","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448592285,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE2MDAzMTQwMg==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-160031402"},"message":"I'll mark this as closed, since r5 should be coming in a couple days, but feel free to continue discussion if necessary.","files":null},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1448592285,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDc1OTgxMzQ0"},"status":2},{"type":3,"author":{"id":"41351f340d450d83b1b4f7ee2bf3df35b0b720cf"},"timestamp":1448625319,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE2MDEyMzI1OA==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-160123258"},"message":"@lethosor \nI am not able to test it at the moment. But i want to say thank you for your work and time.","files":null},{"type":3,"author":{"id":"c831a0801f796fa6596762f5d38bae89ef9bf7a5"},"timestamp":1448708137,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE2MDI3NjUyMQ==","github-url":"https://github.com/DFHack/dfhack/issues/741#issuecomment-160276521"},"message":"It works on my crashing save. As does the dev version with the updated workflow script. Indeed thanks are in order ;]","files":null}]}