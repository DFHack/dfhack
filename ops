{"version":1,"ops":[{"type":5,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1526670362,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDE2MzQ5NTYyNzA="},"added":["bug"],"removed":[]},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1530818029,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwMjgyNDg4MQ==","github-url":"https://github.com/DFHack/dfhack/issues/1279#issuecomment-402824881"},"message":"Looking back at this, I'm not entirely sure what you're saying. Are you suggesting removing that section as a fix? Do you happen to have a save handy?","files":null},{"type":3,"author":{"id":"c0f1221591bbebc818b8fe08112efa73735292c5"},"timestamp":1530820038,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwMjgzMjgyNA==","github-url":"https://github.com/DFHack/dfhack/issues/1279#issuecomment-402832824"},"message":"_**tl;dr section**_\n**That is what I was suggesting.**\n\n**As for a save** this was burneddi's save from May 17th\n_**end tl;dr section**_\n\nSorry to ramble and muddle the issue, but I was drowning in frustration at the time. Especially that there wasn't a vampire in the fortress as well. Just the former spy running around on a prior identity because they'd _burned_ their actual identity due to a crime.\n\nAs for why the fix works... I *think* that way back when, identities got copied over the unit... change the identity and the unit got a copy. Worked great for vampires and werewolves.\n\nThen Toady revisited falsifying your identity and changed it to not copy all the time. So the ident and the unit differed. Main DF knows to _always_ check the identities.\n\nIs blasting the commented code out the ideal? I dunno. It worked when I did it with the spy. Don't know about vampires, etc.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1530820662,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwMjgzNTM3MA==","github-url":"https://github.com/DFHack/dfhack/issues/1279#issuecomment-402835370"},"message":"Oh, so maybe identities take precedence now. Should it check for identities, then histfig names, then unit names? It seems weird to skip histfigs to me, although it's possible that DF's nickname setting is like Units::setNickname, which sets both histfig and unit names when applicable.","files":null},{"type":3,"author":{"id":"c0f1221591bbebc818b8fe08112efa73735292c5"},"timestamp":1530821361,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwMjgzODQwMg==","github-url":"https://github.com/DFHack/dfhack/issues/1279#issuecomment-402838402"},"message":"Well it was my fast and dirty fix, I didn't ask anyone competent to look it over until I suggested it here.\n\nYou probably have it right to not skip the hist fig. I was **massively** frustrated and couldn't see what the better precedence might be. When I finally nailed it down to the hist fig popping up after the identity and thus borking things I snapped it off like a rotten branch.\n\nI was a bit too _salty_ at it to try to work it back in at a different precedence. I just knew main DF found identity to be key at this point, and was happy it worked on the spy.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1530822108,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwMjg0MTQ3Mg==","github-url":"https://github.com/DFHack/dfhack/issues/1279#issuecomment-402841472"},"message":"Save, for reference: https://drive.google.com/file/d/1bX5CQMqNsb_mjJOEOS4wBm4mGDLLs_cZ/view\nI'll look into this asap","files":null},{"type":2,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1530886341,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50MTcyMDM3MDc4NA=="},"title":"Changes due to Scouting, Crime, etc break getVisibleName","was":"Changes due to Scouting, Crime, etc break getVisibleName"},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1530886531,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwMzA0Njk5OQ==","github-url":"https://github.com/DFHack/dfhack/issues/1279#issuecomment-403046999"},"message":"Actually, that's using the name from a histfig ID associated with the identity, not with the unit. I think that could just be removed, then.","files":null},{"type":3,"author":{"id":"8aef4ad26d2b4762925d15b4fa91036a55d7d34c"},"timestamp":1530887806,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwMzA1MzA3Nw==","github-url":"https://github.com/DFHack/dfhack/issues/1279#issuecomment-403053077"},"message":"Is the unit list search using getVisibleName? Vampires need to be searched by their real name.","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1530889367,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwMzA2MDM1NQ==","github-url":"https://github.com/DFHack/dfhack/issues/1279#issuecomment-403060355"},"message":"getVisibleName is supposed to return the name visible in DF, so search should definitely be using it. I'm working on fixing it - with the histfig code removed, it handles this case as well as an apparent vampire from http://www.bay12games.com/dwarves/mantisbt/view.php?id=10530 (http://dffd.bay12games.com/file.php?id=13428).","files":null},{"type":3,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1530890713,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQwMzA2NjUwOQ==","github-url":"https://github.com/DFHack/dfhack/issues/1279#issuecomment-403066509"},"message":"Fixed in 54cf8b7, hopefully.","files":null},{"type":4,"author":{"id":"e77d0a5f059ed8eaaa1afef6624480d02a2f025a"},"timestamp":1530890713,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTcyMDUyNjE3MA=="},"status":2}]}